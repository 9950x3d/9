
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>RPG v15: ë“€ì–¼ ë‹¨ê²€ & ì‚¬ì´ë³´ê·¸</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #2c3e50;
            color: white;
            text-align: center;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            user-select: none;
            overflow: hidden;
        }
        .top-bar {
            width: 100%;
            background-color: #1a252f;
            padding: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            position: fixed;
            top: 0;
            z-index: 100;
        }
        .res-coin { color: #f1c40f; }
        .res-potion { color: #e056fd; }
        .btn-small { background: #7f8c8d; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; color: white; font-size: 12px; }
        .btn-mode { background: #16a085; border: 1px solid #1abc9c; }

        .game-container {
            margin-top: 60px;
            background-color: #34495e;
            width: 480px;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            border: 2px solid #ecf0f1;
            transition: transform 0.3s, margin-top 0.3s;
            max-height: 90vh;
            overflow-y: auto; 
        }

        .mode-mobile .game-container { transform: scale(1.15); margin-top: 100px; transform-origin: top center; }
        .mode-pc .game-container { transform: scale(1.0); margin-top: 60px; }
        
        h2 { margin: 0 0 5px 0; color: #ecf0f1; border-bottom: 2px solid #7f8c8d; padding-bottom: 5px; font-size: 18px;}
        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .equip-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 5px;
        }
        .equip-slot {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #222;
            padding: 5px;
            border-radius: 10px;
            border: 2px solid #7f8c8d;
            width: 80px;
        }
        .big-icon { font-size: 40px; margin: 2px 0; transition: transform 0.1s; }
        .status { font-size: 12px; font-weight: bold; color: #bdc3c7; }
        
        .log-box {
            background: #222;
            color: #ddd;
            padding: 5px;
            border-radius: 5px;
            font-size: 11px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            white-space: pre-line;
        }

        button {
            padding: 8px;
            font-size: 13px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 2px;
            font-weight: bold;
            width: 96%;
            transition: 0.1s;
        }
        button:active { transform: scale(0.96); }
        button:disabled { opacity: 0.5; cursor: not-allowed; background-color: #7f8c8d !important; }

        .btn-enhance { background-color: #e67e22; color: white; }
        .btn-gacha-w { background-color: #d35400; color: white; border: 2px solid #e67e22; }
        .btn-gacha-a { background-color: #9b59b6; color: white; border: 2px solid #8e44ad; }
        .btn-auto { background-color: #34495e; color: #ddd; border: 1px solid #7f8c8d; font-size: 11px; }
        
        .btn-forest { background-color: #27ae60; color: white; }
        .btn-field { background-color: #c0392b; color: white; }
        .btn-raid { background-color: #c0392b; color: white; border: 2px solid #e74c3c; }
        .btn-reaper { background-color: #2c3e50; color: white; border: 2px solid #000; } 
        .btn-dagger { background-color: #34495e; color: #f1c40f; border: 2px solid #f1c40f; } /* ë“€ì–¼ë‹¨ê²€ ë²„íŠ¼ */

        .btn-save { background-color: #2980b9; color: white; width: 48% !important; }
        .btn-reset { background-color: #c0392b; color: white; width: 48% !important; }

        .skill-container { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .btn-skill {
            width: 32%; background-color: #34495e; border: 2px solid #f1c40f; color: #f1c40f;
            font-size: 11px; position: relative; overflow: hidden; height: 35px;
        }
        .skill-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background-color: rgba(0,0,0,0.6); transition: height linear; }

        .code-area { margin-top: 5px; border-top: 1px solid #7f8c8d; padding-top: 5px; }
        .input-code { padding: 5px; border-radius: 4px; border: none; width: 60%; margin-right: 5px; }
        .btn-code { background-color: #8e44ad; color: white; width: 30%; padding: 5px; font-size: 12px; }

        .inventory-box {
            background-color: #2c3e50; padding: 5px; border-radius: 8px; margin-top: 5px;
            border: 1px dashed #95a5a6; max-height: 85px; overflow-y: auto;
        }
        .inv-title { font-size: 11px; margin-bottom: 3px; text-align: left; color: #ddd; }
        .inv-grid { display: flex; flex-wrap: wrap; gap: 4px; justify-content: flex-start; }
        .inv-slot {
            width: 40px; height: 40px; background-color: #34495e; border: 2px solid #555;
            border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .inv-slot.selected { border-color: #2ecc71; background-color: #222; }
        .inv-slot.locked { filter: grayscale(1); opacity: 0.3; cursor: not-allowed; }
        .slot-icon { font-size: 16px; }
        .slot-lv { font-size: 8px; color: #f1c40f; }

        .bar-container { width: 90%; background: #555; height: 16px; border-radius: 10px; margin: 3px auto; overflow: hidden; position: relative;}
        .hp-text { position: absolute; width: 100%; text-align: center; top: 0; font-size: 10px; line-height: 16px; text-shadow: 1px 1px 1px black; z-index: 2; }
        .boss-hp-bar { width: 100%; height: 100%; background: #e74c3c; transition: width 0.2s; }
        .player-hp-bar { width: 100%; height: 100%; background: #2ecc71; transition: width 0.2s; }

    </style>
</head>
<body class="mode-pc">

    <div class="top-bar">
        <div class="res-coin">ğŸ’° <span id="coinDisplay">0</span></div>
        <div class="res-potion">ğŸ§ª <span id="potionDisplay">0</span></div>
        <button class="btn-small btn-mode" onclick="toggleMode()">ğŸ’» PC / ğŸ“± ëª¨ë°”ì¼</button>
        <button class="btn-small" onclick="manualSave()">ğŸ’¾ ì €ì¥</button>
    </div>

    <div class="game-container">
        
        <!-- 1. ë§ˆì„ -->
        <div id="townScreen" class="screen active">
            <h2>ğŸ° ë§ˆì„ ê´‘ì¥</h2>
            
            <div class="equip-container">
                <div class="equip-slot">
                    <div class="big-icon" id="townWeaponIcon">ğŸ—¡ï¸</div>
                    <div class="status" id="weaponStatus">Lv.0</div>
                </div>
                <div class="equip-slot">
                    <div class="big-icon" id="townArmorIcon">ğŸ‘•</div>
                    <div class="status" id="armorStatus">ë§¨ëª¸</div>
                </div>
            </div>

            <div class="log-box" id="townLog">Lv.100 ì‚¬ì´ë³´ê·¸ ê°‘ì˜· ì¶”ê°€!</div>

            <!-- ë¬´ê¸° ê´€ë¦¬ -->
            <div style="display: flex; justify-content: center; width: 100%;">
                <button class="btn-enhance" style="width: 32%;" onclick="enhanceWeapon()">ğŸ”¨ ê°•í™”</button>
                <button class="btn-gacha-w" style="width: 32%;" onclick="gachaWeapon()">ğŸ—¡ï¸ ë¬´ê¸°ë½‘ê¸°</button>
                <button class="btn-auto" style="width: 32%;" onclick="autoEnhance()">âš¡ ì—°ì†ê°•í™”</button>
            </div>
            <!-- ë°©ì–´êµ¬ ê´€ë¦¬ -->
            <div style="display: flex; justify-content: center; width: 100%; margin-top:2px;">
                <button class="btn-gacha-a" style="width: 48%;" onclick="gachaArmor(false)">ğŸ›¡ï¸ ë°©ì–´êµ¬ ë½‘ê¸° (5000G)</button>
                <button class="btn-auto" id="btnAutoArmor" style="width: 48%;" onclick="autoGachaArmor()">ğŸ”„ ë°©ì–´êµ¬ ì—°ì†</button>
            </div>
            
            <div style="display:flex; justify-content: space-between; margin-top:5px;">
                <button class="btn-forest" style="width:32%" onclick="changeScreen('forestScreen')">ğŸŒ² ìˆ²</button>
                <button class="btn-field" style="width:32%" onclick="goToField()">ğŸ‘¹ ì‚¬ëƒ¥í„°</button>
                <button class="btn-raid" style="width:32%" onclick="goToRaidSelect()">ğŸ”¥ ë ˆì´ë“œ</button>
            </div>

            <div style="display:flex; justify-content: center; margin-top:5px;">
                <button class="btn-save" onclick="manualSave()">ğŸ’¾ ì €ì¥</button>
                <button class="btn-reset" onclick="resetGame()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
            </div>

            <!-- ì¸ë²¤í† ë¦¬ ì˜ì—­ -->
            <div class="inventory-box">
                <div class="inv-title">ğŸ’ ë¬´ê¸° ì¸ë²¤í† ë¦¬</div>
                <div class="inv-grid" id="weaponInventoryGrid"></div>
            </div>
            <div class="inventory-box">
                <div class="inv-title">ğŸ›¡ï¸ ë°©ì–´êµ¬ ì¸ë²¤í† ë¦¬</div>
                <div class="inv-grid" id="armorInventoryGrid"></div>
            </div>

            <div class="code-area">
                <input type="text" id="codeInput" class="input-code" placeholder="ì½”ë“œ ì…ë ¥">
                <button class="btn-code" onclick="useCode()">ì…ë ¥</button>
            </div>
        </div>

        <!-- 2. ë ˆì´ë“œ ì„ íƒ -->
        <div id="raidSelectScreen" class="screen">
            <h2>ğŸ”¥ ë ˆì´ë“œ ì„ íƒ</h2>
            <div class="log-box">ë„ì „í•  ë³´ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
            <button class="btn-raid" onclick="startRaid('hell')">ğŸ”¥ ì§€ì˜¥ì˜ íŒŒìˆ˜ê¾¼ (Easy)</button>
            <button class="btn-reaper" onclick="startRaid('reaper')">ğŸ’€ ì‚¬ì‹  (Hard)</button>
            <button class="btn-dagger" onclick="startRaid('dagger')">âš”ï¸ ë“€ì–¼ ë‹¨ê²€ (Extreme)</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸ”™ ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- 3. ìˆ² -->
        <div id="forestScreen" class="screen">
            <h2>ğŸŒ² ì‹ ë¹„í•œ ìˆ²</h2>
            <div class="big-icon">ğŸª“</div>
            <div class="log-box" id="forestLog">ë‚˜ë¬´ë¥¼ ìºì„œ ëˆì„ ë²„ì„¸ìš”.</div>
            <div id="cooldownBarContainer" style="width:90%; height:5px; background:#555; margin:5px auto; display:none;"><div id="cooldownBar" style="width:0%; height:100%; background:gold;"></div></div>
            <button class="btn-forest" id="chopBtn" onclick="chopWood()">ğŸª“ ë‚˜ë¬´ ë² ê¸°</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸ° ë§ˆì„ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- 4. ì‚¬ëƒ¥í„° -->
        <div id="fieldScreen" class="screen">
            <h2>â˜ ï¸ ìœ„í—˜í•œ ì‚¬ëƒ¥í„°</h2>
            <div class="big-icon" id="monsterIcon">â“</div>
            <div class="status" id="monsterInfo">íƒìƒ‰ ì¤‘...</div>
            <div class="log-box" id="battleLog">ì•¼ìƒì˜ ëª¬ìŠ¤í„°ê°€ ë‚˜íƒ€ë‚¬ë‹¤!</div>
            <div class="skill-container" id="battleSkills"></div>
            <button class="btn-field" id="attackBtn" onclick="attackMonster()">âš”ï¸ ê³µê²©í•˜ê¸°</button>
            <button class="btn-field" id="nextMonsterBtn" onclick="spawnMonster()" style="display:none;">ğŸ” ë‹¤ìŒ ëª¬ìŠ¤í„°</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸƒ ë„ë§ê°€ê¸°</button>
        </div>

        <!-- 5. ë ˆì´ë“œ ì „íˆ¬ -->
        <div id="raidScreen" class="screen">
            <h2 id="raidTitle">ğŸ”¥ ì§€ì˜¥ì˜ ë ˆì´ë“œ</h2>
            <div class="big-icon" id="raidBossIcon">ğŸ‘¿</div>
            
            <div style="font-size:12px; text-align:left; margin-left:20px;">ğŸ‘¿ BOSS HP</div>
            <div class="bar-container">
                <div class="boss-hp-bar" id="raidHpBar"></div>
                <div class="hp-text" id="raidHpText">10,000,000</div>
            </div>

            <div style="font-size:12px; text-align:left; margin-left:20px; margin-top:5px;">â¤ï¸ MY HP</div>
            <div class="bar-container">
                <div class="player-hp-bar" id="playerHpBar"></div>
                <div class="hp-text" id="playerHpText">1000 / 1000</div>
            </div>

            <div class="log-box" id="raidLog">ì „íˆ¬ ì‹œì‘!</div>
            <div class="skill-container" id="raidSkills"></div>

            <button class="btn-raid" onclick="attackRaidBoss()">ğŸ¹ ë³´ìŠ¤ ê³µê²©í•˜ê¸°</button>
            <button class="btn-potion" onclick="drinkPotion()">ğŸ§ª ë¬¼ì•½ (HP íšŒë³µ)</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸƒ ë„ë§ê°€ê¸°</button>
        </div>

    </div>

    <script>
        // === ğŸ’¾ ë°ì´í„° êµ¬ì¡° ===
        let gameData = {
            coins: 0,
            weaponLevel: 0,
            maxArmorLevel: 0, 
            equippedArmorLevel: 0,
            potions: 0,
            hasHellBow: false,
            hasDragonflyNet: false,
            hasAdminWeapon: false,
            hasScythe: false, 
            hasDualDagger: false, // ì‹ ê·œ ë¬´ê¸°
            equippedSkinName: null
        };

        // ëŸ°íƒ€ì„ ë³€ìˆ˜
        let playerCurrentHp = 1000;
        let playerMaxHp = 1000;
        let raidHp = 10000000;
        let raidMaxHp = 10000000;
        let currentRaidType = 'hell';
        
        let skillCD = { Z: 0, X: 0, C: 0 };
        const MAX_CD = { Z: 5000, X: 10000, C: 20000 };
        let isAutoWeapon = false;
        let isAutoArmor = false;

        // === ğŸ—¡ï¸ ë¬´ê¸° DB ===
        const weaponDB = [
            { lv: 0, name: "ë‚¡ì€ ê²€", icon: "ğŸ—¡ï¸" },
            { lv: 10, name: "ê³¨ë“œë°”", icon: "ğŸ§ˆ" },
            { lv: 20, name: "ì‹ í™”ì˜ í™œ", icon: "ğŸ¹" },
            { lv: 35, name: "ë„ˆí´", icon: "ğŸ‘Š" },
            { lv: 50, name: "í™”ì—¼ë°©ì‚¬ê¸°", icon: "ğŸ”¥" },
            { lv: 65, name: "ë¯¸ë‹ˆê±´", icon: "ğŸš" },
            { lv: 70, name: "ë±€íŒŒì´ì–´ ì´ë¹¨", icon: "ğŸ§›" },
            { lv: 75, name: "ë¡œë´‡ íŒ”", icon: "ğŸ¤–" },
            { lv: 80, name: "ì•ŒëŒ ì‹œê³„", icon: "â°" },
            { lv: 90, name: "ê´‘ì„ ê²€", icon: "ğŸ”¦" },
            { lv: 100, name: "ì¹¼ëŒë¹—", icon: "ğŸŒ™" }
        ];

        // === ğŸ›¡ï¸ ë°©ì–´êµ¬ DB (Lv.100 ì¶”ê°€) ===
        const armorDB = [
            { lv: 0, name: "ë§¨ëª¸", icon: "ğŸ‘•", hp: 1000 },
            { lv: 10, name: "ì¼ë°˜ ê°‘ì˜·", icon: "ğŸ§¥", hp: 5000 },
            { lv: 20, name: "ì²  ê°‘ì˜·", icon: "ğŸ›¡ï¸", hp: 20000 },
            { lv: 30, name: "ë‹¤ì´ì•„ ê°‘ì˜·", icon: "ğŸ’", hp: 100000 },
            { lv: 40, name: "ì—ë©”ë„ë“œ ê°‘ì˜·", icon: "â‡ï¸", hp: 500000 },
            { lv: 50, name: "ì‹ ì˜ ê°‘ì˜·", icon: "ğŸ‘¼", hp: 2000000 },
            { lv: 60, name: "ê´´ë¬¼ì˜ ê°€ì£½", icon: "ğŸ‘¹", hp: 5000000 },
            { lv: 70, name: "ì§€ì˜¥ì˜ ê°‘ì£¼", icon: "ğŸ”¥", hp: 10000000 },
            { lv: 100, name: "ì‚¬ì´ë³´ê·¸ ê°‘ì˜·", icon: "ğŸ¤–", hp: 50000000 } // ì‹ ê·œ
        ];

        // === 1. ì‹œìŠ¤í…œ ===
        function saveGame() { localStorage.setItem("rpg_v15_save", JSON.stringify(gameData)); }
        function manualSave() { saveGame(); alert("ì €ì¥ ì™„ë£Œ!"); }
        function loadGame() {
            const saved = localStorage.getItem("rpg_v15_save");
            if(saved) {
                let parsed = JSON.parse(saved);
                if(parsed.armorLevel !== undefined && parsed.maxArmorLevel === undefined) {
                    parsed.maxArmorLevel = parsed.armorLevel;
                    parsed.equippedArmorLevel = parsed.armorLevel;
                }
                gameData = { ...gameData, ...parsed };
            }
            renderWeaponInventory(); renderArmorInventory(); updateUI();
        }
        function resetGame() { 
            if(confirm("ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.removeItem("rpg_v15_save"); location.reload(); } 
        }
        setInterval(saveGame, 10000);

        function useCode() {
            const input = document.getElementById('codeInput').value.trim();
            if (input === 'dlalsgh1215') { gameData.coins += 10000000000; alert("ğŸ’° 100ì–µ ì½”ì¸ íšë“!"); }
            else if (input === 'gg100k') { if(!gameData.hasDragonflyNet) { gameData.hasDragonflyNet=true; alert("ğŸ•¸ï¸ [ì ìë¦¬ì±„] íšë“!"); renderWeaponInventory(); } }
            else if (input === '67') { if(!gameData.hasAdminWeapon) { gameData.hasAdminWeapon=true; alert("6ï¸âƒ£7ï¸âƒ£ [67 ë¬´ê¸°] íšë“!"); renderWeaponInventory(); } }
            else { alert("âŒ í‹€ë¦° ì½”ë“œì…ë‹ˆë‹¤."); }
            document.getElementById('codeInput').value = ""; saveGame(); updateUI();
        }

        // === 2. ë¬´ê¸° ë½‘ê¸° & ê°•í™” ===
        function gachaWeapon() {
            const COST = 50000;
            if (gameData.coins < COST) { log('town', "ëˆ ë¶€ì¡± (5ë§ŒG)"); return; }
            if (gameData.weaponLevel >= 100) { log('town', "ì´ë¯¸ ë§Œë ™ì…ë‹ˆë‹¤!"); return; }

            gameData.coins -= COST;
            let roll = Math.random() * 100;
            let resultLv = 0;
            if (roll < 50) resultLv = 20 + Math.floor(Math.random()*10);
            else if (roll < 80) resultLv = 40 + Math.floor(Math.random()*10);
            else if (roll < 95) resultLv = 60 + Math.floor(Math.random()*15);
            else resultLv = 80 + Math.floor(Math.random()*15);

            if (resultLv > gameData.weaponLevel) {
                gameData.weaponLevel = resultLv;
                log('town', `âœ¨ ëŒ€ë°•! ë¬´ê¸° ë½‘ê¸° ì„±ê³µ! Lv.${resultLv}`);
                renderWeaponInventory();
            } else {
                log('town', `ê½.. (Lv.${resultLv} ë‚˜ì˜´)`);
            }
            updateUI();
        }

        function enhanceWeapon() {
            if(gameData.coins < 100) return log('town', "ëˆ ë¶€ì¡±!");
            gameData.coins -= 100;
            let rate = 95; 
            if (gameData.weaponLevel >= 80) rate = 60; 
            else if (gameData.weaponLevel >= 50) rate = 80; 

            if(Math.random()*100 < rate) { gameData.weaponLevel++; log('town', "ê°•í™” ì„±ê³µ!"); renderWeaponInventory(); } 
            else { if(gameData.weaponLevel>0) gameData.weaponLevel--; log('town', "ì‹¤íŒ¨!"); }
            updateUI();
        }

        // === 3. ë°©ì–´êµ¬ ë½‘ê¸° (Lv.100 ì²´í¬) ===
        function gachaArmor(isAutoMode = false) {
            const COST = 5000;
            if (gameData.coins < COST) { if(!isAutoMode) log('town', "ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (5000G)"); return false; }
            if (gameData.maxArmorLevel >= 100) { if(!isAutoMode) log('town', "ìµœê°• ë°©ì–´êµ¬ ë„ë‹¬!"); return false; }

            gameData.coins -= COST;
            let successRate = 50; 
            if (Math.random() * 100 < successRate) {
                let currentIdx = armorDB.findIndex(a => a.lv === gameData.maxArmorLevel);
                if (currentIdx < armorDB.length - 1) {
                    let nextArmor = armorDB[currentIdx + 1];
                    gameData.maxArmorLevel = nextArmor.lv;
                    gameData.equippedArmorLevel = nextArmor.lv; 
                    log('town', `ğŸ‰ ë°©ì–´êµ¬ ìŠ¹ê¸‰! [${nextArmor.name}]`);
                    renderArmorInventory(); updateUI();
                }
            } else { if(!isAutoMode) log('town', "ê½..."); }
            updateUI(); return true;
        }

        async function autoGachaArmor() {
            if(isAutoArmor) { isAutoArmor = false; document.getElementById('btnAutoArmor').innerText = "ğŸ”„ ë°©ì–´êµ¬ ì—°ì†"; return; }
            isAutoArmor = true; document.getElementById('btnAutoArmor').innerText = "â¹ ì¤‘ë‹¨";
            while(isAutoArmor && gameData.coins >= 5000 && gameData.maxArmorLevel < 100) {
                gachaArmor(true); await new Promise(r => setTimeout(r, 100));
            }
            isAutoArmor = false; document.getElementById('btnAutoArmor').innerText = "ğŸ”„ ë°©ì–´êµ¬ ì—°ì†";
        }

        // === 4. ìŠ¤í‚¬ (ë“€ì–¼ ë‹¨ê²€ ì¶”ê°€) ===
        function getWeaponSkillInfo() {
            let weapon = getCurrentDisplayWeapon();
            let name = weapon.name;
            if (name === "ì ìë¦¬ì±„") return { Z:{name:"ğŸŒŒ ë¸”ë™í™€", mult:0, fixed:99999999}, X:{name:"ğŸ’« ë¶•ê´´", mult:500}, C:{name:"âŒ ì‚­ì œ", mult:1000} };
            if (name === "ì§€ì˜¥ì˜ í™œ") return { Z:{name:"ğŸ”¥ ë¶ˆí™”ì‚´", mult:10}, X:{name:"ğŸŒ‹ ë§ˆê·¸ë§ˆ", mult:30}, C:{name:"â˜„ï¸ ë©”í…Œì˜¤", mult:50} };
            if (name === "67 ë¬´ê¸°") return { Z:{name:"ğŸ² ëœë¤", mult:20}, X:{name:"ğŸ° ì­íŒŸ", mult:77}, C:{name:"ğŸ’€ ì¦‰ì‚¬", mult:100} };
            if (name === "ì‚¬ì‹ ì˜ ë‚«") return { Z:{name:"ğŸ‘» ì˜í˜¼ë² ê¸°", mult:50}, X:{name:"âš–ï¸ ì‚¬í˜•ì„ ê³ ", mult:200}, C:{name:"âš°ï¸ ì˜ë©´", mult:500} };
            if (name === "ì¹¼ëŒë¹—") return { Z:{name:"âš”ï¸ ê¸‰ì†Œë² ê¸°", mult:100}, X:{name:"ğŸŒ‘ ê·¸ë¦¼ìì¶¤", mult:300}, C:{name:"ğŸ©¸ ì•”ì‚´", mult:500} };
            if (name === "ë“€ì–¼ ë‹¨ê²€") return { Z:{name:"âš”ï¸ í¬ë¡œìŠ¤ì»·", mult:200}, X:{name:"ğŸŒªï¸ ë¸”ë ˆì´ë“œ", mult:500}, C:{name:"âš¡ ìŒì†ëŒíŒŒ", mult:1500} };
            return { Z:{name:"âš¡ ê°•íƒ€", mult:5}, X:{name:"âš”ï¸ ì—°íƒ€", mult:10}, C:{name:"ğŸ’¢ í­ì£¼", mult:20} };
        }

        function updateSkillButtons() {
            const skills = getWeaponSkillInfo();
            const skillHTML = (suffix) => `
                <button class="btn-skill" onclick="useSkill('Z')">${skills.Z.name} (Z)<div class="skill-overlay" id="cdZ${suffix}"></div></button>
                <button class="btn-skill" onclick="useSkill('X')">${skills.X.name} (X)<div class="skill-overlay" id="cdX${suffix}"></div></button>
                <button class="btn-skill" onclick="useSkill('C')">${skills.C.name} (C)<div class="skill-overlay" id="cdC${suffix}"></div></button>
            `;
            document.getElementById('battleSkills').innerHTML = skillHTML('');
            document.getElementById('raidSkills').innerHTML = skillHTML('_R');
        }

        function useSkill(key) {
            const now = Date.now();
            if (now < skillCD[key]) return;
            skillCD[key] = now + MAX_CD[key];
            const ids = [`cd${key}`, `cd${key}_R`];
            ids.forEach(id => { const el=document.getElementById(id); if(el){el.style.height="100%";el.offsetHeight;el.style.transition=`height ${MAX_CD[key]}ms linear`;el.style.height="0%";}});
            let skills = getWeaponSkillInfo();
            log(document.getElementById('raidScreen').classList.contains('active') ? 'raid' : 'battle', `${skills[key].name} ë°œë™!`);
        }

        function calculateDamage() {
            let base = gameData.weaponLevel + 10;
            let finalDmg = base;
            const now = Date.now();
            let skills = getWeaponSkillInfo();
            let activeSkill = null;
            if (now - (skillCD.C - MAX_CD.C) < 1000) activeSkill = skills.C;
            else if (now - (skillCD.X - MAX_CD.X) < 1000) activeSkill = skills.X;
            else if (now - (skillCD.Z - MAX_CD.Z) < 1000) activeSkill = skills.Z;

            if (activeSkill) {
                if (activeSkill.fixed) finalDmg = activeSkill.fixed;
                else finalDmg = base * activeSkill.mult;
            }
            return Math.floor(finalDmg);
        }

        // === 5. ë ˆì´ë“œ (ë“€ì–¼ ë‹¨ê²€ ì¶”ê°€) ===
        function raidSuccess() {
            if (currentRaidType === 'hell') {
                alert("ğŸ‰ ì§€ì˜¥ì˜ íŒŒìˆ˜ê¾¼ ì²˜ì¹˜! (500ë§Œ G)");
                gameData.coins += 5000000;
                if(Math.random() < 0.2 && !gameData.hasHellBow) {
                    gameData.hasHellBow = true; alert("ğŸ”¥ [ì§€ì˜¥ì˜ í™œ] íšë“!"); renderWeaponInventory();
                }
            } else if (currentRaidType === 'reaper') {
                alert("ğŸ‰ ì‚¬ì‹  ì²˜ì¹˜! (1000ë§Œ G)");
                gameData.coins += 10000000;
                if(Math.random() < 0.1 && !gameData.hasScythe) {
                    gameData.hasScythe = true; alert("ğŸ’€ [ì‚¬ì‹ ì˜ ë‚«] íšë“!"); renderWeaponInventory();
                }
            } else if (currentRaidType === 'dagger') {
                alert("ğŸ‰ ì•”ì‚´ì ë§ˆìŠ¤í„° ì²˜ì¹˜! (3000ë§Œ G)");
                gameData.coins += 30000000;
                // 15% í™•ë¥ 
                if(Math.random() < 0.15 && !gameData.hasDualDagger) {
                    gameData.hasDualDagger = true; alert("âš”ï¸ [ë“€ì–¼ ë‹¨ê²€] íšë“! (15%)"); renderWeaponInventory();
                }
            }
            saveGame(); changeScreen('townScreen');
        }

        function startRaid(type) {
            currentRaidType = type;
            let armor = armorDB.find(a => a.lv === gameData.equippedArmorLevel) || armorDB[0];
            playerMaxHp = armor.hp; playerCurrentHp = playerMaxHp;

            if (type === 'hell') { raidMaxHp = 10000000; raidHp = raidMaxHp; document.getElementById('raidTitle').innerText = "ğŸ”¥ ì§€ì˜¥ì˜ íŒŒìˆ˜ê¾¼"; document.getElementById('raidBossIcon').innerText = "ğŸ‘¿"; } 
            else if (type === 'reaper') { raidMaxHp = 50000000; raidHp = raidMaxHp; document.getElementById('raidTitle').innerText = "ğŸ’€ ì‚¬ì‹ "; document.getElementById('raidBossIcon').innerText = "ğŸ’€"; }
            else if (type === 'dagger') { raidMaxHp = 200000000; raidHp = raidMaxHp; document.getElementById('raidTitle').innerText = "âš”ï¸ ì•”ì‚´ì ë§ˆìŠ¤í„°"; document.getElementById('raidBossIcon').innerText = "âš”ï¸"; }

            updateSkillButtons(); changeScreen('raidScreen'); updateRaidUI();
        }

        // === ì¸ë²¤í† ë¦¬ ===
        function renderWeaponInventory() {
            const grid = document.getElementById('weaponInventoryGrid'); grid.innerHTML = "";
            weaponDB.forEach(w => createWeaponSlot(grid, w.icon, `Lv.${w.lv}`, gameData.weaponLevel >= w.lv, w.name));
            createWeaponSlot(grid, "ğŸ”¥", "ì§€ì˜¥í™œ", gameData.hasHellBow, "ì§€ì˜¥ì˜ í™œ");
            createWeaponSlot(grid, "ğŸ•¸ï¸", "ì ìë¦¬ì±„", gameData.hasDragonflyNet, "ì ìë¦¬ì±„");
            createWeaponSlot(grid, "6ï¸âƒ£7ï¸âƒ£", "íˆë“ ", gameData.hasAdminWeapon, "67 ë¬´ê¸°");
            createWeaponSlot(grid, "ğŸ’€", "ì‚¬ì‹ ë‚«", gameData.hasScythe, "ì‚¬ì‹ ì˜ ë‚«");
            createWeaponSlot(grid, "âš”ï¸", "ë“€ì–¼ë‹¨ê²€", gameData.hasDualDagger, "ë“€ì–¼ ë‹¨ê²€");
        }

        function createWeaponSlot(parent, icon, text, unlock, skinName) {
            let div = document.createElement('div'); div.className = "inv-slot";
            if(!unlock) { div.classList.add('locked'); div.innerHTML = "ğŸ”’"; }
            else { 
                div.innerHTML = `<div class="slot-icon">${icon}</div><div class="slot-lv">${text}</div>`;
                div.onclick = () => { gameData.equippedSkinName = skinName; renderWeaponInventory(); updateUI(); };
                if(getCurrentDisplayWeapon().name === skinName) div.classList.add('selected');
            }
            parent.appendChild(div);
        }

        function renderArmorInventory() {
            const grid = document.getElementById('armorInventoryGrid'); grid.innerHTML = "";
            armorDB.forEach(a => {
                let div = document.createElement('div'); div.className = "inv-slot";
                let unlock = gameData.maxArmorLevel >= a.lv;
                if(!unlock) { div.classList.add('locked'); div.innerHTML = "ğŸ”’"; }
                else {
                    div.innerHTML = `<div class="slot-icon">${a.icon}</div><div class="slot-lv">Lv.${a.lv}</div>`;
                    div.onclick = () => { gameData.equippedArmorLevel = a.lv; renderArmorInventory(); updateUI(); };
                    if(gameData.equippedArmorLevel === a.lv) div.classList.add('selected');
                }
                grid.appendChild(div);
            });
        }

        // === ê¸°íƒ€ ===
        function attackMonster() {
            let dmg = calculateDamage(); gameData.coins += 100 + Math.floor(dmg / 10);
            log('battle', `ê³µê²©! ${dmg.toLocaleString()}`);
            document.getElementById('attackBtn').style.display = 'none'; document.getElementById('nextMonsterBtn').style.display = 'inline-block'; updateUI();
        }
        function goToRaidSelect() { changeScreen('raidSelectScreen'); }
        function attackRaidBoss() {
            if (raidHp <= 0) return;
            let dmg = calculateDamage(); raidHp -= dmg; if(raidHp < 0) raidHp = 0;
            // ë³´ìŠ¤ ë°ë¯¸ì§€
            let bossDmg = 1000;
            if(currentRaidType === 'reaper') bossDmg = 5000;
            if(currentRaidType === 'dagger') bossDmg = 20000;

            playerCurrentHp -= bossDmg; updateRaidUI(); log('raid', `${dmg.toLocaleString()} í”¼í•´!`);
            if (playerCurrentHp <= 0) { alert("ğŸ’€ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤..."); changeScreen('townScreen'); } else if (raidHp <= 0) { raidSuccess(); }
        }
        function drinkPotion() { if(gameData.potions>0){gameData.potions--; playerCurrentHp=playerMaxHp; updateRaidUI(); log('raid',"íšŒë³µ ì™„ë£Œ!"); updateUI();} }
        async function autoEnhance() {
            if(isAutoWeapon) return; isAutoWeapon = true; document.querySelector('.btn-auto').innerText = "â¹";
            while(isAutoWeapon && gameData.coins >= 100 && gameData.weaponLevel < 100) { enhanceWeapon(); await new Promise(r=>setTimeout(r, 50)); }
            isAutoWeapon = false; document.querySelector('.btn-auto').innerText = "âš¡ ì—°ì†ê°•í™”"; saveGame();
        }
        function updateUI() {
            document.getElementById('coinDisplay').innerText = Math.floor(gameData.coins).toLocaleString();
            document.getElementById('potionDisplay').innerText = gameData.potions;
            let wInfo = getCurrentDisplayWeapon();
            document.getElementById('townWeaponIcon').innerText = wInfo.icon;
            document.getElementById('weaponStatus').innerText = `Lv.${gameData.weaponLevel} ${wInfo.name}`;
            let aInfo = armorDB.find(a => a.lv === gameData.equippedArmorLevel) || armorDB[0];
            document.getElementById('townArmorIcon').innerText = aInfo.icon;
            document.getElementById('armorStatus').innerText = aInfo.name;
        }
        function updateRaidUI() {
            document.getElementById('raidHpBar').style.width = (raidHp / raidMaxHp)*100 + "%";
            document.getElementById('raidHpText').innerText = raidHp.toLocaleString();
            document.getElementById('playerHpBar').style.width = (playerCurrentHp / playerMaxHp)*100 + "%";
            document.getElementById('playerHpText').innerText = `${playerCurrentHp.toLocaleString()} / ${playerMaxHp.toLocaleString()}`;
        }
        function getCurrentDisplayWeapon() {
            if(gameData.equippedSkinName) {
                if(gameData.equippedSkinName==="ì ìë¦¬ì±„" && gameData.hasDragonflyNet) return {name:"ì ìë¦¬ì±„", icon:"ğŸ•¸ï¸"};
                if(gameData.equippedSkinName==="ì§€ì˜¥ì˜ í™œ" && gameData.hasHellBow) return {name:"ì§€ì˜¥ì˜ í™œ", icon:"ğŸ”¥"};
                if(gameData.equippedSkinName==="67 ë¬´ê¸°" && gameData.hasAdminWeapon) return {name:"67 ë¬´ê¸°", icon:"6ï¸âƒ£7ï¸âƒ£"};
                if(gameData.equippedSkinName==="ì‚¬ì‹ ì˜ ë‚«" && gameData.hasScythe) return {name:"ì‚¬ì‹ ì˜ ë‚«", icon:"ğŸ’€"};
                if(gameData.equippedSkinName==="ë“€ì–¼ ë‹¨ê²€" && gameData.hasDualDagger) return {name:"ë“€ì–¼ ë‹¨ê²€", icon:"âš”ï¸"};
                let f = weaponDB.find(w=>w.name===gameData.equippedSkinName);
                if(f && gameData.weaponLevel>=f.lv) return f;
            }
            for(let i=weaponDB.length-1; i>=0; i--) if(gameData.weaponLevel >= weaponDB[i].lv) return weaponDB[i];
            return weaponDB[0];
        }
        function toggleMode() { document.body.className = document.body.className==="mode-pc"?"mode-mobile":"mode-pc"; }
        function changeScreen(id) { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function log(t,m) { document.getElementById(t+"Log").innerText = m; }
        function goToField() { changeScreen('fieldScreen'); updateSkillButtons(); }
        function spawnMonster() {
            document.getElementById('attackBtn').style.display = 'inline-block'; document.getElementById('nextMonsterBtn').style.display = 'none';
            document.getElementById('monsterIcon').innerText = "â“"; document.getElementById('monsterInfo').innerText = "íƒìƒ‰ ì™„ë£Œ";
        }
        function chopWood() { gameData.coins+=500; updateUI(); log('forest',"+500 G"); }

        loadGame();
    </script>
</body>
</html>
