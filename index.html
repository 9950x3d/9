
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG v32: ê°•í™” í™•ë¥  80% ê³ ì •</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #050505;
            color: white;
            text-align: center;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            user-select: none;
            overflow: hidden;
        }
        
        /* === ğŸ“± ëª¨ë°”ì¼ ëª¨ë“œ CSS === */
        .game-container {
            margin-top: 50px; 
            background-color: #222; 
            width: 480px; 
            padding: 10px; 
            border-radius: 15px; 
            box-shadow: 0 0 25px rgba(0,0,0,0.8); 
            border: 2px solid #444; 
            max-height: 90vh; 
            overflow-y: auto; 
            transition: all 0.3s ease;
        }

        body.mode-mobile .game-container {
            width: 95%; height: 85vh; margin-top: 60px; font-size: 16px;
        }
        body.mode-mobile button { padding: 12px 5px; font-size: 14px; margin: 3px 1px; }
        body.mode-mobile .inv-slot { width: 50px; height: 50px; }
        body.mode-mobile h2 { font-size: 22px; margin-bottom: 10px; }

        .top-bar {
            width: 100%; background-color: #000; padding: 10px 0; display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 13px; font-weight: bold; box-shadow: 0 2px 10px rgba(255,255,255,0.1); position: fixed; top: 0; z-index: 100;
        }
        .res-coin { color: #f1c40f; } .res-potion { color: #e056fd; } .res-cube { color: #3498db; }
        .res-finger { color: #e74c3c; animation: beat 1s infinite; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        .btn-small { background: #555; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; color: white; font-size: 11px; }

        h2 { margin: 0 0 5px 0; color: #fff; border-bottom: 2px solid #555; padding-bottom: 5px; font-size: 18px;}
        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .equip-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 5px; }
        .equip-slot { display: flex; flex-direction: column; align-items: center; background: #333; padding: 5px; border-radius: 10px; border: 2px solid #666; width: 80px; }
        .big-icon { font-size: 40px; margin: 2px 0; transition: transform 0.1s; }
        .status { font-size: 12px; font-weight: bold; color: #ddd; }
        
        .log-box {
            background: #000; color: #0f0; padding: 5px; border-radius: 5px;
            font-size: 11px; height: 35px; display: flex; align-items: center; justify-content: center;
            margin-bottom: 5px; white-space: pre-line; border: 1px solid #333;
        }

        button { padding: 8px; font-size: 13px; border: none; border-radius: 6px; cursor: pointer; margin: 2px; font-weight: bold; width: 96%; transition: 0.1s; }
        button:active { transform: scale(0.96); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-enhance { background-color: #e67e22; color: white; }
        .btn-gacha-w { background-color: #d35400; color: white; border: 2px solid #e67e22; }
        .btn-gacha-a { background-color: #9b59b6; color: white; border: 2px solid #8e44ad; }
        .btn-auto { background-color: #34495e; color: #ddd; border: 1px solid #7f8c8d; font-size: 11px; }
        
        .btn-forest { background-color: #27ae60; color: white; }
        .btn-field { background-color: #c0392b; color: white; }
        .btn-raid { background-color: #c0392b; color: white; border: 2px solid #e74c3c; }
        
        .btn-reaper { background-color: #2c3e50; color: white; border: 2px solid #000; } 
        .btn-dagger { background-color: #34495e; color: #f1c40f; border: 2px solid #f1c40f; }
        .btn-hydra { background-color: #27ae60; color: white; border: 2px solid #2ecc71; }
        .btn-phoenix { background-color: #e67e22; color: white; border: 2px solid #d35400; box-shadow: 0 0 10px orangered; } 
        .btn-joker { background-color: #6a0dad; color: #00ff00; border: 2px solid #00ff00; }
        .btn-1x { background-color: #fff; color: #000; border: 2px solid #000; font-family: 'Courier New', monospace; font-weight: 900; } 
        .btn-gojo { background: linear-gradient(45deg, #000, #001f3f, #000); color: #00bfff; border: 2px solid #fff; box-shadow: 0 0 15px #00bfff; animation: glow 2s infinite alternate; }
        
        .btn-eat { background-color: #800000; color: #ffcccc; border: 1px solid #ff0000; animation: beat 2s infinite; display: none; }
        .btn-prison { background: #333; border: 2px solid #3498db; color: #3498db; box-shadow: 0 0 10px #3498db; display: none; }

        .btn-save { background-color: #2980b9; color: white; width: 48% !important; }
        .btn-reset { background-color: #c0392b; color: white; width: 48% !important; }
        .btn-town { background-color: #7f8c8d; color: white; }
        .btn-potion { background-color: #8e44ad; color: white; border: 1px solid #e056fd; }

        .skill-container { display: flex; justify-content: space-between; margin-bottom: 5px; gap: 2px; }
        .btn-skill { width: 24%; background-color: #333; border: 1px solid #aaa; color: #fff; font-size: 9px; position: relative; overflow: hidden; height: 35px; line-height: 1.1; }
        #skillV, #skillV_R { border-color: #a29bfe; color: #a29bfe; font-weight: bold; display: none; }
        .skill-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background-color: rgba(0,0,0,0.7); transition: height linear; }

        .code-area { margin-top: 5px; border-top: 1px solid #555; padding-top: 5px; }
        .input-code { padding: 8px; border-radius: 4px; border: none; width: 60%; margin-right: 5px; font-size: 14px; }
        .btn-code { background-color: #8e44ad; color: white; width: 30%; padding: 8px; font-size: 14px; }

        .inventory-box { background-color: #333; padding: 5px; border-radius: 8px; margin-top: 5px; border: 1px dashed #777; max-height: 100px; overflow-y: auto; }
        .inv-title { font-size: 11px; margin-bottom: 3px; text-align: left; color: #ddd; }
        .inv-grid { display: flex; flex-wrap: wrap; gap: 4px; justify-content: flex-start; }
        .inv-slot { width: 40px; height: 40px; background-color: #222; border: 2px solid #555; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .inv-slot.selected { border-color: #00bfff; background-color: #000; box-shadow: 0 0 5px #00bfff; }
        .inv-slot.locked { filter: grayscale(1); opacity: 0.3; cursor: not-allowed; }
        .slot-icon { font-size: 16px; }
        .slot-lv { font-size: 8px; color: #aaa; }

        .bar-container { width: 90%; background: #555; height: 20px; border-radius: 10px; margin: 5px auto; overflow: hidden; position: relative;}
        .hp-text { position: absolute; width: 100%; text-align: center; top: 0; font-size: 12px; line-height: 20px; text-shadow: 1px 1px 1px black; z-index: 2; color:white; }
        .boss-hp-bar { width: 100%; height: 100%; background: #e74c3c; transition: width 0.2s; }
        .player-hp-bar { width: 100%; height: 100%; background: #2ecc71; transition: width 0.2s; }

        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -2px); } 100% { transform: translate(1px, -2px); } }
        .shake { animation: shake 0.2s; }

        #rewardOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 200;
            display: none; justify-content: center; align-items: center;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }
        .reward-card {
            width: 280px; padding: 30px;
            background: linear-gradient(135deg, #1e1e1e, #000);
            border: 3px solid gold; border-radius: 20px;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
            text-align: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column; align-items: center;
        }
        .reward-icon { font-size: 100px; margin: 15px 0; animation: bounce 1s infinite alternate; text-shadow: 0 0 10px white; }
        .reward-text { color: #f1c40f; font-size: 24px; font-weight: bold; margin-bottom: 5px; text-shadow: 0 0 5px #000; }
        .reward-sub { color: #aaa; font-size: 14px; margin-bottom: 20px; }
        .btn-claim { background: linear-gradient(to right, #f1c40f, #e67e22); border: none; padding: 12px 20px; color: black; font-weight: bold; border-radius: 20px; cursor: pointer; width: 80%; font-size: 16px; box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4); transition: transform 0.1s; }
        .btn-claim:active { transform: scale(0.95); }

        @keyframes popIn { from { transform: scale(0) rotate(-10deg); opacity: 0; } to { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
    </style>
</head>
<body class="mode-pc">

    <div id="rewardOverlay">
        <div class="reward-card">
            <div class="reward-sub">CONGRATULATIONS!</div>
            <div class="reward-icon" id="rewardIcon">ğŸ</div>
            <div class="reward-text" id="rewardName">ì•„ì´í…œ</div>
            <button class="btn-claim" onclick="nextReward()">í™•ì¸</button>
        </div>
    </div>

    <div class="top-bar">
        <div class="res-coin">ğŸ’° <span id="coinDisplay">0</span></div>
        <div class="res-potion">ğŸ§ª <span id="potionDisplay">0</span></div>
        <div class="res-cube">ğŸ“¦ <span id="prisonDisplay">0</span></div>
        <div class="res-finger">ğŸ§Ÿ <span id="fingerDisplay">0</span></div>
        <button class="btn-small btn-mode" onclick="toggleMode()">ğŸ’»/ğŸ“± ëª¨ë“œ</button>
        <button class="btn-small" onclick="manualSave()">ğŸ’¾ ì €ì¥</button>
    </div>

    <div class="game-container">
        
        <div id="townScreen" class="screen active">
            <h2>ğŸ° ë§ˆì„ ê´‘ì¥</h2>
            <div class="equip-container">
                <div class="equip-slot">
                    <div class="big-icon" id="townWeaponIcon">ğŸ—¡ï¸</div>
                    <div class="status" id="weaponStatus">Lv.0</div>
                </div>
                <div class="equip-slot">
                    <div class="big-icon" id="townArmorIcon">ğŸ‘•</div>
                    <div class="status" id="armorStatus">ë§¨ëª¸</div>
                </div>
            </div>
            
            <div class="log-box" id="townLog">ê°•í™” í™•ë¥  80% ê³ ì •!</div>
            
            <button class="btn-eat" id="btnEatFinger" onclick="eatFinger()">ğŸ§Ÿ ìŠ¤ì¿ ë‚˜ ì†ê°€ë½ ì‚¼í‚¤ê¸° (DMG x2) ğŸ§Ÿ</button>

            <div style="display: flex; justify-content: center; width: 100%;">
                <button class="btn-enhance" style="width: 32%;" onclick="enhanceWeapon()">ğŸ”¨ ê°•í™” (í™•ë¥  80%)</button>
                <button class="btn-gacha-w" style="width: 32%;" onclick="gachaWeapon()">ğŸ—¡ï¸ ë¬´ê¸°ë½‘ê¸°(í™•ë¥ â†‘)</button>
                <button class="btn-auto" style="width: 32%;" onclick="autoEnhance()">âš¡ ì—°ì†ê°•í™”</button>
            </div>
            <div style="display: flex; justify-content: center; width: 100%; margin-top:2px;">
                <button class="btn-gacha-a" style="width: 48%;" onclick="gachaArmor(false)">ğŸ›¡ï¸ ë°©ì–´êµ¬ ë½‘ê¸° (5000G)</button>
                <button class="btn-auto" id="btnAutoArmor" style="width: 48%;" onclick="autoGachaArmor()">ğŸ”„ ë°©ì–´êµ¬ ì—°ì†</button>
            </div>
            <div style="display:flex; justify-content: space-between; margin-top:5px;">
                <button class="btn-forest" style="width:32%" onclick="changeScreen('forestScreen')">ğŸŒ² ìˆ²</button>
                <button class="btn-field" style="width:32%" onclick="goToField()">ğŸ‘¹ ì‚¬ëƒ¥í„°</button>
                <button class="btn-raid" style="width:32%" onclick="goToRaidSelect()">ğŸ”¥ ë ˆì´ë“œ</button>
            </div>
            <div style="display:flex; justify-content: center; margin-top:5px;">
                <button class="btn-save" onclick="manualSave()">ğŸ’¾ ì €ì¥</button>
                <button class="btn-reset" onclick="resetGame()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
            </div>
            <div class="inventory-box">
                <div class="inv-title">ğŸ’ ë¬´ê¸° ì¸ë²¤í† ë¦¬ (í„°ì¹˜í•˜ì—¬ ì¥ì°©)</div>
                <div class="inv-grid" id="weaponInventoryGrid"></div>
            </div>
            <div class="inventory-box">
                <div class="inv-title">ğŸ›¡ï¸ ë°©ì–´êµ¬ ì¸ë²¤í† ë¦¬</div>
                <div class="inv-grid" id="armorInventoryGrid"></div>
            </div>
            <div class="code-area">
                <input type="text" id="codeInput" class="input-code" placeholder="ì½”ë“œ ì…ë ¥ (gg: ì†ê°€ë½ 5ê°œ)">
                <button class="btn-code" onclick="useCode()">ì…ë ¥</button>
            </div>
        </div>

        <div id="raidSelectScreen" class="screen">
            <h2>ğŸ”¥ ë ˆì´ë“œ ì„ íƒ</h2>
            <div class="log-box">ê³ ì£  ì‚¬í† ë£¨ vs ìŠ¤ì¿ ë‚˜ì˜ ëŒ€ê²°</div>
            <div style="display:flex; flex-wrap:wrap; justify-content:center;">
                <button class="btn-raid" onclick="startRaid('hell')">ğŸ”¥ ì§€ì˜¥ì˜ íŒŒìˆ˜ê¾¼</button>
                <button class="btn-reaper" onclick="startRaid('reaper')">ğŸ’€ ì‚¬ì‹ </button>
                <button class="btn-dagger" onclick="startRaid('dagger')">âš”ï¸ ë“€ì–¼ ë‹¨ê²€</button>
                <button class="btn-hydra" onclick="startRaid('hydra')">ğŸ‰ íˆë“œë¼</button>
                <button class="btn-phoenix" onclick="startRaid('phoenix')">ğŸ¦… ë¶ˆì‚¬ì¡°</button>
                <button class="btn-joker" onclick="startRaid('joker')">ğŸ¤¡ ì¡°ì»¤</button>
                <button class="btn-1x" onclick="startRaid('1x1x1x1')">ğŸ”³ 1x1x1x1</button> 
                <button class="btn-gojo" onclick="startRaid('gojo')">ğŸ¤ ê³ ì£  ì‚¬í† ë£¨</button>
            </div>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸ”™ ëŒì•„ê°€ê¸°</button>
        </div>

        <div id="forestScreen" class="screen">
            <h2>ğŸŒ² ì‹ ë¹„í•œ ìˆ²</h2>
            <div class="big-icon">ğŸª“</div>
            <div class="log-box" id="forestLog">ë‚˜ë¬´ë¥¼ ìºì„œ ëˆì„ ë²„ì„¸ìš”.</div>
            <button class="btn-forest" id="chopBtn" onclick="chopWood()">ğŸª“ ë‚˜ë¬´ ë² ê¸°</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸ° ë§ˆì„ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <div id="fieldScreen" class="screen">
            <h2>â˜ ï¸ ìœ„í—˜í•œ ì‚¬ëƒ¥í„°</h2>
            <div class="big-icon" id="monsterIcon">â“</div>
            <div class="status" id="monsterInfo">íƒìƒ‰ ì¤‘...</div>
            <div class="log-box" id="battleLog">ì•¼ìƒì˜ ëª¬ìŠ¤í„°ê°€ ë‚˜íƒ€ë‚¬ë‹¤!</div>
            <div class="skill-container" id="battleSkills"></div>
            <button class="btn-field" id="attackBtn" onclick="attackMonster()">âš”ï¸ ê³µê²©í•˜ê¸°</button>
            <button class="btn-field" id="nextMonsterBtn" onclick="spawnMonster()" style="display:none;">ğŸ” ë‹¤ìŒ ëª¬ìŠ¤í„°</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸƒ ë„ë§ê°€ê¸°</button>
        </div>

        <div id="raidScreen" class="screen">
            <h2 id="raidTitle">ğŸ”¥ ë ˆì´ë“œ</h2>
            <div class="big-icon" id="raidBossIcon">ğŸ‘¿</div>
            
            <div style="font-size:12px; text-align:left; margin-left:20px;">ğŸ‘¿ BOSS HP</div>
            <div class="bar-container">
                <div class="boss-hp-bar" id="raidHpBar"></div>
                <div class="hp-text" id="raidHpText">100 / 100</div>
            </div>

            <div style="font-size:12px; text-align:left; margin-left:20px; margin-top:5px;">â¤ï¸ MY HP</div>
            <div class="bar-container">
                <div class="player-hp-bar" id="playerHpBar"></div>
                <div class="hp-text" id="playerHpText">1000 / 1000</div>
            </div>

            <div class="log-box" id="raidLog">ì „íˆ¬ ì‹œì‘!</div>
            <div class="skill-container" id="raidSkills"></div>

            <button class="btn-raid" id="btnRaidAttack" onclick="attackRaidBoss()">ğŸ¹ ë³´ìŠ¤ ê³µê²©í•˜ê¸°</button>
            <button class="btn-prison" id="btnPrisonRealm" onclick="usePrisonRealm()">ğŸ“¦ ì˜¥ë¬¸ê°• ë´‰ì¸ (ì¦‰ì‹œ ì²˜ì¹˜)</button>
            
            <button class="btn-potion" onclick="drinkPotion()">ğŸ§ª ë¬¼ì•½ (HP íšŒë³µ)</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸƒ ë„ë§ê°€ê¸°</button>
        </div>

    </div>

    <script>
        // === ğŸ’¾ ë°ì´í„° ===
        let gameData = {
            coins: 0,
            weaponLevel: 0,
            maxArmorLevel: 0, 
            equippedArmorLevel: 0,
            potions: 5,
            prisonRealm: 0, 
            sukunaFingers: 0,
            eatenFingers: 0,
            
            hasHellBow: false, hasDragonflyNet: false, hasAdminWeapon: false, hasScythe: false, hasDualDagger: false,
            hasHydraStaff: false, hasHydraAxe: false, hasHydraAnchor: false, hasHydraSword: false,
            hasPhoenixWing: false, hasJokerCard: false,
            has1xSword: false, has1xBow: false, has1xComputer: false, has1xCrown: false,
            hasGojoBlindfold: false,
            hasSukunaFinger: false, 
            
            equippedSkinName: null
        };

        let playerCurrentHp = 1000;
        let playerMaxHp = 1000;
        let raidHp = 10000000;
        let raidMaxHp = 10000000;
        let currentRaidType = 'hell';
        
        let skillCD = { Z: 0, X: 0, C: 0, V: 0 };
        const MAX_CD = { Z: 5000, X: 10000, C: 20000, V: 60000 };
        let isAutoWeapon = false;
        let isAutoArmor = false;

        // ğŸ”¥ ë¬´ê¸° DB ëŒ€ê±° í™•ì¥ (200 ~ 490 êµ¬ê°„ ì¶”ê°€)
        const weaponDB = [
            { lv: 0, name: "ë‚¡ì€ ê²€", icon: "ğŸ—¡ï¸" }, { lv: 10, name: "ê³¨ë“œë°”", icon: "ğŸ§ˆ" }, { lv: 20, name: "ì‹ í™”ì˜ í™œ", icon: "ğŸ¹" },
            { lv: 35, name: "ë„ˆí´", icon: "ğŸ‘Š" }, { lv: 50, name: "í™”ì—¼ë°©ì‚¬ê¸°", icon: "ğŸ”¥" }, { lv: 65, name: "ë¯¸ë‹ˆê±´", icon: "ğŸš" },
            { lv: 70, name: "ë±€íŒŒì´ì–´ ì´ë¹¨", icon: "ğŸ§›" }, { lv: 75, name: "ë¡œë´‡ íŒ”", icon: "ğŸ¤–" }, { lv: 80, name: "ì•ŒëŒ ì‹œê³„", icon: "â°" },
            { lv: 90, name: "ê´‘ì„ ê²€", icon: "ğŸ”¦" }, { lv: 100, name: "ì¹¼ëŒë¹—", icon: "ğŸŒ™" },
            { lv: 110, name: "ë§ˆë²•ë´‰", icon: "ğŸª„" }, { lv: 120, name: "í¡í˜ˆ ë°•ì¥", icon: "ğŸ¦‡" }, { lv: 130, name: "ì±„ì°", icon: "ğŸ§¶" }, { lv: 140, name: "ìì„", icon: "ğŸ§²" },
            { lv: 150, name: "ê±°ë¯¸ì¤„", icon: "ğŸ•¸ï¸" }, { lv: 160, name: "ëŒ€ëª»", icon: "ğŸ“Œ" }, { lv: 170, name: "ë‚šì‹œëŒ€", icon: "ğŸ£" },
            { lv: 180, name: "ì¹´íƒ€ë‚˜", icon: "âš”ï¸" }, { lv: 190, name: "í‘œì°½", icon: "ğŸ’ " }, { lv: 195, name: "ì¹´ë©”ë¼", icon: "ğŸ“¸" },
            { lv: 200, name: "ì €ê²©ì†Œì´", icon: "ğŸ”«" },
            
            // ğŸ†• 200 ~ 490 êµ¬ê°„ ì¶”ê°€
            { lv: 210, name: "ë ˆì´ì € í¬", icon: "ğŸ”«" },
            { lv: 230, name: "í† ë¥´ì˜ ë§ì¹˜", icon: "ğŸ”¨" },
            { lv: 250, name: "ì–‘ì ê²€", icon: "ğŸ—¡ï¸" },
            { lv: 280, name: "ë°ìŠ¤ ë…¸íŠ¸", icon: "ğŸ““" },
            { lv: 300, name: "ì—‘ìŠ¤ì¹¼ë¦¬ë²„", icon: "âš”ï¸" },
            { lv: 330, name: "í•µë¯¸ì‚¬ì¼", icon: "ğŸš€" },
            { lv: 360, name: "íƒ€ë…¸ìŠ¤ ì¥ê°‘", icon: "ğŸ§¤" },
            { lv: 400, name: "í–‰ì„± íŒŒê´´ì", icon: "ğŸª" },
            { lv: 440, name: "ë¸”ë™í™€ ìƒì„±ê¸°", icon: "âš«" },
            { lv: 480, name: "ì°¨ì› ì ˆë‹¨ê¸°", icon: "ğŸŒ€" },
            { lv: 490, name: "ë°˜ì „ ìˆ ì‹", icon: "ğŸ”„" }
        ];

        const armorDB = [
            { lv: 0, name: "ë§¨ëª¸", icon: "ğŸ‘•", hp: 1000 }, { lv: 10, name: "ì¼ë°˜ ê°‘ì˜·", icon: "ğŸ§¥", hp: 5000 }, { lv: 20, name: "ì²  ê°‘ì˜·", icon: "ğŸ›¡ï¸", hp: 20000 },
            { lv: 30, name: "ë‹¤ì´ì•„ ê°‘ì˜·", icon: "ğŸ’", hp: 100000 }, { lv: 40, name: "ì—ë©”ë„ë“œ ê°‘ì˜·", icon: "â‡ï¸", hp: 500000 }, { lv: 50, name: "ì‹ ì˜ ê°‘ì˜·", icon: "ğŸ‘¼", hp: 2000000 },
            { lv: 60, name: "ê´´ë¬¼ì˜ ê°€ì£½", icon: "ğŸ‘¹", hp: 5000000 }, { lv: 70, name: "ì§€ì˜¥ì˜ ê°‘ì£¼", icon: "ğŸ”¥", hp: 10000000 }, { lv: 100, name: "ì‚¬ì´ë³´ê·¸ ê°‘ì˜·", icon: "ğŸ¤–", hp: 50000000 },
            { lv: 110, name: "ì™¸ê³„ì¸ ê°‘ì˜·", icon: "ğŸ‘½", hp: 200000000 }, { lv: 120, name: "ë¶ˆ ê°‘ì˜·", icon: "ğŸ”¥", hp: 500000000 }, { lv: 130, name: "ë¬¼ ê°‘ì˜·", icon: "ğŸ’§", hp: 1000000000 }, { lv: 140, name: "ì „ê¸° ê°‘ì˜·", icon: "âš¡", hp: 2000000000 },
            { lv: 150, name: "ë¸”ë™í™€ ê°‘ì˜·", icon: "ğŸŒŒ", hp: 50000000000 }
        ];

        const monsters = [
            { level: 0, name: "ìŠ¬ë¼ì„", icon: "ğŸ’§", reward: 50 }, { level: 30, name: "ìŠ¤ì¼ˆë ˆí†¤", icon: "ğŸ’€", reward: 1500 }, { level: 80, name: "í¬ë¼ì¼„", icon: "ğŸ¦‘", reward: 50000 }, 
            { level: 120, name: "ìš°ì£¼ê´´ë¬¼", icon: "ğŸ‘¾", reward: 500000 }, { level: 160, name: "ê³ ëŒ€ ê±°ë¯¸", icon: "ğŸ•·ï¸", reward: 1500000 },
            { level: 180, name: "ì‚¬ë¬´ë¼ì´", icon: "ğŸ¤º", reward: 3000000 }, { level: 200, name: "ì ˆëŒ€ì‹ ", icon: "ğŸ‘‘", reward: 10000000 },
            { level: 400, name: "ì°¨ì› í¬ì‹ì", icon: "ğŸª", reward: 50000000 }
        ];

        // === ì‹œìŠ¤í…œ ===
        function saveGame() { localStorage.setItem("rpg_v31_save", JSON.stringify(gameData)); }
        function manualSave() { saveGame(); alert("ì €ì¥ ì™„ë£Œ!"); }
        function loadGame() {
            const saved = localStorage.getItem("rpg_v31_save");
            if(saved) {
                let parsed = JSON.parse(saved);
                if(parsed.armorLevel !== undefined && parsed.maxArmorLevel === undefined) { parsed.maxArmorLevel = parsed.armorLevel; parsed.equippedArmorLevel = parsed.armorLevel; }
                gameData = { ...gameData, ...parsed };
            }
            if(isNaN(gameData.coins)) gameData.coins = 0;
            if(isNaN(gameData.weaponLevel)) gameData.weaponLevel = 0;
            if(isNaN(gameData.potions)) gameData.potions = 5;
            if(isNaN(gameData.prisonRealm)) gameData.prisonRealm = 0;
            if(isNaN(gameData.sukunaFingers)) gameData.sukunaFingers = 0;
            if(isNaN(gameData.eatenFingers)) gameData.eatenFingers = 0;
            
            renderWeaponInventory(); renderArmorInventory(); updateUI();
        }
        function resetGame() { if(confirm("ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.removeItem("rpg_v31_save"); location.reload(); } }
        setInterval(saveGame, 10000);

        function useCode() {
            const input = document.getElementById('codeInput').value.trim();
            if (input === 'dlalsgh1215') { gameData.coins += 10000000000; queueReward("100ì–µ ì½”ì¸", "ğŸ’°"); }
            else if (input === 'yyyuy') { gameData.prisonRealm += 10; queueReward("ì˜¥ë¬¸ê°• 10ê°œ", "ğŸ“¦"); }
            else if (input === 'gg100k') { if(!gameData.hasDragonflyNet) { gameData.hasDragonflyNet=true; queueReward("ì ìë¦¬ì±„", "ğŸ•¸ï¸"); renderWeaponInventory(); } }
            else if (input === '67') { if(!gameData.hasAdminWeapon) { gameData.hasAdminWeapon=true; queueReward("67 ë¬´ê¸°", "6ï¸âƒ£7ï¸âƒ£"); renderWeaponInventory(); } }
            // ì‹ ê·œ ì½”ë“œ: gg
            else if (input === 'gg') { 
                gameData.sukunaFingers += 5; 
                if(!gameData.hasSukunaFinger) {
                    gameData.hasSukunaFinger = true;
                    queueReward("ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½(ë¬´ê¸°)", "ğŸ§Ÿ");
                }
                queueReward("ì†ê°€ë½ 5ê°œ", "ğŸ§Ÿ");
                renderWeaponInventory();
            }
            else { alert("âŒ í‹€ë¦° ì½”ë“œì…ë‹ˆë‹¤."); }
            document.getElementById('codeInput').value = ""; saveGame(); updateUI();
        }

        // === ìŠ¤ì¿ ë‚˜ ì†ê°€ë½ ì„­ì·¨ ì‹œìŠ¤í…œ ===
        function eatFinger() {
            if(gameData.sukunaFingers > 0) {
                gameData.sukunaFingers--;
                gameData.eatenFingers++;
                log('town', `ğŸ§Ÿ ê¿€êº½.. í˜ì´ ì†Ÿì•„ë‚œë‹¤! (ë°ë¯¸ì§€ x${Math.pow(2, gameData.eatenFingers).toLocaleString()})`);
                updateUI();
                saveGame();
            } else {
                alert("ë¨¹ì„ ì†ê°€ë½ì´ ì—†ìŠµë‹ˆë‹¤!");
            }
        }

        // === ğŸ ë³´ìƒ í ì‹œìŠ¤í…œ ===
        let rewardQueue = [];
        let isShowingReward = false;

        function queueReward(name, icon) {
            rewardQueue.push({name, icon});
            if(!isShowingReward) showNextReward();
        }

        function showNextReward() {
            if(rewardQueue.length === 0) {
                isShowingReward = false;
                document.getElementById('rewardOverlay').style.display = 'none';
                if(document.getElementById('raidScreen').classList.contains('active') && raidHp <= 0) {
                    changeScreen('townScreen');
                }
                return;
            }

            isShowingReward = true;
            let reward = rewardQueue.shift();
            document.getElementById('rewardName').innerText = reward.name;
            document.getElementById('rewardIcon').innerText = reward.icon;
            document.getElementById('rewardOverlay').style.display = 'flex';
        }

        function nextReward() {
            showNextReward();
        }

        // === ë°ë¯¸ì§€ ê³„ì‚° ===
        function calculateDamage() {
            let weapon = getCurrentDisplayWeapon();
            let tierBonus = 0;
            
            // Lv.500 ìŠ¤ì¿ ë‚˜ ì†ê°€ë½ (ê³ ì£ ê¸‰ ì‚¬ê¸° ë¬´ê¸°)
            if(weapon.name === "ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½") tierBonus = 100000000000; // 1000ì–µ
            else if(weapon.name === "ë°˜ì „ ìˆ ì‹") tierBonus = 80000000000;
            else if(weapon.name === "ì°¨ì› ì ˆë‹¨ê¸°") tierBonus = 70000000000;
            else if(weapon.name === "ë¸”ë™í™€ ìƒì„±ê¸°") tierBonus = 60000000000;
            else if(weapon.name === "ê²€ì€ ì•ˆëŒ€") tierBonus = 50000000; 
            else if(weapon.name === "1x1x1x ì™•ê´€") tierBonus = 45000000;
            else if(weapon.name === "1x ê²€" || weapon.name === "1x í™œ" || weapon.name === "1x ì»´í“¨í„°") tierBonus = 40000000;
            else if(weapon.name === "ì¡°ì»¤ ì¹´ë“œ") tierBonus = 30000000; 
            else if(weapon.name === "ë¶ˆì‚¬ì¡° ê¹ƒí„¸") tierBonus = 25000000;
            
            let base = (gameData.weaponLevel * 200) + tierBonus + 100;
            
            // ğŸ”¥ ì†ê°€ë½ ì„­ì·¨ ë°°ìˆ˜ ì ìš© (2ì˜ nìŠ¹)
            if(gameData.eatenFingers > 0) {
                base = base * Math.pow(2, gameData.eatenFingers);
            }

            let finalDmg = base;
            
            const now = Date.now();
            let skills = getWeaponSkillInfo();
            let activeSkill = null;
            if (now - (skillCD.V - MAX_CD.V) < 1000) activeSkill = skills.V;
            else if (now - (skillCD.C - MAX_CD.C) < 1000) activeSkill = skills.C;
            else if (now - (skillCD.X - MAX_CD.X) < 1000) activeSkill = skills.X;
            else if (now - (skillCD.Z - MAX_CD.Z) < 1000) activeSkill = skills.Z;

            if (activeSkill) {
                if (currentRaidType === 'gojo' && activeSkill.fixed >= 99999999) finalDmg = base * 10000; 
                else if (activeSkill.fixed) finalDmg = activeSkill.fixed;
                else finalDmg = base * activeSkill.mult;
            }

            if (isNaN(finalDmg) || finalDmg < 1) finalDmg = 1; 
            return Math.floor(finalDmg);
        }

        // === ë ˆì´ë“œ ë¡œì§ ===
        function goToRaidSelect() { changeScreen('raidSelectScreen'); }
        function startRaid(type) {
            currentRaidType = type;
            let armor = armorDB.find(a => a.lv === gameData.equippedArmorLevel) || armorDB[0];
            playerMaxHp = armor.hp; playerCurrentHp = playerMaxHp; 

            document.getElementById('btnPrisonRealm').style.display = 'none';

            if (type === 'hell') { raidMaxHp = 10000000; document.getElementById('raidTitle').innerText = "ğŸ”¥ ì§€ì˜¥ì˜ íŒŒìˆ˜ê¾¼"; document.getElementById('raidBossIcon').innerText = "ğŸ‘¿"; } 
            else if (type === 'reaper') { raidMaxHp = 50000000; document.getElementById('raidTitle').innerText = "ğŸ’€ ì‚¬ì‹ "; document.getElementById('raidBossIcon').innerText = "ğŸ’€"; }
            else if (type === 'dagger') { raidMaxHp = 200000000; document.getElementById('raidTitle').innerText = "âš”ï¸ ì•”ì‚´ì ë§ˆìŠ¤í„°"; document.getElementById('raidBossIcon').innerText = "âš”ï¸"; }
            else if (type === 'hydra') { raidMaxHp = 500000000; document.getElementById('raidTitle').innerText = "ğŸ‰ íˆë“œë¼"; document.getElementById('raidBossIcon').innerText = "ğŸ‰"; }
            else if (type === 'phoenix') { raidMaxHp = 5000000000; document.getElementById('raidTitle').innerText = "ğŸ¦… ë¶ˆì‚¬ì¡°"; document.getElementById('raidBossIcon').innerText = "ğŸ¦…"; }
            else if (type === 'joker') { raidMaxHp = 50000000000; document.getElementById('raidTitle').innerText = "ğŸ¤¡ ì¡°ì»¤"; document.getElementById('raidBossIcon').innerText = "ğŸ¤¡"; }
            else if (type === '1x1x1x1') { raidMaxHp = 100000000000; document.getElementById('raidTitle').innerText = "ğŸ”³ 1x1x1x1 ì°¨ì›"; document.getElementById('raidBossIcon').innerText = "ğŸ”³"; } 
            else if (type === 'gojo') { 
                raidMaxHp = 500000000000; 
                document.getElementById('raidTitle').innerText = "ğŸ¤ ê³ ì£  ì‚¬í† ë£¨"; 
                document.getElementById('raidBossIcon').innerText = "ğŸ¤";
                document.getElementById('btnPrisonRealm').style.display = 'inline-block'; 
                document.getElementById('btnPrisonRealm').innerText = `ğŸ“¦ ì˜¥ë¬¸ê°• ë´‰ì¸ (${gameData.prisonRealm}ê°œ)`;
            } 
            
            raidHp = raidMaxHp; updateSkillButtons(); changeScreen('raidScreen'); updateRaidUI(); log('raid', `ë ˆì´ë“œ ì‹œì‘!`);
        }

        function usePrisonRealm() {
            if (currentRaidType !== 'gojo') return;
            if (gameData.prisonRealm > 0) {
                gameData.prisonRealm--;
                raidHp = 0;
                log('raid', "ğŸ“¦ ì˜¥ë¬¸ê°• ê°œë¬¸! ê³ ì£  ì‚¬í† ë£¨ ë´‰ì¸!");
                document.getElementById('btnPrisonRealm').innerText = `ğŸ“¦ ì˜¥ë¬¸ê°• ë´‰ì¸ (${gameData.prisonRealm}ê°œ)`;
                updateRaidUI();
                raidSuccess();
            } else {
                alert("ì˜¥ë¬¸ê°•ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (ì½”ë“œ: yyyuy)");
            }
        }

        function attackRaidBoss() {
            if (playerCurrentHp <= 0) { playerCurrentHp = playerMaxHp; updateRaidUI(); }
            if (raidHp <= 0) return;

            let dmg = calculateDamage(); 
            if (dmg === Infinity) raidHp = 0; else raidHp -= dmg; 
            if(raidHp < 0) raidHp = 0;

            let weapon = getCurrentDisplayWeapon();
            if (weapon.name.includes("íˆë“œë¼") || weapon.name.includes("ìŠ¤ì¿ ë‚˜")) { 
                let lifesteal = Math.floor(dmg * 0.05); if(lifesteal > 0) { playerCurrentHp += lifesteal; if(playerCurrentHp > playerMaxHp) playerCurrentHp = playerMaxHp; }
            }

            let bossIcon = document.getElementById('raidBossIcon'); bossIcon.classList.remove('shake'); void bossIcon.offsetWidth; bossIcon.classList.add('shake');
            let bossDmg = 1000;
            if(currentRaidType === 'reaper') bossDmg = 5000; if(currentRaidType === 'dagger') bossDmg = 20000;
            if(currentRaidType === 'hydra') bossDmg = 100000; 
            if(currentRaidType === 'phoenix') bossDmg = 300000; 
            if(currentRaidType === 'joker') bossDmg = 500000;
            if(currentRaidType === '1x1x1x1') bossDmg = 1000000000; 
            if(currentRaidType === 'gojo') bossDmg = 100000000;

            playerCurrentHp -= bossDmg; if(playerCurrentHp < 0) playerCurrentHp = 0;
            updateRaidUI(); 
            let logMsg = `ê³µê²©! ${dmg === Infinity ? "MAX" : dmg.toLocaleString()}`;
            log('raid', logMsg);

            if (playerCurrentHp <= 0) { log('raid', "ğŸ’€ ì‚¬ë§!"); } 
            else if (raidHp <= 0) { raidSuccess(); }
        }

        function raidSuccess() {
            let rewardCoin = 0;
            if (currentRaidType === 'hell') rewardCoin = 5000000;
            else if (currentRaidType === 'reaper') rewardCoin = 10000000;
            else if (currentRaidType === 'dagger') rewardCoin = 30000000;
            else if (currentRaidType === 'hydra') rewardCoin = 50000000;
            else if (currentRaidType === 'phoenix') rewardCoin = 80000000; 
            else if (currentRaidType === 'joker') rewardCoin = 100000000;
            else if (currentRaidType === '1x1x1x1') rewardCoin = 300000000; 
            else if (currentRaidType === 'gojo') rewardCoin = 500000000;

            gameData.coins += rewardCoin;
            queueReward(`${(rewardCoin / 10000).toLocaleString()}ë§Œ G`, "ğŸ’°");
            
            if (currentRaidType === 'hell' && Math.random()<0.7 && !gameData.hasHellBow) { 
                gameData.hasHellBow=true; queueReward("ì§€ì˜¥ì˜ í™œ", "ğŸ”¥"); 
            } 
            else if (currentRaidType === 'gojo') {
                if(Math.random()<0.6 && !gameData.hasGojoBlindfold) { 
                    gameData.hasGojoBlindfold=true; queueReward("ê²€ì€ ì•ˆëŒ€", "ğŸ•¶ï¸"); 
                }
                if(Math.random()<0.5) {
                    gameData.sukunaFingers++;
                    queueReward("ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½", "ğŸ§Ÿ");
                    if(!gameData.hasSukunaFinger) { gameData.hasSukunaFinger=true; queueReward("ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½(ë¬´ê¸°)", "ğŸ§Ÿ"); }
                }
            }
            
            renderWeaponInventory();
            saveGame();
        }

        function gachaWeapon() {
            const COST = 50000;
            if (gameData.coins < COST) { log('town', "ëˆ ë¶€ì¡±"); return; }
            if (gameData.weaponLevel >= 490) { log('town', "ì¤€ ì¢…ê²°ê¸‰!"); return; } 
            gameData.coins -= COST;
            let roll = Math.random() * 100;
            let resultLv = 0;
            
            if (roll < 5) resultLv = 80 + Math.floor(Math.random()*20);
            else if (roll < 30) resultLv = 120 + Math.floor(Math.random()*40);
            else if (roll < 70) resultLv = 160 + Math.floor(Math.random()*40);
            else if (roll < 95) resultLv = 200 + Math.floor(Math.random()*100); 
            else if (roll < 99) resultLv = 300 + Math.floor(Math.random()*100); 
            else resultLv = 400 + Math.floor(Math.random()*90); 

            if (resultLv > 499) resultLv = 499; 
            
            if (resultLv > gameData.weaponLevel) { 
                gameData.weaponLevel = resultLv; 
                queueReward(`Lv.${resultLv} ë¬´ê¸°`, "âœ¨");
                renderWeaponInventory(); 
            } else { 
                log('town', `..Lv.${resultLv}`); 
            }
            updateUI();
        }

        // ğŸ”¥ ê°•í™” í™•ë¥  80% ê³ ì •
        function enhanceWeapon() {
            if(gameData.coins < 100) return log('town', "ëˆ ë¶€ì¡±!"); gameData.coins -= 100;
            
            // ëª¨ë“  êµ¬ê°„ 80% ê³ ì •
            let rate = 80;

            if (gameData.weaponLevel >= 499) { log('town', "ìµœê³  ë ˆë²¨ ë„ë‹¬!"); return; }

            if(Math.random()*100 < rate) { gameData.weaponLevel++; log('town', "ê°•í™” ì„±ê³µ!"); renderWeaponInventory(); } 
            else { if(gameData.weaponLevel>0) gameData.weaponLevel--; log('town', "ì‹¤íŒ¨! (-1)"); } 
            updateUI();
        }

        // === ğŸ”¥ ìŠ¤í‚¬ ì‹œìŠ¤í…œ ===
        function getWeaponSkillInfo() {
            let weapon = getCurrentDisplayWeapon();
            let name = weapon.name;
            
            if (name === "ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½") return { Z:{name:"ğŸ”ª í•´(Cleave)", mult:200000}, X:{name:"ğŸ•¸ï¸ íŒ”(Dismantle)", mult:500000}, C:{name:"ğŸ”¥ í‘¸ê°€(Fire)", mult:9999999}, V:{name:"ğŸ¯ ë³µë§ˆì–´ì£¼ì", mult:0, fixed:Infinity} };

            if (name === "ê²€ì€ ì•ˆëŒ€") return { Z:{name:"ğŸ”´ ì•„ì¹´", mult:5000}, X:{name:"ğŸ”µ ì•„ì˜¤", mult:5000}, C:{name:"ğŸŸ£ ë¬´ë¼ì‚¬í‚¤", mult:99999}, V:{name:"ğŸ¤ ë¬´ëŸ‰ê³µì²˜", mult:0, fixed:Infinity} };
            if (name === "ì ìë¦¬ì±„") return { Z: { name: "ğŸŒŒ ë¸”ë™í™€", mult: 0, fixed: 99999999 }, X: { name: "ğŸ’« ë¶•ê´´", mult: 500 }, C: { name: "âŒ ì‚­ì œ", mult: 1000 }, V: { name: "ğŸ•·ï¸ í¬íš", mult: 2000 } };
            
            if (name === "1x1x1x ì™•ê´€") return { Z:{name:"ğŸ‘‘ ëª…ë ¹", mult:50000}, X:{name:"ğŸ° ì†Œí™˜", mult:80000}, C:{name:"ğŸŒ ì§€ë°°", mult:500000}, V:{name:"ğŸ›‘ ì •ì§€", mult:0, fixed:Infinity} };
            if (name === "1x ê²€") return { Z:{name:"âš”ï¸ ë² ê¸°", mult:10000}, X:{name:"ğŸŒªï¸ íšŒì „", mult:20000}, C:{name:"ğŸ—¡ï¸ ì ˆë‹¨", mult:400000} };

            return { Z:{name:"âš¡ ê°•íƒ€", mult:5}, X:{name:"âš”ï¸ ì—°íƒ€", mult:10}, C:{name:"ğŸ’¢ í­ì£¼", mult:20} };
        }

        function updateSkillButtons() {
            const skills = getWeaponSkillInfo();
            const skillHTML = (suffix) => `
                <button class="btn-skill" onclick="useSkill('Z')">${skills.Z.name} (Z)<div class="skill-overlay" id="cdZ${suffix}"></div></button>
                <button class="btn-skill" onclick="useSkill('X')">${skills.X.name} (X)<div class="skill-overlay" id="cdX${suffix}"></div></button>
                <button class="btn-skill" onclick="useSkill('C')">${skills.C.name} (C)<div class="skill-overlay" id="cdC${suffix}"></div></button>
                <button class="btn-skill" id="skillV${suffix}" onclick="useSkill('V')" style="display:${skills.V ? 'block' : 'none'}">${skills.V ? skills.V.name + ' (V)' : ''}<div class="skill-overlay" id="cdV${suffix}"></div></button>
            `;
            document.getElementById('battleSkills').innerHTML = skillHTML('');
            document.getElementById('raidSkills').innerHTML = skillHTML('_R');
        }

        function useSkill(key) {
            const now = Date.now(); if (now < skillCD[key]) return; skillCD[key] = now + MAX_CD[key];
            const ids = [`cd${key}`, `cd${key}_R`]; ids.forEach(id => { const el=document.getElementById(id); if(el){el.style.height="100%";el.offsetHeight;el.style.transition=`height ${MAX_CD[key]}ms linear`;el.style.height="0%";}});
            let skills = getWeaponSkillInfo(); log(document.getElementById('raidScreen').classList.contains('active') ? 'raid' : 'battle', `${skills[key].name} ë°œë™!`);
        }

        function drinkPotion() { if(gameData.potions>0){gameData.potions--; playerCurrentHp=playerMaxHp; updateRaidUI(); log('raid',"íšŒë³µ ì™„ë£Œ!"); updateUI();} else { log('raid', "ë¬¼ì•½ì´ ì—†ìŠµë‹ˆë‹¤!"); } }
        function gachaArmor(isAutoMode = false) {
            const COST = 5000; if (gameData.coins < COST) { if(!isAutoMode) log('town', "ëˆ ë¶€ì¡±"); return false; } if (gameData.maxArmorLevel >= 150) { if(!isAutoMode) log('town', "ìµœê°• ë°©ì–´êµ¬!"); return false; }
            gameData.coins -= COST; if (Math.random() * 100 < 50) { let currentIdx = armorDB.findIndex(a => a.lv === gameData.maxArmorLevel); if (currentIdx < armorDB.length - 1) { let nextArmor = armorDB[currentIdx + 1]; gameData.maxArmorLevel = nextArmor.lv; gameData.equippedArmorLevel = nextArmor.lv; log('town', `ğŸ‰ ìŠ¹ê¸‰! [${nextArmor.name}]`); renderArmorInventory(); updateUI(); } } else { if(!isAutoMode) log('town', "ê½..."); } updateUI(); return true;
        }
        async function autoGachaArmor() { if(isAutoArmor) { isAutoArmor = false; document.getElementById('btnAutoArmor').innerText = "ğŸ”„ ë°©ì–´êµ¬ ì—°ì†"; return; } isAutoArmor = true; document.getElementById('btnAutoArmor').innerText = "â¹ ì¤‘ë‹¨"; while(isAutoArmor && gameData.coins >= 5000 && gameData.maxArmorLevel < 150) { gachaArmor(true); await new Promise(r => setTimeout(r, 100)); } isAutoArmor = false; document.getElementById('btnAutoArmor').innerText = "ğŸ”„ ë°©ì–´êµ¬ ì—°ì†"; }
        async function autoEnhance() { if(isAutoWeapon) return; isAutoWeapon = true; document.querySelector('.btn-auto').innerText = "â¹"; while(isAutoWeapon && gameData.coins >= 100 && gameData.weaponLevel < 499) { enhanceWeapon(); await new Promise(r=>setTimeout(r, 50)); } isAutoWeapon = false; document.querySelector('.btn-auto').innerText = "âš¡ ì—°ì†ê°•í™”"; saveGame(); }
        
        function renderWeaponInventory() { 
            const grid = document.getElementById('weaponInventoryGrid'); grid.innerHTML = ""; 
            weaponDB.forEach(w => createWeaponSlot(grid, w.icon, `Lv.${w.lv}`, gameData.weaponLevel >= w.lv, w.name)); 
            createWeaponSlot(grid, "ğŸ”¥", "ì§€ì˜¥í™œ", gameData.hasHellBow, "ì§€ì˜¥ì˜ í™œ"); 
            createWeaponSlot(grid, "ğŸ•¸ï¸", "ì ìë¦¬ì±„", gameData.hasDragonflyNet, "ì ìë¦¬ì±„"); 
            createWeaponSlot(grid, "6ï¸âƒ£7ï¸âƒ£", "íˆë“ ", gameData.hasAdminWeapon, "67 ë¬´ê¸°"); 
            createWeaponSlot(grid, "ğŸ’€", "ì‚¬ì‹ ë‚«", gameData.hasScythe, "ì‚¬ì‹ ì˜ ë‚«"); 
            createWeaponSlot(grid, "âš”ï¸", "ë“€ì–¼ë‹¨ê²€", gameData.hasDualDagger, "ë“€ì–¼ ë‹¨ê²€");
            // íˆë“œë¼ ì‹œë¦¬ì¦ˆ
            createWeaponSlot(grid, "ğŸ—¡ï¸", "H.ê²€", gameData.hasHydraSword, "íˆë“œë¼ ê²€");
            createWeaponSlot(grid, "âš“", "H.ë‹»", gameData.hasHydraAnchor, "íˆë“œë¼ ë‹»");
            createWeaponSlot(grid, "ğŸª“", "H.ë„ë¼", gameData.hasHydraAxe, "íˆë“œë¼ ë„ë¼");
            createWeaponSlot(grid, "ğŸª„", "H.ì§€íŒ¡ì´", gameData.hasHydraStaff, "íˆë“œë¼ ì§€íŒ¡ì´");
            
            createWeaponSlot(grid, "ğŸ¦…", "ë¶ˆì‚¬ì¡°", gameData.hasPhoenixWing, "ë¶ˆì‚¬ì¡° ê¹ƒí„¸");
            createWeaponSlot(grid, "ğŸƒ", "ì¡°ì»¤ì¹´ë“œ", gameData.hasJokerCard, "ì¡°ì»¤ ì¹´ë“œ");
            
            // 1x ì‹œë¦¬ì¦ˆ
            createWeaponSlot(grid, "âš”ï¸", "1x ê²€", gameData.has1xSword, "1x ê²€");
            createWeaponSlot(grid, "ğŸ¹", "1x í™œ", gameData.has1xBow, "1x í™œ");
            createWeaponSlot(grid, "ğŸ’»", "1x PC", gameData.has1xComputer, "1x ì»´í“¨í„°");
            createWeaponSlot(grid, "ğŸ‘‘", "1x ì™•ê´€", gameData.has1xCrown, "1x1x1x ì™•ê´€");

            createWeaponSlot(grid, "ğŸ•¶ï¸", "ê²€ì€ì•ˆëŒ€", gameData.hasGojoBlindfold, "ê²€ì€ ì•ˆëŒ€");
            // ğŸ”¥ ìŠ¤ì¿ ë‚˜ ì†ê°€ë½ ë¬´ê¸°
            createWeaponSlot(grid, "ğŸ§Ÿ", "Lv.500", gameData.hasSukunaFinger, "ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½");
        }
        function createWeaponSlot(parent, icon, text, unlock, skinName) { let div = document.createElement('div'); div.className = "inv-slot"; if(!unlock) { div.classList.add('locked'); div.innerHTML = "ğŸ”’"; } else { div.innerHTML = `<div class="slot-icon">${icon}</div><div class="slot-lv">${text}</div>`; div.onclick = () => { gameData.equippedSkinName = skinName; renderWeaponInventory(); updateUI(); }; if(getCurrentDisplayWeapon().name === skinName) div.classList.add('selected'); } parent.appendChild(div); }
        function renderArmorInventory() { const grid = document.getElementById('armorInventoryGrid'); grid.innerHTML = ""; armorDB.forEach(a => { let div = document.createElement('div'); div.className = "inv-slot"; let unlock = gameData.maxArmorLevel >= a.lv; if(!unlock) { div.classList.add('locked'); div.innerHTML = "ğŸ”’"; } else { div.innerHTML = `<div class="slot-icon">${a.icon}</div><div class="slot-lv">Lv.${a.lv}</div>`; div.onclick = () => { gameData.equippedArmorLevel = a.lv; renderArmorInventory(); updateUI(); }; if(gameData.equippedArmorLevel === a.lv) div.classList.add('selected'); } grid.appendChild(div); }); }
        
        function updateUI() { 
            document.getElementById('coinDisplay').innerText = Math.floor(gameData.coins).toLocaleString(); 
            document.getElementById('potionDisplay').innerText = gameData.potions; 
            document.getElementById('prisonDisplay').innerText = gameData.prisonRealm; 
            document.getElementById('fingerDisplay').innerText = gameData.sukunaFingers;
            
            // ì†ê°€ë½ ë¨¹ê¸° ë²„íŠ¼ í‘œì‹œ
            if(gameData.sukunaFingers > 0) document.getElementById('btnEatFinger').style.display = 'block';
            else document.getElementById('btnEatFinger').style.display = 'none';

            let wInfo = getCurrentDisplayWeapon(); document.getElementById('townWeaponIcon').innerText = wInfo.icon; document.getElementById('weaponStatus').innerText = `${wInfo.name}`; let aInfo = armorDB.find(a => a.lv === gameData.equippedArmorLevel) || armorDB[0]; document.getElementById('townArmorIcon').innerText = aInfo.icon; document.getElementById('armorStatus').innerText = aInfo.name; 
        }
        function updateRaidUI() { document.getElementById('raidHpBar').style.width = (raidHp / raidMaxHp)*100 + "%"; document.getElementById('raidHpText').innerText = raidHp.toLocaleString(); document.getElementById('playerHpBar').style.width = (playerCurrentHp / playerMaxHp)*100 + "%"; document.getElementById('playerHpText').innerText = `${playerCurrentHp.toLocaleString()} / ${playerMaxHp.toLocaleString()}`; }
        
        function getCurrentDisplayWeapon() { 
            if(gameData.equippedSkinName) { 
                if(gameData.equippedSkinName==="ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½" && gameData.hasSukunaFinger) return {name:"ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½", icon:"ğŸ§Ÿ"};

                if(gameData.equippedSkinName==="ê²€ì€ ì•ˆëŒ€" && gameData.hasGojoBlindfold) return {name:"ê²€ì€ ì•ˆëŒ€", icon:"ğŸ•¶ï¸"};
                if(gameData.equippedSkinName==="1x1x1x ì™•ê´€" && gameData.has1xCrown) return {name:"1x1x1x ì™•ê´€", icon:"ğŸ‘‘"};
                if(gameData.equippedSkinName==="1x ê²€" && gameData.has1xSword) return {name:"1x ê²€", icon:"âš”ï¸"};
                if(gameData.equippedSkinName==="1x í™œ" && gameData.has1xBow) return {name:"1x í™œ", icon:"ğŸ¹"};
                if(gameData.equippedSkinName==="1x ì»´í“¨í„°" && gameData.has1xComputer) return {name:"1x ì»´í“¨í„°", icon:"ğŸ’»"};

                if(gameData.equippedSkinName==="ì¡°ì»¤ ì¹´ë“œ" && gameData.hasJokerCard) return {name:"ì¡°ì»¤ ì¹´ë“œ", icon:"ğŸƒ"};
                if(gameData.equippedSkinName==="ë¶ˆì‚¬ì¡° ê¹ƒí„¸" && gameData.hasPhoenixWing) return {name:"ë¶ˆì‚¬ì¡° ê¹ƒí„¸", icon:"ğŸ¦…"};
                if(gameData.equippedSkinName==="ì ìë¦¬ì±„" && gameData.hasDragonflyNet) return {name:"ì ìë¦¬ì±„", icon:"ğŸ•¸ï¸"}; 
                
                if(gameData.equippedSkinName==="íˆë“œë¼ ê²€" && gameData.hasHydraSword) return {name:"íˆë“œë¼ ê²€", icon:"ğŸ—¡ï¸"};
                if(gameData.equippedSkinName==="íˆë“œë¼ ë‹»" && gameData.hasHydraAnchor) return {name:"íˆë“œë¼ ë‹»", icon:"âš“"};
                if(gameData.equippedSkinName==="íˆë“œë¼ ë„ë¼" && gameData.hasHydraAxe) return {name:"íˆë“œë¼ ë„ë¼", icon:"ğŸª“"};
                if(gameData.equippedSkinName==="íˆë“œë¼ ì§€íŒ¡ì´" && gameData.hasHydraStaff) return {name:"íˆë“œë¼ ì§€íŒ¡ì´", icon:"ğŸª„"};

                if(gameData.equippedSkinName==="ë“€ì–¼ ë‹¨ê²€" && gameData.hasDualDagger) return {name:"ë“€ì–¼ ë‹¨ê²€", icon:"âš”ï¸"};
                if(gameData.equippedSkinName==="ì‚¬ì‹ ì˜ ë‚«" && gameData.hasScythe) return {name:"ì‚¬ì‹ ì˜ ë‚«", icon:"ğŸ’€"};
                if(gameData.equippedSkinName==="67 ë¬´ê¸°" && gameData.hasAdminWeapon) return {name:"67 ë¬´ê¸°", icon:"6ï¸âƒ£7ï¸âƒ£"};
                if(gameData.equippedSkinName==="ì§€ì˜¥ì˜ í™œ" && gameData.hasHellBow) return {name:"ì§€ì˜¥ì˜ í™œ", icon:"ğŸ”¥"};
                let f = weaponDB.find(w=>w.name===gameData.equippedSkinName); if(f && gameData.weaponLevel>=f.lv) return f; 
            } 
            for(let i=weaponDB.length-1; i>=0; i--) if(gameData.weaponLevel >= weaponDB[i].lv) return weaponDB[i]; return weaponDB[0]; 
        }
        
        function toggleMode() { 
            const body = document.body;
            if(body.classList.contains("mode-pc")) {
                body.classList.remove("mode-pc");
                body.classList.add("mode-mobile");
            } else {
                body.classList.remove("mode-mobile");
                body.classList.add("mode-pc");
            }
        }
        
        function changeScreen(id) { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function log(t,m) { document.getElementById(t+"Log").innerText = m; }
        function goToField() { changeScreen('fieldScreen'); spawnMonster(); updateSkillButtons(); }
        function spawnMonster() { document.getElementById('attackBtn').style.display = 'inline-block'; document.getElementById('nextMonsterBtn').style.display = 'none'; let target = monsters[0]; for(let i=monsters.length-1; i>=0; i--) { if(gameData.weaponLevel >= monsters[i].level) { target=monsters[i]; break; } } document.getElementById('monsterIcon').innerText = target.icon; document.getElementById('monsterInfo').innerText = `Lv.${target.level} ${target.name}`; }
        function attackMonster() { 
            let dmg = calculateDamage(); gameData.coins += 100 + Math.floor(dmg / 10); 
            let weapon = getCurrentDisplayWeapon();
            if (weapon.name.includes("íˆë“œë¼")) {
                let lifesteal = Math.floor(dmg * 0.05); if(lifesteal > 0) { playerCurrentHp += lifesteal; if(playerCurrentHp > playerMaxHp) playerCurrentHp = playerMaxHp; }
            }
            log('battle', `ê³µê²©! ${dmg.toLocaleString()}`);
            document.getElementById('attackBtn').style.display = 'none'; document.getElementById('nextMonsterBtn').style.display = 'inline-block'; updateUI(); 
        }
        function chopWood() { gameData.coins+=500; updateUI(); log('forest',"+500 G"); }

        document.addEventListener('keydown', (e) => {
            if(e.key.toUpperCase() === 'V') useSkill('V');
            if(e.key.toUpperCase() === 'Z') useSkill('Z');
            if(e.key.toUpperCase() === 'X') useSkill('X');
            if(e.key.toUpperCase() === 'C') useSkill('C');
        });
        loadGame();
    </script>
</body>
</html>
