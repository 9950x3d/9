
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG v48: í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë˜ì „ ì—…ë°ì´íŠ¸</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #050505;
            color: white;
            text-align: center;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            user-select: none;
            overflow: hidden;
            transition: background-color 1s ease;
        }
        
        /* === ğŸ“± ëª¨ë°”ì¼ ëª¨ë“œ CSS === */
        .game-container {
            margin-top: 50px; 
            background-color: #222; 
            width: 480px; 
            padding: 10px; 
            border-radius: 15px; 
            box-shadow: 0 0 25px rgba(0,0,0,0.8); 
            border: 2px solid #444; 
            max-height: 90vh; 
            overflow-y: auto; 
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }

        body.mode-mobile .game-container {
            width: 95%; height: 85vh; margin-top: 60px; font-size: 16px;
        }
        body.mode-mobile button { padding: 12px 5px; font-size: 14px; margin: 3px 1px; }
        body.mode-mobile .inv-slot { width: 50px; height: 50px; }
        body.mode-mobile h2 { font-size: 22px; margin-bottom: 10px; }

        .top-bar {
            width: 100%; background-color: #000; padding: 5px 0; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 5px; font-size: 12px; font-weight: bold; box-shadow: 0 2px 10px rgba(255,255,255,0.1); position: fixed; top: 0; z-index: 100;
        }
        .res-row { display: flex; gap: 10px; }
        .music-bar { width: 100%; background: #111; color: #00ff00; font-family: 'Courier New', monospace; font-size: 10px; padding: 2px 0; text-align: center; cursor: pointer; }
        
        .res-coin { color: #f1c40f; } 
        .res-potion-hp { color: #e056fd; } 
        .res-potion-atk { color: #e67e22; } 
        .res-potion-def { color: #3498db; }
        .res-ticket { color: #00ffcc; text-shadow: 0 0 5px #00ffcc; }

        .btn-small { background: #555; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; color: white; font-size: 11px; }

        h2 { margin: 0 0 5px 0; color: #fff; border-bottom: 2px solid #555; padding-bottom: 5px; font-size: 18px;}
        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .equip-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 5px; }
        .equip-slot { display: flex; flex-direction: column; align-items: center; background: #333; padding: 5px; border-radius: 10px; border: 2px solid #666; width: 80px; }
        .big-icon { font-size: 40px; margin: 2px 0; transition: transform 0.1s; }
        .status { font-size: 12px; font-weight: bold; color: #ddd; }
        
        .log-box {
            background: #000; color: #0f0; padding: 5px; border-radius: 5px;
            font-size: 11px; height: 35px; display: flex; align-items: center; justify-content: center;
            margin-bottom: 5px; white-space: pre-line; border: 1px solid #333;
        }

        button { padding: 8px; font-size: 13px; border: none; border-radius: 6px; cursor: pointer; margin: 2px; font-weight: bold; width: 96%; transition: 0.1s; position: relative; z-index: 5; }
        button:active { transform: scale(0.96); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-enhance { background-color: #e67e22; color: white; }
        .btn-gacha-w { background-color: #d35400; color: white; border: 2px solid #e67e22; }
        .btn-gacha-a { background-color: #9b59b6; color: white; border: 2px solid #8e44ad; }
        .btn-auto { background-color: #34495e; color: #ddd; border: 1px solid #7f8c8d; font-size: 11px; }
        
        .btn-forest { background-color: #27ae60; color: white; }
        .btn-field { background-color: #c0392b; color: white; }
        .btn-raid { background-color: #c0392b; color: white; border: 2px solid #e74c3c; }
        .btn-merchant { background-color: #f39c12; color: black; border: 2px solid #e67e22; font-weight: bold; }
        
        .btn-dungeon { background: #2c2c54; color: #a29bfe; border: 2px solid #6c5ce7; box-shadow: 0 0 10px #6c5ce7; }
        /* í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-xmas { background: linear-gradient(45deg, #c0392b, #27ae60); color: white; border: 2px solid #fff; box-shadow: 0 0 10px #e74c3c; animation: pulse 2s infinite; }

        .btn-auto-attack { background-color: #e84393; color: white; border: 2px solid #fd79a8; box-shadow: 0 0 5px #e84393; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(232, 67, 147, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(232, 67, 147, 0); } 100% { box-shadow: 0 0 0 0 rgba(232, 67, 147, 0); } }

        .btn-eat { background-color: #800000; color: #ffcccc; border: 1px solid #ff0000; animation: beat 2s infinite; display: none; }
        .btn-prison { background: #333; border: 2px solid #3498db; color: #3498db; box-shadow: 0 0 10px #3498db; display: none; }

        .btn-save { background-color: #2980b9; color: white; width: 48% !important; }
        .btn-reset { background-color: #c0392b; color: white; width: 48% !important; }
        .btn-town { background-color: #7f8c8d; color: white; }
        
        /* ì¼ë°˜ ë¬¼ì•½ */
        .btn-potion-hp { background-color: #8e44ad; color: white; border: 1px solid #e056fd; width:32%; }
        .btn-potion-atk { background-color: #d35400; color: white; border: 1px solid #e67e22; width:32%; }
        .btn-potion-def { background-color: #2980b9; color: white; border: 1px solid #3498db; width:32%; }
        
        /* ì´ˆì›” ë¬¼ì•½ */
        .btn-super-hp { background: linear-gradient(45deg, #ff00ff, #8e44ad); border: 2px solid #fff; width:32%; box-shadow: 0 0 5px #ff00ff; }
        .btn-super-atk { background: linear-gradient(45deg, #ffcc00, #e67e22); border: 2px solid #fff; width:32%; box-shadow: 0 0 5px #ffcc00; }
        .btn-super-def { background: linear-gradient(45deg, #00ffff, #3498db); border: 2px solid #fff; width:32%; box-shadow: 0 0 5px #00ffff; }

        /* ìŠ¤í‚¬ ë²„íŠ¼ UI */
        .skill-container { display: flex; justify-content: space-between; margin-bottom: 5px; gap: 2px; width: 100%; }
        .btn-skill { 
            width: 19%; 
            background-color: #333; border: 1px solid #777; color: #fff; 
            font-size: 10px; position: relative; overflow: hidden; height: 35px; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .skill-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background-color: rgba(0,0,0,0.6); transition: height 0.1s linear; }
        .skill-key { font-weight: bold; color: #ffd700; font-size: 11px; z-index: 2; }
        .skill-name { font-size: 9px; color: #ccc; z-index: 2; }

        .code-area { margin-top: 5px; border-top: 1px solid #555; padding-top: 5px; }
        .input-code { padding: 8px; border-radius: 4px; border: none; width: 60%; margin-right: 5px; font-size: 14px; }
        .btn-code { background-color: #8e44ad; color: white; width: 30%; padding: 8px; font-size: 14px; }

        .inventory-box { background-color: #333; padding: 5px; border-radius: 8px; margin-top: 5px; border: 1px dashed #777; max-height: 100px; overflow-y: auto; }
        .inv-title { font-size: 11px; margin-bottom: 3px; text-align: left; color: #ddd; }
        .inv-grid { display: flex; flex-wrap: wrap; gap: 4px; justify-content: flex-start; }
        .inv-slot { width: 40px; height: 40px; background-color: #222; border: 2px solid #555; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .inv-slot.selected { border-color: #00bfff; background-color: #000; box-shadow: 0 0 5px #00bfff; }
        .inv-slot.locked { filter: grayscale(1); opacity: 0.3; cursor: not-allowed; }
        .slot-icon { font-size: 16px; }
        .slot-lv { font-size: 8px; color: #aaa; }

        .bar-container { width: 90%; background: #555; height: 20px; border-radius: 10px; margin: 5px auto; overflow: hidden; position: relative;}
        .hp-text { position: absolute; width: 100%; text-align: center; top: 0; font-size: 12px; line-height: 20px; text-shadow: 1px 1px 1px black; z-index: 2; color:white; }
        .boss-hp-bar { width: 100%; height: 100%; background: #e74c3c; transition: width 0.2s; }
        .player-hp-bar { width: 100%; height: 100%; background: #2ecc71; transition: width 0.2s; }
        .dungeon-hp-bar { width: 100%; height: 100%; background: #8e44ad; transition: width 0.1s; }

        .buff-icon { position: fixed; top: 50px; right: 10px; font-size: 20px; z-index: 200; display: flex; flex-direction: column; gap: 5px;}

        /* ìƒì¸ ì•„ì´í…œ ëª©ë¡ */
        .merchant-item { display: flex; justify-content: space-between; align-items: center; background: #333; padding: 10px; margin-bottom: 5px; border-radius: 8px; border: 1px solid #555; }
        .m-info { text-align: left; }
        .m-name { font-weight: bold; color: #f1c40f; font-size: 14px; }
        .m-desc { font-size: 11px; color: #aaa; }
        .btn-buy { background-color: #27ae60; color: white; padding: 8px 15px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; }
        .btn-buy:active { transform: scale(0.95); }

        /* ë“œë˜ê³¤ ë‚ ê°œ ë²„íŠ¼ */
        .btn-wing-use { background: linear-gradient(45deg, #FFD700, #DAA520); color: black; border: 2px solid #fff; animation: pulse 1s infinite; display: none; margin-bottom: 5px;}

        #rewardOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 300;
            display: none; justify-content: center; align-items: center;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }
        .reward-card {
            width: 280px; padding: 30px;
            background: linear-gradient(135deg, #1e1e1e, #000);
            border: 3px solid gold; border-radius: 20px;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
            text-align: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column; align-items: center;
        }
        .reward-icon { font-size: 100px; margin: 15px 0; animation: bounce 1s infinite alternate; text-shadow: 0 0 10px white; }
        .reward-text { color: #f1c40f; font-size: 24px; font-weight: bold; margin-bottom: 5px; text-shadow: 0 0 5px #000; }
        .reward-sub { color: #aaa; font-size: 14px; margin-bottom: 20px; }
        .btn-claim { background: linear-gradient(to right, #f1c40f, #e67e22); border: none; padding: 12px 20px; color: black; font-weight: bold; border-radius: 20px; cursor: pointer; width: 80%; font-size: 16px; box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4); transition: transform 0.1s; }
        .btn-claim:active { transform: scale(0.95); }
    </style>
</head>
<body class="mode-pc">

    <div id="rewardOverlay">
        <div class="reward-card">
            <div class="reward-sub">CONGRATULATIONS!</div>
            <div class="reward-icon" id="rewardIcon">ğŸ</div>
            <div class="reward-text" id="rewardName">ì•„ì´í…œ</div>
            <button class="btn-claim" onclick="nextReward()">í™•ì¸</button>
        </div>
    </div>

    <div class="buff-icon" id="buffIcons"></div>

    <div class="top-bar">
        <div class="music-bar" id="musicBar" onclick="initAudio()">ğŸ”Š ì†Œë¦¬ ì¼œê¸° (í´ë¦­)</div>
        <div class="res-row">
            <div class="res-coin">ğŸ’° <span id="coinDisplay">0</span></div>
            <div class="res-potion-hp">ğŸ§ª <span id="potionDisplay">0</span></div>
            <div class="res-potion-atk">âš”ï¸ <span id="potionAtkDisplay">0</span></div>
            <div class="res-potion-def">ğŸ›¡ï¸ <span id="potionDefDisplay">0</span></div>
        </div>
        <div class="res-row">
            <div class="res-ticket">ğŸŸï¸ <span id="ticketDisplay">0</span></div> 
            <div class="res-cube">ğŸ“¦ <span id="prisonDisplay">0</span></div>
            <div class="res-finger">ğŸ§Ÿ <span id="fingerDisplay">0</span></div>
            <button class="btn-small btn-mode" onclick="toggleMode()">ğŸ’»/ğŸ“±</button>
            <button class="btn-small" onclick="manualSave()">ğŸ’¾</button>
        </div>
    </div>

    <div class="game-container">
        <!-- ë§ˆì„ -->
        <div id="townScreen" class="screen active">
            <h2>ğŸ° ë§ˆì„ ê´‘ì¥</h2>
            <div class="equip-container">
                <div class="equip-slot">
                    <div class="big-icon" id="townWeaponIcon">ğŸ—¡ï¸</div>
                    <div class="status" id="weaponStatus">Lv.0</div>
                </div>
                <div class="equip-slot">
                    <div class="big-icon" id="townArmorIcon">ğŸ‘•</div>
                    <div class="status" id="armorStatus">ë§¨ëª¸</div>
                </div>
            </div>
            <div class="log-box" id="townLog">í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë²¤íŠ¸ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
            <button class="btn-wing-use" id="btnWingUse" onclick="useDragonWing()">ğŸ¦‹ ë“œë˜ê³¤ ë‚ ê°œ ì‚¬ìš© (1ì‹œê°„ ë²„í”„)</button>
            <button class="btn-eat" id="btnEatFinger" onclick="eatFinger()">ğŸ§Ÿ ìŠ¤ì¿ ë‚˜ ì†ê°€ë½ ì‚¼í‚¤ê¸° (DMG x2) ğŸ§Ÿ</button>
            
            <!-- ë²„íŠ¼ ë°°ì¹˜ ìˆ˜ì •: ê°•í™” / ìƒì¸ -->
            <div style="display: flex; justify-content: center; width: 100%;">
                <button class="btn-enhance" style="width: 48%;" onclick="enhanceWeapon()">ğŸ”¨ ê°•í™” (80%)</button>
                <button class="btn-merchant" style="width: 48%;" onclick="changeScreen('merchantScreen')">ğŸ’° ìƒì¸ ê±°ë˜</button>
            </div>
            <!-- ë²„íŠ¼ ë°°ì¹˜ ìˆ˜ì •: ë¬´ê¸° ë½‘ê¸° (ë‹¨ë°œ / ì—°ì†) -->
            <div style="display: flex; justify-content: center; width: 100%; margin-top:2px;">
                <button class="btn-gacha-w" style="width: 48%;" onclick="gachaWeapon()">ğŸ—¡ï¸ ë¬´ê¸°ë½‘ê¸°</button>
                <button class="btn-auto" id="btnAutoWeaponGacha" style="width: 48%;" onclick="autoGachaWeapon()">ğŸ”„ ë¬´ê¸° ì—°ì†</button>
            </div>
            <div style="display: flex; justify-content: center; width: 100%; margin-top:2px;">
                <button class="btn-gacha-a" style="width: 48%;" onclick="gachaArmor(false)">ğŸ›¡ï¸ ë°©ì–´êµ¬ ë½‘ê¸° (5000G)</button>
                <button class="btn-auto" id="btnAutoArmor" style="width: 48%;" onclick="autoGachaArmor()">ğŸ”„ ë°©ì–´êµ¬ ì—°ì†</button>
            </div>
            <div style="display:flex; justify-content: space-between; margin-top:5px; flex-wrap: wrap;">
                <button class="btn-forest" style="width:49%" onclick="changeScreen('forestScreen')">ğŸŒ² ìˆ²</button>
                <button class="btn-field" style="width:49%" onclick="goToField()">ğŸ‘¹ ì‚¬ëƒ¥í„°</button>
                <button class="btn-raid" style="width:49%; margin-top:3px;" onclick="goToRaidSelect()">ğŸ”¥ ë ˆì´ë“œ</button>
                <button class="btn-dungeon" style="width:49%; margin-top:3px;" onclick="goToDungeonSelect()">ğŸ•³ï¸ ë¬´í•œì˜ ë™êµ´</button>
            </div>
            <div style="display:flex; justify-content: center; margin-top:5px;">
                <button class="btn-save" onclick="manualSave()">ğŸ’¾ ì €ì¥</button>
                <button class="btn-reset" onclick="resetGame()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
            </div>
            <div class="inventory-box">
                <div class="inv-title">ğŸ’ ë¬´ê¸° ì¸ë²¤í† ë¦¬</div>
                <div class="inv-grid" id="weaponInventoryGrid"></div>
            </div>
            <div class="inventory-box">
                <div class="inv-title">ğŸ›¡ï¸ ë°©ì–´êµ¬ ì¸ë²¤í† ë¦¬</div>
                <div class="inv-grid" id="armorInventoryGrid"></div>
            </div>
            <div class="code-area">
                <input type="text" id="codeInput" class="input-code" placeholder="ì½”ë“œ ì…ë ¥ (1234: í‹°ì¼“ 50ì¥)">
                <button class="btn-code" onclick="useCode()">ì…ë ¥</button>
            </div>
        </div>

        <!-- ìƒì¸ í™”ë©´ -->
        <div id="merchantScreen" class="screen">
            <h2>ğŸ’° ê±°ë˜ ìƒì¸</h2>
            <div class="log-box">ê°•ë ¥í•œ ë¬¼ê±´ì„ íŒë‹ˆë‹¤...</div>
            
            <div class="merchant-item">
                <div class="m-info">
                    <div class="m-name">ğŸª­ ë“œë˜ê³¤ ë¶€ì±„</div>
                    <div class="m-desc">ê°€ì„±ë¹„ ë¬´ê¸° (500ì¸µ ë“œë¡­)</div>
                </div>
                <button class="btn-buy" onclick="buyItem('dragonFan')">1ì–µ G</button>
            </div>
            <div class="merchant-item">
                <div class="m-info">
                    <div class="m-name">ğŸ²ğŸ‘¥ ë“œë˜ê³¤ í´ë¡ </div>
                    <div class="m-desc">ë‹¨ê²€ì˜ ë³´ê¸‰í˜• (ë‹¨ê²€ë³´ë‹¤ ì•½í•¨)</div>
                </div>
                <button class="btn-buy" onclick="buyItem('dragonClone')">1.5ì–µ G</button>
            </div>
            <div class="merchant-item">
                <div class="m-info">
                    <div class="m-name">ğŸ² ë“œë˜ê³¤ í—¤ë“œ (ê°‘ì˜·)</div>
                    <div class="m-desc">HP 50ì¡° (ê°€ì‹œ ê°‘ì˜·ë³´ë‹¤ ê°•ë ¥)</div>
                </div>
                <button class="btn-buy" onclick="buyItem('dragonHead')">2ì–µ G</button>
            </div>
            <div class="merchant-item">
                <div class="m-info">
                    <div class="m-name">ğŸ‰ğŸ—¡ï¸ ë“œë˜ê³¤ ë‹¨ê²€</div>
                    <div class="m-desc">ìµœê°•ì˜ ë¬´ê¸° (ê³ ì£ , ìŠ¤ì¿ ë‚˜ ì´ˆì›”)</div>
                </div>
                <button class="btn-buy" onclick="buyItem('dragonDagger')">5ì–µ G</button>
            </div>
            <hr style="border:1px solid #444; margin: 10px 0;">
            <div class="merchant-item">
                <div class="m-info">
                    <div class="m-name">ğŸ§ª ì´ˆì›” HP ë¬¼ì•½</div>
                    <div class="m-desc">ì²´ë ¥ x50 (ì¼íšŒìš©)</div>
                </div>
                <button class="btn-buy" onclick="buyItem('superHp')">500ë§Œ G</button>
            </div>
            <div class="merchant-item">
                <div class="m-info">
                    <div class="m-name">âš”ï¸ ì´ˆì›” ê³µê²© ë¬¼ì•½</div>
                    <div class="m-desc">ë°ë¯¸ì§€ x50 (30ì´ˆ)</div>
                </div>
                <button class="btn-buy" onclick="buyItem('superAtk')">500ë§Œ G</button>
            </div>
            <div class="merchant-item">
                <div class="m-info">
                    <div class="m-name">ğŸ›¡ï¸ ì´ˆì›” ë°©ì–´ ë¬¼ì•½</div>
                    <div class="m-desc">ë°©ì–´ë ¥ x100 (30ì´ˆ)</div>
                </div>
                <button class="btn-buy" onclick="buyItem('superDef')">500ë§Œ G</button>
            </div>

            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸ”™ ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ë˜ì „ ì„ íƒ í™”ë©´ (ì‹ ê·œ) -->
        <div id="dungeonSelectScreen" class="screen">
            <h2>ğŸ° ë˜ì „ ê³ ë¥´ê¸°</h2>
            <div class="log-box">ë„ì „í•  ë˜ì „ì„ ì„ íƒí•˜ì„¸ìš”.</div>
            <div style="display:flex; flex-direction:column; gap:10px; padding:20px;">
                <button class="btn-dungeon" style="height:60px; font-size:16px;" onclick="startDungeon('normal')">ğŸ•³ï¸ ë¬´í•œì˜ ë™êµ´ (ì¼ë°˜)</button>
                <button class="btn-xmas" style="height:60px; font-size:16px;" onclick="startDungeon('christmas')">ğŸ„ ë¬´í•œ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë˜ì „ (ì´ë²¤íŠ¸)</button>
            </div>
            <div style="font-size:12px; color:#aaa; margin-top:5px;">
                * í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë˜ì „ ë“œë¡­:<br>
                ğŸ¬ ìº”ë”” ë‚« (2%) / ğŸ‹ ìº”ë”” ì¹´íƒ€ë‚˜ (3%) / ğŸ­ ìº”ë”” ì§€íŒ¡ì´ (4%)
            </div>
            <button class="btn-town" onclick="changeScreen('townScreen')" style="margin-top:20px;">ğŸ”™ ë§ˆì„ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ë˜ì „ -->
        <div id="dungeonScreen" class="screen">
            <h2 id="dungeonTitle">ğŸ•³ï¸ ë¬´í•œì˜ ë™êµ´</h2>
            <div style="font-size:14px; margin-bottom:5px;">í˜„ì¬ ì›¨ì´ë¸Œ: <span id="dungeonWave" style="color:#a29bfe; font-weight:bold;">1</span></div>
            <div class="big-icon" id="dungeonMobIcon">ğŸ‘»</div>
            <div class="status" id="dungeonMobName">ë™êµ´ ìœ ë ¹</div>
            <div class="bar-container"><div class="dungeon-hp-bar" id="dungeonMobHpBar"></div><div class="hp-text" id="dungeonMobHpText">? / ?</div></div>
            <div style="font-size:12px; text-align:left; margin-left:20px; margin-top:5px;">â¤ï¸ MY HP</div>
            <div class="bar-container"><div class="player-hp-bar" id="playerHpBarDungeon"></div><div class="hp-text" id="playerHpTextDungeon">1000 / 1000</div></div>
            <div class="log-box" id="dungeonLog">ë™êµ´ì— ë“¤ì–´ì™”ìŠµë‹ˆë‹¤.</div>
            <div class="skill-container" id="dungeonSkills"></div>
            <div style="display:flex; gap:5px;">
                <button class="btn-dungeon" style="width:70%" onclick="attackDungeonMonster()">âš”ï¸ ê³µê²©</button>
                <button class="btn-auto-attack" id="btnAutoDungeon" style="width:30%" onclick="toggleAutoAttack(true)">ğŸ¤– ìë™</button>
            </div>
            <!-- ë¬¼ì•½ ì»¨íŠ¸ë¡¤ -->
            <div style="display:flex; justify-content:center; gap:2px; margin-top:2px;">
                <button class="btn-potion-hp" onclick="drinkPotion('hp')">ğŸ§ª HP</button>
                <button class="btn-potion-atk" onclick="drinkPotion('atk')">âš”ï¸ x2</button>
                <button class="btn-potion-def" onclick="drinkPotion('def')">ğŸ›¡ï¸ x2</button>
            </div>
            <div style="display:flex; justify-content:center; gap:2px; margin-top:2px;">
                <button class="btn-super-hp" onclick="drinkSuperPotion('hp')">ğŸ§ª MAX x50</button>
                <button class="btn-super-atk" onclick="drinkSuperPotion('atk')">âš”ï¸ x50</button>
                <button class="btn-super-def" onclick="drinkSuperPotion('def')">ğŸ›¡ï¸ x100</button>
            </div>
            <button class="btn-town" onclick="leaveDungeon()">ğŸƒ ë„ë§ê°€ê¸°</button>
        </div>

        <!-- ë ˆì´ë“œ ì„ íƒ -->
        <div id="raidSelectScreen" class="screen">
            <h2>ğŸ”¥ ë ˆì´ë“œ ì„ íƒ (í‹°ì¼“ í•„ìš”)</h2>
            <div class="log-box">ì…ì¥ ì‹œ í‹°ì¼“ 1ì¥ì´ ì†Œëª¨ë©ë‹ˆë‹¤.</div>
            <div style="display:flex; flex-wrap:wrap; justify-content:center;">
                <button class="btn-raid" onclick="startRaid('hell')">ğŸ”¥ ì§€ì˜¥ì˜ íŒŒìˆ˜ê¾¼</button>
                <button class="btn-reaper" onclick="startRaid('reaper')">ğŸ’€ ì‚¬ì‹ </button>
                <button class="btn-dagger" onclick="startRaid('dagger')">âš”ï¸ ë“€ì–¼ ë‹¨ê²€</button>
                <button class="btn-hydra" onclick="startRaid('hydra')">ğŸ‰ íˆë“œë¼</button>
                <button class="btn-phoenix" onclick="startRaid('phoenix')">ğŸ¦… ë¶ˆì‚¬ì¡°</button>
                <button class="btn-joker" onclick="startRaid('joker')">ğŸ¤¡ ì¡°ì»¤</button>
                <button class="btn-1x" onclick="startRaid('1x1x1x1')">ğŸ”³ 1x1x1x1</button> 
                <button class="btn-dual-scythe" onclick="startRaid('dual_scythe')">âš”ï¸ğŸ’€ ë“€ì–¼ ë‚«</button> 
                <button class="btn-gojo" onclick="startRaid('gojo')">ğŸ¤ ê³ ì£  ì‚¬í† ë£¨</button>
                <button class="btn-god" onclick="startRaid('god')">ğŸŒŸ ì ˆëŒ€ì‹ </button>
                <!-- ì‹ ê·œ ë ˆì´ë“œ -->
                <button class="btn-raid" style="width:98%; border:2px solid gold; box-shadow:0 0 10px gold;" onclick="startRaid('dragon_god')">ğŸ² ì§„: ë“œë˜ê³¤ (ì‹ ë³´ë‹¤ ê°•í•¨)</button>
            </div>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸ”™ ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ìˆ² -->
        <div id="forestScreen" class="screen">
            <h2>ğŸŒ² ì‹ ë¹„í•œ ìˆ²</h2>
            <div class="big-icon">ğŸª“</div>
            <div class="log-box" id="forestLog">ë‚˜ë¬´ë¥¼ ìºì„œ ëˆì„ ë²„ì„¸ìš”.</div>
            <button class="btn-forest" id="chopBtn" onclick="chopWood()">ğŸª“ ë‚˜ë¬´ ë² ê¸°</button>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸ° ë§ˆì„ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ì‚¬ëƒ¥í„° -->
        <div id="fieldScreen" class="screen">
            <h2>â˜ ï¸ ìœ„í—˜í•œ ì‚¬ëƒ¥í„°</h2>
            <div class="big-icon" id="monsterIcon">â“</div>
            <div class="status" id="monsterInfo">íƒìƒ‰ ì¤‘...</div>
            <div class="log-box" id="battleLog">ì•¼ìƒì˜ ëª¬ìŠ¤í„°ê°€ ë‚˜íƒ€ë‚¬ë‹¤!</div>
            <div class="skill-container" id="battleSkills"></div>
            <div style="display:flex; gap:5px;">
                <button class="btn-field" id="attackBtn" style="width:70%" onclick="attackMonster()">âš”ï¸ ê³µê²©í•˜ê¸°</button>
                <button class="btn-field" id="nextMonsterBtn" style="width:70%; display:none;" onclick="spawnMonster()">ğŸ” ë‹¤ìŒ ëª¬ìŠ¤í„°</button>
                <button class="btn-auto-attack" id="btnAutoField" style="width:30%" onclick="toggleAutoAttack(false)">ğŸ¤– ìë™</button>
            </div>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸƒ ë„ë§ê°€ê¸°</button>
        </div>

        <!-- ë ˆì´ë“œ ì „íˆ¬ -->
        <div id="raidScreen" class="screen">
            <h2 id="raidTitle">ğŸ”¥ ë ˆì´ë“œ</h2>
            <div class="big-icon" id="raidBossIcon">ğŸ‘¿</div>
            <div style="font-size:12px; text-align:left; margin-left:20px;">ğŸ‘¿ BOSS HP</div>
            <div class="bar-container"><div class="boss-hp-bar" id="raidHpBar"></div><div class="hp-text" id="raidHpText">100 / 100</div></div>
            <div style="font-size:12px; text-align:left; margin-left:20px; margin-top:5px;">â¤ï¸ MY HP</div>
            <div class="bar-container"><div class="player-hp-bar" id="playerHpBar"></div><div class="hp-text" id="playerHpText">1000 / 1000</div></div>
            <div class="log-box" id="raidLog">ì „íˆ¬ ì‹œì‘!</div>
            <div class="skill-container" id="raidSkills"></div>
            <button class="btn-raid" id="btnRaidAttack" onclick="attackRaidBoss()">ğŸ¹ ë³´ìŠ¤ ê³µê²©í•˜ê¸°</button>
            <button class="btn-prison" id="btnPrisonRealm" onclick="usePrisonRealm()">ğŸ“¦ ì˜¥ë¬¸ê°• ë´‰ì¸ (ì¦‰ì‹œ ì²˜ì¹˜)</button>
            
            <div style="display:flex; justify-content:center; gap:2px; margin-top:2px;">
                <button class="btn-potion-hp" onclick="drinkPotion('hp')">ğŸ§ª HP</button>
                <button class="btn-potion-atk" onclick="drinkPotion('atk')">âš”ï¸ x2</button>
                <button class="btn-potion-def" onclick="drinkPotion('def')">ğŸ›¡ï¸ x2</button>
            </div>
            <div style="display:flex; justify-content:center; gap:2px; margin-top:2px;">
                <button class="btn-super-hp" onclick="drinkSuperPotion('hp')">ğŸ§ª MAX x50</button>
                <button class="btn-super-atk" onclick="drinkSuperPotion('atk')">âš”ï¸ x50</button>
                <button class="btn-super-def" onclick="drinkSuperPotion('def')">ğŸ›¡ï¸ x100</button>
            </div>
            <button class="btn-town" onclick="changeScreen('townScreen')">ğŸƒ ë„ë§ê°€ê¸°</button>
        </div>
    </div>

    <script>
        // === ğŸµ ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ ===
        const AudioEngine = {
            ctx: null, isMuted: true, currentTheme: 'town',
            init: function() { 
                try {
                    if(!this.ctx) { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); this.isMuted = false; document.getElementById('musicBar').innerText = "ğŸ”Š ì†Œë¦¬ ì¼œì§ (BGM ì¬ìƒ ì¤‘)"; this.playBGM(this.currentTheme); } 
                    else if (this.ctx.state === 'suspended') { this.ctx.resume(); } 
                } catch(e) { console.log("Audio Init Failed"); }
            },
            playTone: function(freq, type, duration, vol=0.1) { if(!this.ctx || this.isMuted) return; try { const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain(); osc.type = type; osc.frequency.setValueAtTime(freq, this.ctx.currentTime); gain.gain.setValueAtTime(vol, this.ctx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration); osc.connect(gain); gain.connect(this.ctx.destination); osc.start(); osc.stop(this.ctx.currentTime + duration); } catch(e) {} },
            sfx: {
                attack: () => { AudioEngine.playTone(150, 'sawtooth', 0.1); AudioEngine.playTone(100, 'square', 0.1); },
                hit: () => AudioEngine.playTone(80, 'sawtooth', 0.2),
                coin: () => { AudioEngine.playTone(1200, 'sine', 0.1); setTimeout(()=>AudioEngine.playTone(1600, 'sine', 0.2), 50); },
                levelUp: () => { [440, 554, 659, 880].forEach((f, i) => setTimeout(() => AudioEngine.playTone(f, 'square', 0.3), i * 100)); },
                gacha: () => { for(let i=0; i<10; i++) setTimeout(() => AudioEngine.playTone(200 + i*100, 'triangle', 0.05), i * 50); },
                glitch: () => { for(let i=0; i<5; i++) setTimeout(() => AudioEngine.playTone(Math.random()*1000, 'sawtooth', 0.05), i * 30); },
                potion: () => { AudioEngine.playTone(600, 'sine', 0.2); AudioEngine.playTone(800, 'sine', 0.2); }
            },
            bgmInterval: null,
            playBGM: function(theme) {
                if(this.bgmInterval) clearInterval(this.bgmInterval); this.currentTheme = theme; if(!this.ctx || this.isMuted) return;
                let notes = [], speed = 400, waveType = 'sine';
                if(theme === 'town') { notes = [523, 659, 784, 1046, 784, 659]; speed = 300; waveType = 'triangle'; } 
                else if(theme === 'dungeon') { notes = [110, 116, 123, 116]; speed = 600; waveType = 'sawtooth'; } 
                else if(theme === 'hell') { notes = [100, 200, 150, 300, 100]; speed = 150; waveType = 'square'; } 
                else if(theme === 'heaven') { notes = [880, 987, 1046, 1318]; speed = 800; waveType = 'sine'; } 
                else if(theme === 'skeleton') { notes = [130, 123, 110, 100, 90]; speed = 250; waveType = 'sawtooth'; }
                else if(theme === 'dragon') { notes = [55, 60, 55, 110]; speed = 800; waveType = 'sawtooth'; }
                else if(theme === 'raid') { notes = [110, 110, 110, 146]; speed = 200; waveType = 'sawtooth'; }
                else if(theme === 'god') { notes = [1046, 1174, 1318, 1568, 1318]; speed = 400; waveType = 'sine'; }
                else if(theme === 'christmas') { notes = [659, 659, 659, 659, 659, 659, 659, 784, 523, 587, 659]; speed = 250; waveType = 'sine'; } // Jingle Bells simple
                let idx = 0;
                this.bgmInterval = setInterval(() => {
                    if(this.ctx.state === 'running') { try { const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain(); osc.type = waveType; osc.frequency.setValueAtTime(notes[idx], this.ctx.currentTime); gain.gain.setValueAtTime(0.03, this.ctx.currentTime); gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + (speed/1000)); osc.connect(gain); gain.connect(this.ctx.destination); osc.start(); osc.stop(this.ctx.currentTime + (speed/1000)); idx = (idx + 1) % notes.length; } catch(e) {} }
                }, speed);
            }
        };
        function initAudio() { AudioEngine.init(); }

        // === ğŸ’¾ ë°ì´í„° ===
        let gameData = {
            coins: 0,
            weaponLevel: 0,
            maxArmorLevel: 0, equippedArmorLevel: 0,
            potions: 5, damagePotions: 0, defensePotions: 0, 
            
            // ì´ˆì›” ë¬¼ì•½
            superPotionHp: 0, superPotionAtk: 0, superPotionDef: 0,

            prisonRealm: 0, sukunaFingers: 0, eatenFingers: 0,
            currentDungeonWave: 1, 
            raidTickets: 0, 
            
            hasHellBow: false, hasDragonflyNet: false, hasAdminWeapon: false, hasScythe: false, hasDualDagger: false,
            hasHydraStaff: false, hasHydraAxe: false, hasHydraAnchor: false, hasHydraSword: false,
            hasPhoenixWing: false, hasJokerCard: false,
            has1xSword: false, has1xBow: false, has1xComputer: false, has1xCrown: false,
            hasDualScythe: false, hasGojoBlindfold: false, hasSukunaFinger: false, hasGlitchGuitar: false,
            hasGlitchChainsaw: false, 
            
            hasGodBead: false, hasDevilHorn: false, hasAngelRing: false, hasSpineHand: false, 

            // ê±°ë˜ ì•„ì´í…œ & ì‹ ê·œ ì•„ì´í…œ
            hasDragonFan: false, hasDragonHead: false, hasDragonDagger: false,
            hasDragonClone: false, // ë“œë˜ê³¤ í´ë¡  (ë‹¨ê²€ë³´ë‹¤ ì•½í•¨)
            hasDragonWing: false, // ë“œë˜ê³¤ ë‚ ê°œ (ë²„í”„ ì•„ì´í…œ)
            hasDragonWhip: false, // ë“œë˜ê³¤ ì±„ì°

            // í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì•„ì´í…œ (ì‹ ê·œ)
            hasCandyScythe: false, // ìº”ë”” ë‚«
            hasCandyKatana: false, // ìº”ë”” ì¹´íƒ€ë‚˜
            hasCandyStaff: false, // ìº”ë”” ì§€íŒ¡ì´

            hasThornArmor: false, 
            equippedSkinName: null, equippedArmorName: null
        };

        const monsters = [
            { level: 0, name: "ìŠ¬ë¼ì„", icon: "ğŸ’§" },
            { level: 10, name: "ëŠ‘ëŒ€", icon: "ğŸº" },
            { level: 30, name: "ê³ ë¸”ë¦°", icon: "ğŸ‘º" },
            { level: 50, name: "ì˜¤í¬", icon: "ğŸ‘¹" },
            { level: 100, name: "ê³¨ë ˜", icon: "ğŸ—¿" },
            { level: 200, name: "íŠ¸ë¡¤", icon: "ğŸ§Ÿ" },
            { level: 400, name: "ì™€ì´ë²ˆ", icon: "ğŸ¦" },
            { level: 700, name: "ë“œë˜ê³¤", icon: "ğŸ‰" },
            { level: 1000, name: "ë§ˆì™•", icon: "ğŸ‘¿" },
            { level: 2000, name: "ì ˆëŒ€ì‹ ", icon: "âš¡" }
        ];

        let playerCurrentHp = 1000, playerMaxHp = 1000, raidHp = 10000000, raidMaxHp = 10000000;
        let dungeonWave = 1, dungeonMobHp = 100, dungeonMobMaxHp = 100;
        let isAutoAttack = false, autoAttackInterval = null;
        let skillCD = { Z: 0, X: 0, C: 0, V: 0, B: 0 };
        const MAX_CD = { Z: 3000, X: 8000, C: 15000, V: 45000, B: 300000 };
        let skillActiveTime = { Z: 0, X: 0, C: 0, V: 0, B: 0 };

        let isAutoWeapon = false, isAutoArmor = false, isAutoWeaponGacha = false;
        let currentRaidType = 'hell';
        let dungeonMode = 'normal'; // 'normal' | 'christmas'
        
        let buffDamageMult = 1;
        let buffDefenseMult = 1;
        let buffTimers = { atk: null, def: null };

        const weaponDB = [
            { lv: 0, name: "ë‚¡ì€ ê²€", icon: "ğŸ—¡ï¸" }, { lv: 10, name: "ê³¨ë“œë°”", icon: "ğŸ§ˆ" }, { lv: 20, name: "ì‹ í™”ì˜ í™œ", icon: "ğŸ¹" },
            { lv: 35, name: "ë„ˆí´", icon: "ğŸ‘Š" }, { lv: 50, name: "í™”ì—¼ë°©ì‚¬ê¸°", icon: "ğŸ”¥" }, { lv: 65, name: "ë¯¸ë‹ˆê±´", icon: "ğŸš" },
            { lv: 70, name: "ë±€íŒŒì´ì–´ ì´ë¹¨", icon: "ğŸ§›" }, { lv: 75, name: "ë¡œë´‡ íŒ”", icon: "ğŸ¤–" }, { lv: 80, name: "ì•ŒëŒ ì‹œê³„", icon: "â°" },
            { lv: 90, name: "ê´‘ì„ ê²€", icon: "ğŸ”¦" }, { lv: 100, name: "ì¹¼ëŒë¹—", icon: "ğŸŒ™" },
            { lv: 110, name: "ë§ˆë²•ë´‰", icon: "ğŸª„" }, { lv: 120, name: "í¡í˜ˆ ë°•ì¥", icon: "ğŸ¦‡" }, { lv: 130, name: "ì±„ì°", icon: "ğŸ§¶" }, { lv: 140, name: "ìì„", icon: "ğŸ§²" },
            { lv: 150, name: "ê±°ë¯¸ì¤„", icon: "ğŸ•¸ï¸" }, { lv: 160, name: "ëŒ€ëª»", icon: "ğŸ“Œ" }, { lv: 170, name: "ë‚šì‹œëŒ€", icon: "ğŸ£" },
            { lv: 180, name: "ì¹´íƒ€ë‚˜", icon: "âš”ï¸" }, { lv: 190, name: "í‘œì°½", icon: "ğŸ’ " }, { lv: 195, name: "ì¹´ë©”ë¼", icon: "ğŸ“¸" },
            { lv: 200, name: "ì €ê²©ì†Œì´", icon: "ğŸ”«" },
            
            { lv: 210, name: "ë ˆì´ì € í¬", icon: "ğŸ”«" }, { lv: 230, name: "í† ë¥´ì˜ ë§ì¹˜", icon: "ğŸ”¨" }, { lv: 250, name: "ì–‘ì ê²€", icon: "ğŸ—¡ï¸" },
            { lv: 280, name: "ë°ìŠ¤ ë…¸íŠ¸", icon: "ğŸ““" }, { lv: 300, name: "ì—‘ìŠ¤ì¹¼ë¦¬ë²„", icon: "âš”ï¸" }, { lv: 330, name: "í•µë¯¸ì‚¬ì¼", icon: "ğŸš€" },
            { lv: 360, name: "íƒ€ë…¸ìŠ¤ ì¥ê°‘", icon: "ğŸ§¤" }, { lv: 400, name: "í–‰ì„± íŒŒê´´ì", icon: "ğŸª" }, { lv: 440, name: "ë¸”ë™í™€ ìƒì„±ê¸°", icon: "âš«" },
            { lv: 480, name: "ì°¨ì› ì ˆë‹¨ê¸°", icon: "ğŸŒ€" }, { lv: 490, name: "ë°˜ì „ ìˆ ì‹", icon: "ğŸ”„" },

            { lv: 510, name: "ìš©ì˜ ì—¬ì˜ì£¼", icon: "ğŸ”®" }, { lv: 520, name: "í¬ì„¸ì´ëˆì˜ ì‚¼ì§€ì°½", icon: "ğŸ”±" }, { lv: 530, name: "ì œìš°ìŠ¤ì˜ ë²ˆê°œ", icon: "âš¡" },
            { lv: 540, name: "í•˜ë°ìŠ¤ì˜ íˆ¬êµ¬", icon: "ğŸª–" }, { lv: 550, name: "ì²œì‚¬ì˜ ë‚ ê°œ", icon: "ğŸ‘¼" }, { lv: 560, name: "íƒ€ë½í•œ ì„±ê²€", icon: "ğŸ—¡ï¸" },
            { lv: 570, name: "ê¶ê·¸ë‹", icon: "ğŸ”±" }, { lv: 580, name: "ê²Œ ë³¼ê·¸", icon: "ğŸ©¸" }, { lv: 590, name: "ë¡ ê¸°ëˆ„ìŠ¤ì˜ ì°½", icon: "ğŸ§¬" },
            
            { lv: 600, name: "íƒœì–‘ì˜ íŒŒí¸", icon: "â˜€ï¸" }, { lv: 610, name: "í€˜ì´ì‚¬ ë°©ì¶œê¸°", icon: "ğŸŒŒ" }, { lv: 620, name: "ì•”í‘ ë¬¼ì§ˆ ê²€", icon: "â¬›" },
            { lv: 630, name: "ë¹…ë±… ìˆ˜ë¥˜íƒ„", icon: "ğŸ’¥" }, { lv: 640, name: "ì€í•˜ìˆ˜ ì±„ì°", icon: "ğŸŒŒ" }, { lv: 650, name: "ì„±ìš´ì˜ ì§€íŒ¡ì´", icon: "ğŸª„" },
            { lv: 660, name: "ì¤‘ë ¥ ë¶•ê´´ ì¥ì¹˜", icon: "ğŸ“‰" }, { lv: 670, name: "í˜œì„± ì¶©ëŒê¸°", icon: "â˜„ï¸" }, { lv: 680, name: "ì´ˆì‹ ì„± í­ë°œ", icon: "ğŸŒŸ" },
            { lv: 690, name: "ì‚¬ìƒì˜ ì§€í‰ì„ ", icon: "ğŸ•³ï¸" },

            { lv: 700, name: "ì‹œê°„ì˜ í†±ë‹ˆë°”í€´", icon: "âš™ï¸" }, { lv: 710, name: "ê³µê°„ì˜ ê· ì—´", icon: "âš¡" }, { lv: 720, name: "ë¬´í•œì˜ íë¸Œ", icon: "ğŸ§Š" },
            { lv: 730, name: "ì§„ë¦¬ì˜ ì„œ", icon: "ğŸ“–" }, { lv: 740, name: "ê³µí—ˆì˜ ëˆˆ", icon: "ğŸ‘ï¸" }, { lv: 750, name: "ì¡´ì¬ì˜ ì†Œë©¸", icon: "âŒ" },
            { lv: 760, name: "ìš´ëª…ì˜ ê°€ìœ„", icon: "âœ‚ï¸" }, { lv: 770, name: "ì˜í˜¼ì˜ ë“±ë¶ˆ", icon: "ğŸ®" }, { lv: 780, name: "ì°¨ì› ë„ì•½ ì¥ì¹˜", icon: "ğŸš€" },
            { lv: 790, name: "ì ˆëŒ€ ì˜ë„", icon: "â„ï¸" },

            { lv: 800, name: "ì‹œìŠ¤í…œ ê´€ë¦¬ì ê¶Œí•œ", icon: "ğŸ”‘" }, { lv: 810, name: "ë²„ê·¸ ë©ì–´ë¦¬", icon: "ğŸ‘¾" }, { lv: 820, name: "ê¸€ë¦¬ì¹˜ ì†Œë“œ", icon: "ğŸ—¡ï¸" },
            { lv: 830, name: "ë¸”ë£¨ìŠ¤í¬ë¦° ë°©íŒ¨", icon: "ğŸŸ¦" }, { lv: 840, name: "ê°•ì œ ì¢…ë£Œ ë²„íŠ¼", icon: "â¹ï¸" }, { lv: 850, name: "ë°ì´í„° ì‚­ì œ", icon: "ğŸ—‘ï¸" },
            { lv: 860, name: "ì½”ë“œ ì¡°ì‘ê¸°", icon: "âŒ¨ï¸" }, { lv: 870, name: "ë°©í™”ë²½ í•´ì œ", icon: "ğŸ”¥" }, { lv: 880, name: "ë°”ì´ëŸ¬ìŠ¤ ì£¼ì…", icon: "ğŸ’‰" },
            { lv: 890, name: "ì„œë²„ í­íŒŒ", icon: "ğŸ’£" },

            { lv: 900, name: "ì°½ì¡°ì˜ ë¹›", icon: "âœ¨" }, { lv: 910, name: "íŒŒê´´ì˜ ì–´ë‘ ", icon: "ğŸŒ‘" }, { lv: 920, name: "ì‹œì‘ê³¼ ë", icon: "ğŸ”„" },
            { lv: 930, name: "ìš°ì£¼ ì¬ë¶€íŒ…", icon: "ğŸ”Œ" }, { lv: 940, name: "ê°œë°œìì˜ ë§ˆìš°ìŠ¤", icon: "ğŸ–±ï¸" }, { lv: 950, name: "ê°œë°œìì˜ í‚¤ë³´ë“œ", icon: "âŒ¨ï¸" },
            { lv: 960, name: "ì†ŒìŠ¤ ì½”ë“œ", icon: "ğŸ“œ" }, { lv: 970, name: "ì—”ë”© í¬ë ˆë”§", icon: "ğŸ¬" }, { lv: 980, name: "ì œ4ì˜ ë²½", icon: "ğŸ§±" },
            { lv: 990, name: "ì „ì§€ì „ëŠ¥", icon: "ğŸ‘‘" }, { lv: 1000, name: "[THE END]", icon: "ğŸ" },

            { lv: 1010, name: "ë””ì§€í„¸ ì†Œìš¸", icon: "ğŸ’¾" }, { lv: 1050, name: "ì–‘ì ì–½í˜ ë‚«", icon: "ğŸ§¬" }, { lv: 1100, name: "ìŠˆë¢°ë”©ê±°ì˜ ê²€", icon: "ğŸˆ" },
            { lv: 1150, name: "íƒ€ì„ íŒ¨ëŸ¬ë…ìŠ¤", icon: "â³" }, { lv: 1200, name: "ë‚˜ë¹„ íš¨ê³¼", icon: "ğŸ¦‹" }, { lv: 1250, name: "í‰í–‰ìš°ì£¼ ì—´ì‡ ", icon: "ğŸ”‘" },
            { lv: 1300, name: "ì•„ì¹´ì‹ ë ˆì½”ë“œ", icon: "ğŸ“š" }, { lv: 1350, name: "ì²œìƒì˜ ë‚˜íŒ”", icon: "ğŸº" }, { lv: 1400, name: "ë£¨ì‹œí¼ì˜ ë¿”", icon: "ğŸ‘¿" },
            { lv: 1450, name: "ë¯¸ì¹´ì—˜ì˜ ê²€", icon: "âš”ï¸" }, { lv: 1500, name: "ë¹… í¬ëŸ°ì¹˜", icon: "ğŸŒŒ" }, { lv: 1550, name: "ì—”íŠ¸ë¡œí”¼ ì—­ì „", icon: "â†©ï¸" },
            { lv: 1600, name: "ì•”í‘ ì—ë„ˆì§€ í¬", icon: "ğŸ”«" }, { lv: 1650, name: "ë¬´í•œì˜ ê³„ë‹¨", icon: "ğŸªœ" }, { lv: 1700, name: "ë«¼ë¹„ìš°ìŠ¤ì˜ ë ", icon: "â™¾ï¸" },
            { lv: 1750, name: "ì´ë°ì•„ì˜ í˜•ìƒ", icon: "ğŸ—¿" }, { lv: 1800, name: "ì‘ê°€ì˜ íœ", icon: "âœ’ï¸" }, { lv: 1850, name: "ì„¤ì • ë¶•ê´´", icon: "ğŸ’¥" },
            { lv: 1900, name: "ë°ìš°ìŠ¤ ì—‘ìŠ¤ ë§ˆí‚¤ë‚˜", icon: "ğŸ¤–" }, { lv: 1950, name: "ê²Œì„ ì—”ì§„", icon: "âš™ï¸" }, { lv: 2000, name: "ì ˆëŒ€ì  ì¡´ì¬", icon: "ğŸ‘ï¸" }
        ];

        const armorDB = [
            { lv: 0, name: "ë§¨ëª¸", icon: "ğŸ‘•", hp: 1000 }, { lv: 10, name: "ì¼ë°˜ ê°‘ì˜·", icon: "ğŸ§¥", hp: 5000 }, { lv: 20, name: "ì²  ê°‘ì˜·", icon: "ğŸ›¡ï¸", hp: 20000 },
            { lv: 30, name: "ë‹¤ì´ì•„ ê°‘ì˜·", icon: "ğŸ’", hp: 100000 }, { lv: 40, name: "ì—ë©”ë„ë“œ ê°‘ì˜·", icon: "â‡ï¸", hp: 500000 }, { lv: 50, name: "ì‹ ì˜ ê°‘ì˜·", icon: "ğŸ‘¼", hp: 2000000 },
            { lv: 60, name: "ê´´ë¬¼ì˜ ê°€ì£½", icon: "ğŸ‘¹", hp: 5000000 }, { lv: 70, name: "ì§€ì˜¥ì˜ ê°‘ì£¼", icon: "ğŸ”¥", hp: 10000000 }, { lv: 100, name: "ì‚¬ì´ë³´ê·¸ ê°‘ì˜·", icon: "ğŸ¤–", hp: 50000000 },
            { lv: 110, name: "ì™¸ê³„ì¸ ê°‘ì˜·", icon: "ğŸ‘½", hp: 200000000 }, { lv: 120, name: "ë¶ˆ ê°‘ì˜·", icon: "ğŸ”¥", hp: 500000000 }, { lv: 130, name: "ë¬¼ ê°‘ì˜·", icon: "ğŸ’§", hp: 1000000000 }, { lv: 140, name: "ì „ê¸° ê°‘ì˜·", icon: "âš¡", hp: 2000000000 },
            { lv: 150, name: "ë¸”ë™í™€ ê°‘ì˜·", icon: "ğŸŒŒ", hp: 50000000000 },
            { lv: 200, name: "ë‚˜ë…¸ ìŠˆíŠ¸", icon: "ğŸ§¬", hp: 100000000000 }, { lv: 300, name: "ë¹„ë¸Œë¼ëŠ„ ê°‘ì˜·", icon: "ğŸ›¡ï¸", hp: 500000000000 },
            { lv: 500, name: "í•­ì„± ê°‘ì˜·", icon: "â˜€ï¸", hp: 2000000000000 }, { lv: 800, name: "ì€í•˜ìˆ˜ ë§í† ", icon: "ğŸŒŒ", hp: 10000000000000 },
            { lv: 1000, name: "ì‹ ì˜ ê¶ŒëŠ¥", icon: "ğŸ‘‘", hp: 50000000000000 }, { lv: 1500, name: "ì°¨ì›ì˜ ì§€ë°°ì", icon: "ğŸŒ€", hp: 100000000000000 },
            { lv: 2000, name: "ê°œë°œìì˜ í›„ë“œí‹°", icon: "ğŸ’»", hp: 999999999999999 }
        ];

        function saveGame() { 
            gameData.currentDungeonWave = dungeonWave; 
            localStorage.setItem("rpg_v48_xmas_save", JSON.stringify(gameData)); 
        }
        function manualSave() { saveGame(); alert("ì €ì¥ ì™„ë£Œ!"); }
        function loadGame() {
            const saved = localStorage.getItem("rpg_v48_xmas_save");
            if(saved) {
                let parsed = JSON.parse(saved);
                if(parsed.armorLevel !== undefined && parsed.maxArmorLevel === undefined) { parsed.maxArmorLevel = parsed.armorLevel; parsed.equippedArmorLevel = parsed.armorLevel; }
                gameData = { ...gameData, ...parsed };
                if(gameData.currentDungeonWave) dungeonWave = gameData.currentDungeonWave;
            }
            // ë³€ìˆ˜ ì´ˆê¸°í™” ì•ˆì „ì¥ì¹˜
            if(isNaN(gameData.coins)) gameData.coins = 0;
            if(isNaN(gameData.weaponLevel)) gameData.weaponLevel = 0;
            if(isNaN(gameData.potions)) gameData.potions = 5;
            if(isNaN(gameData.damagePotions)) gameData.damagePotions = 0; 
            if(isNaN(gameData.defensePotions)) gameData.defensePotions = 0; 
            if(isNaN(gameData.superPotionHp)) gameData.superPotionHp = 0; 
            if(isNaN(gameData.superPotionAtk)) gameData.superPotionAtk = 0; 
            if(isNaN(gameData.superPotionDef)) gameData.superPotionDef = 0; 
            if(isNaN(gameData.prisonRealm)) gameData.prisonRealm = 0;
            if(isNaN(gameData.sukunaFingers)) gameData.sukunaFingers = 0;
            if(isNaN(gameData.eatenFingers)) gameData.eatenFingers = 0;
            if(isNaN(gameData.raidTickets)) gameData.raidTickets = 0; 
            if(isNaN(dungeonWave)) dungeonWave = 1;

            renderWeaponInventory(); renderArmorInventory(); updateUI();
        }
        function resetGame() { if(confirm("ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.removeItem("rpg_v48_xmas_save"); location.reload(); } }
        setInterval(saveGame, 10000);
        setInterval(updateSkillCoolDowns, 100);

        function useCode() {
            const input = document.getElementById('codeInput').value.trim();
            let valid = false;
            if (input === 'dlalsgh1215') { gameData.coins += 10000000000; queueReward("100ì–µ ì½”ì¸", "ğŸ’°"); AudioEngine.sfx.coin(); valid=true; }
            else if (input === 'yyyuy') { gameData.prisonRealm += 10; queueReward("ì˜¥ë¬¸ê°• 10ê°œ", "ğŸ“¦"); AudioEngine.sfx.gacha(); valid=true; }
            else if (input === 'gg100k') { if(!gameData.hasDragonflyNet) { gameData.hasDragonflyNet=true; queueReward("ì ìë¦¬ì±„", "ğŸ•¸ï¸"); renderWeaponInventory(); } valid=true; }
            else if (input === '67') { if(!gameData.hasAdminWeapon) { gameData.hasAdminWeapon=true; queueReward("67 ë¬´ê¸°", "6ï¸âƒ£7ï¸âƒ£"); renderWeaponInventory(); } valid=true; }
            else if (input === 'gg') { gameData.sukunaFingers += 5; if(!gameData.hasSukunaFinger) { gameData.hasSukunaFinger = true; queueReward("ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½(ë¬´ê¸°)", "ğŸ§Ÿ"); } queueReward("ì†ê°€ë½ 5ê°œ", "ğŸ§Ÿ"); renderWeaponInventory(); AudioEngine.sfx.gacha(); valid=true; }
            else if (input === '444') { if(!gameData.hasThornArmor) { gameData.hasThornArmor = true; queueReward("ê°€ì‹œ ê°‘ì˜·", "ğŸŒµ"); renderArmorInventory(); AudioEngine.sfx.gacha(); } else { alert("ì´ë¯¸ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤."); } valid=true; }
            else if (input === 'eg') { gameData.potions += 100; gameData.damagePotions += 100; gameData.defensePotions += 100; queueReward("ë¬¼ì•½ ì„¸íŠ¸ (ê° 100ê°œ)", "ğŸ§ª"); AudioEngine.sfx.potion(); valid=true; }
            else if (input === '1234') { gameData.raidTickets += 50; queueReward("ë ˆì´ë“œ í‹°ì¼“ 50ì¥", "ğŸŸï¸"); AudioEngine.sfx.gacha(); valid=true; } 
            else if (input === 'xmas2025') { gameData.hasCandyStaff = true; gameData.hasCandyScythe = true; gameData.hasCandyKatana = true; queueReward("í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì„ ë¬¼ ì„¸íŠ¸", "ğŸ"); renderWeaponInventory(); valid=true;}
            else { alert("âŒ í‹€ë¦° ì½”ë“œì…ë‹ˆë‹¤."); }
            document.getElementById('codeInput').value = ""; if(valid) { saveGame(); updateUI(); }
        }

        function eatFinger() {
            if(gameData.sukunaFingers > 0) { gameData.sukunaFingers--; gameData.eatenFingers++; log('town', `ğŸ§Ÿ ê¿€êº½.. í˜ì´ ì†Ÿì•„ë‚œë‹¤! (ë°ë¯¸ì§€ x${Math.pow(2, gameData.eatenFingers).toLocaleString()})`); AudioEngine.sfx.levelUp(); updateUI(); saveGame(); } else { alert("ë¨¹ì„ ì†ê°€ë½ì´ ì—†ìŠµë‹ˆë‹¤!"); }
        }

        // === ğŸ¦‹ ë“œë˜ê³¤ ë‚ ê°œ ì‚¬ìš© ===
        function useDragonWing() {
            if(!gameData.hasDragonWing) return;
            // 1ì‹œê°„ = 3600ì´ˆ = 3600000ms
            buffDamageMult = 1000;
            buffDefenseMult = 0.001; // ë°›ëŠ” í”¼í•´ 1/1000
            
            // ê¸°ì¡´ íƒ€ì´ë¨¸ ì œê±°
            if(buffTimers.atk) clearTimeout(buffTimers.atk);
            if(buffTimers.def) clearTimeout(buffTimers.def);

            // 1ì‹œê°„ í›„ ë²„í”„ ì¢…ë£Œ íƒ€ì´ë¨¸
            buffTimers.atk = setTimeout(() => { buffDamageMult = 1; updateBuffIcons(); alert("ë“œë˜ê³¤ ë‚ ê°œ ë²„í”„(ê³µê²©) ì¢…ë£Œ"); }, 3600000);
            buffTimers.def = setTimeout(() => { buffDefenseMult = 1; updateBuffIcons(); alert("ë“œë˜ê³¤ ë‚ ê°œ ë²„í”„(ë°©ì–´) ì¢…ë£Œ"); }, 3600000);
            
            updateBuffIcons();
            log('town', "ğŸ¦‹ ë“œë˜ê³¤ ë‚ ê°œ ì‚¬ìš©! (1ì‹œê°„ ë™ì•ˆ ëª¨ë“  ëŠ¥ë ¥ì¹˜ 1000ë°°)");
            alert("ğŸ¦‹ ë“œë˜ê³¤ ë‚ ê°œë¥¼ í¼ì³¤ìŠµë‹ˆë‹¤!\n1ì‹œê°„ ë™ì•ˆ ê³µê²©ë ¥/ë°©ì–´ë ¥ì´ 1000ë°°ê°€ ë©ë‹ˆë‹¤.");
        }

        // === ìƒì¸ ì‹œìŠ¤í…œ ===
        function buyItem(type) {
            let cost = 0;
            let name = "";
            
            if (type === 'dragonFan') { cost = 100000000; name = "ë“œë˜ê³¤ ë¶€ì±„"; }
            else if (type === 'dragonClone') { cost = 150000000; name = "ë“œë˜ê³¤ í´ë¡ "; } // ë‹¨ê²€ë³´ë‹¤ ìŒˆ
            else if (type === 'dragonHead') { cost = 200000000; name = "ë“œë˜ê³¤ í—¤ë“œ"; }
            else if (type === 'dragonDagger') { cost = 500000000; name = "ë“œë˜ê³¤ ë‹¨ê²€"; }
            else if (type === 'superHp') { cost = 5000000; name = "ì´ˆì›” HP ë¬¼ì•½"; }
            else if (type === 'superAtk') { cost = 5000000; name = "ì´ˆì›” ê³µê²© ë¬¼ì•½"; }
            else if (type === 'superDef') { cost = 5000000; name = "ì´ˆì›” ë°©ì–´ ë¬¼ì•½"; }

            if (gameData.coins < cost) { alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!"); return; }
            
            if (type === 'dragonFan') { if(gameData.hasDragonFan) { alert("ì´ë¯¸ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤."); return; } gameData.hasDragonFan = true; renderWeaponInventory(); }
            else if (type === 'dragonClone') { if(gameData.hasDragonClone) { alert("ì´ë¯¸ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤."); return; } gameData.hasDragonClone = true; renderWeaponInventory(); }
            else if (type === 'dragonHead') { if(gameData.hasDragonHead) { alert("ì´ë¯¸ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤."); return; } gameData.hasDragonHead = true; renderArmorInventory(); }
            else if (type === 'dragonDagger') { if(gameData.hasDragonDagger) { alert("ì´ë¯¸ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤."); return; } gameData.hasDragonDagger = true; renderWeaponInventory(); }
            else if (type === 'superHp') { gameData.superPotionHp++; }
            else if (type === 'superAtk') { gameData.superPotionAtk++; }
            else if (type === 'superDef') { gameData.superPotionDef++; }

            gameData.coins -= cost;
            alert(`${name} êµ¬ë§¤ ì™„ë£Œ!`);
            saveGame();
            updateUI();
            AudioEngine.sfx.coin();
        }

        // === ë¬¼ì•½ ì‹œìŠ¤í…œ (ì´ˆì›” ë¬¼ì•½ ì¶”ê°€) ===
        function drinkPotion(type) {
            if (type === 'hp') { if(gameData.potions > 0) { gameData.potions--; playerCurrentHp = playerMaxHp; log('raid', "ì²´ë ¥ íšŒë³µ!"); if(document.getElementById('dungeonScreen').classList.contains('active')) updateDungeonHP(); else updateRaidUI(); } else log('town', "HP ë¬¼ì•½ ë¶€ì¡±!"); } 
            else if (type === 'atk') { 
                if(gameData.damagePotions > 0) { 
                    gameData.damagePotions--; 
                    buffDamageMult = 2; 
                    if(buffTimers.atk) clearTimeout(buffTimers.atk);
                    buffTimers.atk = setTimeout(() => { buffDamageMult = 1; updateBuffIcons(); }, 30000); 
                    alert("âš”ï¸ 30ì´ˆê°„ ê³µê²©ë ¥ 2ë°°! (ë‚ ê°œ ë²„í”„ê°€ ìˆì—ˆë‹¤ë©´ í•´ì œë©ë‹ˆë‹¤)"); 
                } else log('town', "ê³µê²© ë¬¼ì•½ ë¶€ì¡±!"); 
            } 
            else if (type === 'def') { 
                if(gameData.defensePotions > 0) { 
                    gameData.defensePotions--; 
                    buffDefenseMult = 0.5; 
                    if(buffTimers.def) clearTimeout(buffTimers.def);
                    buffTimers.def = setTimeout(() => { buffDefenseMult = 1; updateBuffIcons(); }, 30000); 
                    alert("ğŸ›¡ï¸ 30ì´ˆê°„ ë°©ì–´ë ¥ 2ë°°! (ë‚ ê°œ ë²„í”„ê°€ ìˆì—ˆë‹¤ë©´ í•´ì œë©ë‹ˆë‹¤)"); 
                } else log('town', "ë°©ì–´ ë¬¼ì•½ ë¶€ì¡±!"); 
            }
            AudioEngine.sfx.potion(); updateUI(); updateBuffIcons();
        }

        function drinkSuperPotion(type) {
            if (type === 'hp') { 
                if(gameData.superPotionHp > 0) { 
                    gameData.superPotionHp--; 
                    playerCurrentHp = playerMaxHp * 50; // ì´ˆì›” íšŒë³µ (ì¼ì‹œì  ì˜¤ë²„í)
                    log('raid', "ì´ˆì›” ì²´ë ¥ íšŒë³µ!"); 
                    if(document.getElementById('dungeonScreen').classList.contains('active')) updateDungeonHP(); else updateRaidUI(); 
                } else alert("ì´ˆì›” HP ë¬¼ì•½ì´ ì—†ìŠµë‹ˆë‹¤!"); 
            } 
            else if (type === 'atk') { 
                if(gameData.superPotionAtk > 0) { 
                    gameData.superPotionAtk--; 
                    buffDamageMult = 50; 
                    if(buffTimers.atk) clearTimeout(buffTimers.atk);
                    buffTimers.atk = setTimeout(() => { buffDamageMult = 1; updateBuffIcons(); }, 30000); 
                    alert("âš”ï¸ 30ì´ˆê°„ ê³µê²©ë ¥ 50ë°°! (ë‚ ê°œ ë²„í”„ê°€ ìˆì—ˆë‹¤ë©´ í•´ì œë©ë‹ˆë‹¤)"); 
                } else alert("ì´ˆì›” ê³µê²© ë¬¼ì•½ì´ ì—†ìŠµë‹ˆë‹¤!"); 
            } 
            else if (type === 'def') { 
                if(gameData.superPotionDef > 0) { 
                    gameData.superPotionDef--; 
                    buffDefenseMult = 0.01; // ë°ë¯¸ì§€ 1/100
                    if(buffTimers.def) clearTimeout(buffTimers.def);
                    buffTimers.def = setTimeout(() => { buffDefenseMult = 1; updateBuffIcons(); }, 30000); 
                    alert("ğŸ›¡ï¸ 30ì´ˆê°„ ë°©ì–´ë ¥ 100ë°°! (ë‚ ê°œ ë²„í”„ê°€ ìˆì—ˆë‹¤ë©´ í•´ì œë©ë‹ˆë‹¤)"); 
                } else alert("ì´ˆì›” ë°©ì–´ ë¬¼ì•½ì´ ì—†ìŠµë‹ˆë‹¤!"); 
            }
            AudioEngine.sfx.potion(); updateUI(); updateBuffIcons();
        }

        function updateBuffIcons() { const container = document.getElementById('buffIcons'); container.innerHTML = ""; if(buffDamageMult > 1) container.innerHTML += `<div>âš”ï¸ x${buffDamageMult}</div>`; if(buffDefenseMult < 1) container.innerHTML += `<div>ğŸ›¡ï¸ x${Math.round(1/buffDefenseMult)}</div>`; }
        function dropRandomPotion() { let rand = Math.random(); if(rand < 0.33) { gameData.potions++; return "ğŸ§ª HPë¬¼ì•½"; } else if(rand < 0.66) { gameData.damagePotions++; return "âš”ï¸ ê³µê²©ë¬¼ì•½"; } else { gameData.defensePotions++; return "ğŸ›¡ï¸ ë°©ì–´ë¬¼ì•½"; } }

        let rewardQueue = []; let isShowingReward = false;
        function queueReward(name, icon) { rewardQueue.push({name, icon}); if(!isShowingReward) showNextReward(); }
        function showNextReward() {
            if(rewardQueue.length === 0) { isShowingReward = false; document.getElementById('rewardOverlay').style.display = 'none'; if(document.getElementById('raidScreen').classList.contains('active') && raidHp <= 0) changeScreen('townScreen'); return; }
            isShowingReward = true; let reward = rewardQueue.shift(); document.getElementById('rewardName').innerText = reward.name; document.getElementById('rewardIcon').innerText = reward.icon; document.getElementById('rewardOverlay').style.display = 'flex'; AudioEngine.sfx.levelUp();
        }
        function nextReward() { showNextReward(); }

        // === âš”ï¸ ìŠ¤í‚¬ ì‹œìŠ¤í…œ (B ë²„íŠ¼ ì¶”ê°€) ===
        function getWeaponSkillInfo() {
            const weapon = getCurrentDisplayWeapon();
            let name = weapon.name;

            if(name === "ì‹ ì˜ êµ¬ìŠ¬") { return { Z: { mult: 100, name: "ì°½ì¡°" }, X: { mult: 200, name: "íŒŒê´´" }, C: { mult: 400, name: "ì‹œê°„ ì—­í–‰" }, V: { mult: 1000, name: "ë¹…ë±…" }, B: { mult: 99999, name: "ì†Œë©¸" } }; }
            
            // í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ìŠ¤í‚¬
            if(name === "ìº”ë”” ë‚«") return { Z: { mult: 800, name: "ì‚¬íƒ• ë² ê¸°" }, X: { mult: 1500, name: "ë‹¬ì½¤í•œ ì£½ìŒ" }, C: { mult: 3000, name: "ì„ ë¬¼ í­íƒ„" }, V: { mult: 80000, name: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì•…ëª½" } };
            if(name === "ìº”ë”” ì¹´íƒ€ë‚˜") return { Z: { mult: 500, name: "ë°œë„" }, X: { mult: 1000, name: "ì—°ì† ë² ê¸°" }, C: { mult: 2500, name: "ëˆˆê½ƒ ì¶¤" }, V: { mult: 60000, name: "ì„±íƒ„ì ˆì˜ ê²€" } };
            if(name === "ìº”ë”” ì§€íŒ¡ì´") return { Z: { mult: 300, name: "ë§¤ì§ ë³¼" }, X: { mult: 600, name: "ì§€íŒ¡ì´ íƒ€ê²©" }, C: { mult: 1200, name: "ë£¨ëŒí”„ ì†Œí™˜" }, V: { mult: 40000, name: "ë©”í…Œì˜¤ ìº”ë””" } };

            // ì‹ ê·œ ë¬´ê¸° ìŠ¤í‚¬
            if(name === "ë“œë˜ê³¤ ë¶€ì±„") return { Z: { mult: 10, name: "ëŒí’" }, X: { mult: 20, name: "ìš©ì˜¤ë¦„" }, C: { mult: 40, name: "íƒœí’" }, V: { mult: 80, name: "ë“œë˜ê³¤ ë¸Œë ˆìŠ¤" } };
            if(name === "ë“œë˜ê³¤ ë‹¨ê²€") return { Z: { mult: 500, name: "ìš©ì˜ ë°œí†±" }, X: { mult: 1000, name: "ì—­ë¦° ì°Œë¥´ê¸°" }, C: { mult: 2000, name: "ìš©ì˜ ë¶„ë…¸" }, V: { mult: 999999, name: "ë“œë˜ê³¤ ìŠ¬ë ˆì´ì–´" } };
            // ë“œë˜ê³¤ í´ë¡  (ë‹¨ê²€ë³´ë‹¤ ì•½í•˜ê²Œ)
            if(name === "ë“œë˜ê³¤ í´ë¡ ") return { Z: { mult: 200, name: "ì¹´í”¼ ë°œí†±" }, X: { mult: 400, name: "í™˜ì˜" }, C: { mult: 800, name: "ê°€ì§œ ë¶„ë…¸" }, V: { mult: 50000, name: "ì´ë¯¸í…Œì´ì…˜ ì–´íƒ" } };
            // ë“œë˜ê³¤ ì±„ì° (ë‹¨ê²€ë³´ë‹¤ ê°•í•˜ê²Œ)
            if(name === "ë“œë˜ê³¤ ì±„ì°") return { Z: { mult: 2000, name: "ìš©ì˜ ê¼¬ë¦¬ì¹˜ê¸°" }, X: { mult: 4000, name: "í™”ì—¼ íœ˜ë‘ë¥´ê¸°" }, C: { mult: 8000, name: "ì†ë°•" }, V: { mult: 9999999, name: "ì§€êµ¬ ë©¸ë§ì˜ ì±„ì°" }, B: { mult: 50000000, name: "ì€í•˜ íŒŒê´´" } };


            if(name === "ì•…ë§ˆì˜ ë¿”") return { Z: { mult: 5, name: "ì°Œë¥´ê¸°" }, X: { mult: 10, name: "ëŒì§„" }, C: { mult: 20, name: "ì§€ì˜¥ì˜ ë¶€ë¦„" }, V: { mult: 50, name: "ì•…ë§ˆí™”" } };
            if(name === "ì²œì‚¬ì˜ ë§") return { Z: { mult: 6, name: "ë¹›" }, X: { mult: 12, name: "ì‹¬íŒ" }, C: { mult: 24, name: "ì¶•ë³µ" }, V: { mult: 60, name: "ì²œë²Œ" } };
            if(name === "ì²™ì¶” ì†") return { Z: { mult: 8, name: "í• í€´ê¸°" }, X: { mult: 16, name: "ë¼ˆ ê°ì˜¥" }, C: { mult: 32, name: "ì£½ìŒì˜ ì†ê¸¸" }, V: { mult: 80, name: "ìŠ¤ì¼ˆë ˆí†¤ êµ°ë‹¨" } };

            if(name === "ì§€ì˜¥ì˜ í™œ") return { Z: { mult: 3.0, name: "ë¶ˆí™”ì‚´" }, X: { mult: 4.5, name: "ì—°ì† ë°œì‚¬" }, C: { mult: 8.0, name: "í­ë°œ í™”ì‚´" }, V: { mult: 15.0, name: "ì§€ì˜¥ë¶ˆ ë¹„" } };
            if(name === "ì‚¬ì‹ ì˜ ë‚«") return { Z: { mult: 3.5, name: "ì˜í˜¼ ë² ê¸°" }, X: { mult: 5.0, name: "ì‚¬ì‹ ì˜ ì¶¤" }, C: { mult: 10.0, name: "ìˆ˜í™•" }, V: { mult: 20.0, name: "ì£½ìŒì˜ ì„ ê³ " } };
            if(name === "ë“€ì–¼ ë‹¨ê²€") return { Z: { mult: 4.0, name: "ë”ë¸” ìŠ¤íƒ­" }, X: { mult: 6.0, name: "ì•”ìŠµ" }, C: { mult: 12.0, name: "ê·¸ë¦¼ì ë¶„ì‹ " }, V: { mult: 25.0, name: "ë¬´í•œì˜ ì¹¼ë‚ " } };
            if(name.includes("íˆë“œë¼")) return { Z: { mult: 5.0, name: "ë§¹ë… ì£¼ì…" }, X: { mult: 8.0, name: "ì¬ìƒì˜ í˜" }, C: { mult: 15.0, name: "ë¨¸ë¦¬ ì¬ìƒ" }, V: { mult: 30.0, name: "íˆë“œë¼ ì†Œí™˜" } };
            if(name === "ë¶ˆì‚¬ì¡° ê¹ƒí„¸") return { Z: { mult: 6.0, name: "í™”ì—¼ ê°•íƒ€" }, X: { mult: 10.0, name: "ë¶€í™œì˜ ë¶ˆê½ƒ" }, C: { mult: 20.0, name: "ë¶ˆì˜ ë‚ ê°œ" }, V: { mult: 40.0, name: "ëŒ€í­ë°œ" } };
            if(name === "ì¡°ì»¤ ì¹´ë“œ") return { Z: { mult: 7.0, name: "ì¹´ë“œ íˆ¬ì²™" }, X: { mult: 12.0, name: "íŠ¸ë¦­" }, C: { mult: 25.0, name: "ë¡œì–„ í”ŒëŸ¬ì‹œ" }, V: { mult: 50.0, name: "ì¡°ì»¤ì˜ ì›ƒìŒ" } };
            if(name.includes("1x")) return { Z: { mult: 10.0, name: "í”½ì…€ íƒ€ê²©" }, X: { mult: 20.0, name: "ë°ì´í„° ì˜¤ë¥˜" }, C: { mult: 40.0, name: "ë ‰ ìœ ë°œ" }, V: { mult: 80.0, name: "ê°•ì œ ì‚­ì œ" } };
            if(name === "ë“€ì–¼ ë‚«") return { Z: { mult: 15.0, name: "ìŒë‚  ë² ê¸°" }, X: { mult: 30.0, name: "ì˜í˜¼ í­í’" }, C: { mult: 60.0, name: "ì§€ì˜¥ì˜ ë¬¸" }, V: { mult: 120.0, name: "ì‹¬íŒ" } };
            if(name === "ê²€ì€ ì•ˆëŒ€" || name.includes("ê³ ì£ ")) return { Z: { mult: 50.0, name: "ìˆ ì‹ ìˆœì „: ì°½" }, X: { mult: 100.0, name: "ìˆ ì‹ ë°˜ì „: í˜" }, C: { mult: 200.0, name: "í—ˆì‹: ì" }, V: { mult: 500.0, name: "ë¬´ëŸ‰ê³µì²˜" } };
            if(name === "ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½") return { Z: { mult: 20, name: "í•´" }, X: { mult: 40, name: "íŒ”" }, C: { mult: 80, name: "í‘¸ê°€" }, V: { mult: 300, name: "ë³µë§ˆì–´ì£¼ì" } };
            if(name === "67 ë¬´ê¸°") return { Z: { mult: 100, name: "í‚¥" }, X: { mult: 100, name: "ë°´" }, C: { mult: 100, name: "ë®¤íŠ¸" }, V: { fixed: 9999999999, name: "ì„œë²„ ì¢…ë£Œ" } };
            if(name === "ê¸€ë¦¬ì¹˜ ê¸°íƒ€") return { Z: { mult: 150, name: "ë…¸ì´ì¦ˆ" }, X: { mult: 300, name: "ì™œê³¡" }, C: { mult: 600, name: "ë¸”ë£¨ìŠ¤í¬ë¦°" }, V: { mult: 1200, name: "ì‹œìŠ¤í…œ ë¶•ê´´" } };
            if(name === "ê¸€ë¦¬ì¹˜ ì „ê¸°í†±") return { Z: { mult: 50, name: "ì‹œë™ ê±¸ê¸°" }, X: { mult: 100, name: "ë‚œë„ì§ˆ" }, C: { mult: 200, name: "ì—”ì§„ ê³¼ì—´" }, V: { mult: 666, name: "ì‹œìŠ¤í…œ ì ˆë‹¨" } };
            
            return { Z: { mult: 2.0, name: "ê°•íƒ€" }, X: { mult: 3.5, name: "ì—°íƒ€" }, C: { mult: 5.0, name: "ìŠ¤ë§¤ì‹œ" }, V: { mult: 10.0, name: "ê¶ê·¹ê¸°" } };
        }

        function useSkill(key) {
            const now = Date.now();
            if (now < skillCD[key]) return; 
            const skills = getWeaponSkillInfo();
            if(!skills[key]) return;

            skillCD[key] = now + MAX_CD[key];
            skillActiveTime[key] = now; 
            updateSkillButtons();
            
            let skillName = skills[key].name;
            let logTarget = 'battle';
            if(document.getElementById('dungeonScreen').classList.contains('active')) logTarget = 'dungeon';
            if(document.getElementById('raidScreen').classList.contains('active')) logTarget = 'raid';
            
            log(logTarget, `[${key}] ${skillName} ë°œë™!`);
            AudioEngine.sfx.attack();
            
            if(document.getElementById('raidScreen').classList.contains('active')) attackRaidBoss();
            else if(document.getElementById('dungeonScreen').classList.contains('active')) attackDungeonMonster();
            else if(document.getElementById('fieldScreen').classList.contains('active') && document.getElementById('attackBtn').style.display !== 'none') attackMonster();
        }

        function updateSkillButtons() {
            const containers = ['dungeonSkills', 'battleSkills', 'raidSkills'];
            const skills = getWeaponSkillInfo();
            const keys = ['Z', 'X', 'C', 'V', 'B']; 

            containers.forEach(id => {
                const el = document.getElementById(id);
                if (!el.hasChildNodes()) {
                    keys.forEach(key => {
                        let btn = document.createElement('div');
                        btn.className = 'btn-skill';
                        btn.onclick = () => useSkill(key);
                        btn.innerHTML = `<span class="skill-key">${key}</span><span class="skill-name" id="${id}_name_${key}">${skills[key] ? skills[key].name : '-'}</span><div class="skill-overlay" id="${id}_overlay_${key}"></div>`;
                        el.appendChild(btn);
                    });
                } else {
                     keys.forEach(key => {
                        const nameEl = document.getElementById(`${id}_name_${key}`);
                        if(nameEl) nameEl.innerText = skills[key] ? skills[key].name : '-';
                    });
                }
            });
        }

        function updateSkillCoolDowns() {
            const containers = ['dungeonSkills', 'battleSkills', 'raidSkills'];
            const now = Date.now();
            const keys = ['Z', 'X', 'C', 'V', 'B'];

            containers.forEach(cId => {
                if(!document.getElementById(cId).parentElement.classList.contains('active')) return;
                keys.forEach(key => {
                    const overlay = document.getElementById(`${cId}_overlay_${key}`);
                    if (overlay) {
                        let remaining = skillCD[key] - now;
                        if (remaining < 0) remaining = 0;
                        let pct = (remaining / MAX_CD[key]) * 100;
                        overlay.style.height = pct + "%";
                    }
                });
            });
        }

        // === âš”ï¸ ë°ë¯¸ì§€ ê³„ì‚° ===
        function calculateDamage() {
            let weapon = getCurrentDisplayWeapon(); 
            let tierBonus = 0;
            const name = weapon.name;

            if(name === "ë“œë˜ê³¤ ë‹¨ê²€") tierBonus = 500000000000; // ìµœê°• (ê³ ì£ /ìŠ¤ì¿ ë‚˜/ì ˆëŒ€ì‹ ë³´ë‹¤ ë†’ìŒ)
            else if(name === "ë“œë˜ê³¤ í´ë¡ ") tierBonus = 100000000000; // ë‹¨ê²€ë³´ë‹¤ ì•½í•¨ (1/5 ìˆ˜ì¤€)
            else if(name === "ë“œë˜ê³¤ ì±„ì°") tierBonus = 2000000000000; // ë‹¨ê²€ë³´ë‹¤ ê°•í•¨
            else if(name === "ë“œë˜ê³¤ ë¶€ì±„") tierBonus = 3000000000;

            else if(name === "ìº”ë”” ë‚«") tierBonus = 300000000000; // ë“œë˜ê³¤ í´ë¡ ë³´ë‹¤ ê°•í•¨
            else if(name === "ìº”ë”” ì¹´íƒ€ë‚˜") tierBonus = 80000000000;
            else if(name === "ìº”ë”” ì§€íŒ¡ì´") tierBonus = 20000000000;

            else if(name === "ì§€ì˜¥ì˜ í™œ") tierBonus = 50000;
            else if(name === "ì‚¬ì‹ ì˜ ë‚«") tierBonus = 200000;
            else if(name === "ë“€ì–¼ ë‹¨ê²€") tierBonus = 1000000;
            else if(name.includes("íˆë“œë¼")) tierBonus = 5000000;
            else if(name === "ë¶ˆì‚¬ì¡° ê¹ƒí„¸") tierBonus = 25000000;
            else if(name === "ì¡°ì»¤ ì¹´ë“œ") tierBonus = 80000000;
            else if(name.includes("1x")) tierBonus = 200000000;
            else if(name === "ë“€ì–¼ ë‚«") tierBonus = 500000000;
            else if(name === "ê²€ì€ ì•ˆëŒ€") tierBonus = 1000000000;
            else if(name === "ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½") tierBonus = 5000000000;
            else if(name === "ê¸€ë¦¬ì¹˜ ì „ê¸°í†±") tierBonus = 8000000000; 
            else if(name === "ê¸€ë¦¬ì¹˜ ê¸°íƒ€") tierBonus = 9999999999;
            else if(name === "ì•…ë§ˆì˜ ë¿”") tierBonus = 60000000; 
            else if(name === "ì²œì‚¬ì˜ ë§") tierBonus = 300000000; 
            else if(name === "ì²™ì¶” ì†") tierBonus = 2000000000; 
            else if(name === "ì‹ ì˜ êµ¬ìŠ¬") tierBonus = 99999999999;

            let base = (gameData.weaponLevel * 200) + tierBonus + 100;
            if(gameData.eatenFingers > 0) base = base * Math.pow(2, gameData.eatenFingers);
            base = base * buffDamageMult;
            
            let finalDmg = base;
            const now = Date.now();
            let skills = getWeaponSkillInfo();
            let activeSkill = null;
            
            if (now - skillActiveTime.B < 1000 && skills.B) activeSkill = skills.B;
            else if (now - skillActiveTime.V < 1000) activeSkill = skills.V;
            else if (now - skillActiveTime.C < 1000) activeSkill = skills.C;
            else if (now - skillActiveTime.X < 1000) activeSkill = skills.X;
            else if (now - skillActiveTime.Z < 1000) activeSkill = skills.Z;
            
            if (activeSkill) { 
                if (activeSkill.fixed) finalDmg = activeSkill.fixed; 
                else finalDmg = base * activeSkill.mult; 
            }
            
            if (isNaN(finalDmg) || finalDmg < 1) finalDmg = 1; 
            return Math.floor(finalDmg);
        }

        function setMusic(theme) {
            const bar = document.getElementById('musicBar'); const body = document.body;
            AudioEngine.playBGM(theme);
            if(theme === 'town') { bar.innerText = "ğŸµ Music: Peaceful Village Theme"; body.style.backgroundColor = "#050505"; } 
            else if (theme === 'field') { bar.innerText = "ğŸµ Music: Wild Forest Ambience"; body.style.backgroundColor = "#1a1a1a"; } 
            else if (theme === 'dungeon') { bar.innerText = "ğŸµ Music: Ominous Cave (Deep)"; } 
            else if (theme === 'hell') { bar.innerText = "ğŸµ Music: Hellfire Torment"; body.style.backgroundColor = "#2d5a27"; } 
            else if (theme === 'heaven') { bar.innerText = "ğŸµ Music: Heavenly Judgment"; body.style.backgroundColor = "#ecf0f1"; body.style.color = "#2c3e50"; }
            else if (theme === 'skeleton') { bar.innerText = "ğŸµ Music: Skeleton March"; body.style.backgroundColor = "#333333"; body.style.color = "#a0a0a0"; }
            else if (theme === 'dragon') { bar.innerText = "ğŸµ Music: Dragon Roar"; body.style.backgroundColor = "#8B0000"; body.style.color = "#FFD700"; }
            else if (theme === 'raid') { bar.innerText = "ğŸµ Music: Intense Boss Battle"; body.style.backgroundColor = "#2c0000"; }
            else if (theme === 'god') { bar.innerText = "ğŸµ Music: Divine Presence"; body.style.backgroundColor = "#fff"; body.style.color = "#000"; }
            else if (theme === 'christmas') { bar.innerText = "ğŸµ Music: Jingle Bells (8-bit)"; body.style.backgroundColor = "#c0392b"; body.style.color = "#fff"; }
        }

        function toggleAutoAttack(isDungeon) {
            if (autoAttackInterval) { clearInterval(autoAttackInterval); autoAttackInterval = null; document.getElementById('btnAutoField').innerText = "ğŸ¤– ìë™"; document.getElementById('btnAutoDungeon').innerText = "ğŸ¤– ìë™"; } 
            else { document.getElementById('btnAutoField').innerText = "â¹ ì¤‘ë‹¨"; document.getElementById('btnAutoDungeon').innerText = "â¹ ì¤‘ë‹¨"; autoAttackInterval = setInterval(() => { if (isDungeon) { if (document.getElementById('dungeonScreen').classList.contains('active')) attackDungeonMonster(); else toggleAutoAttack(true); } else { if (document.getElementById('fieldScreen').classList.contains('active')) { if(document.getElementById('attackBtn').style.display !== 'none') attackMonster(); else if(document.getElementById('nextMonsterBtn').style.display !== 'none') spawnMonster(); } else toggleAutoAttack(false); } }, 100); }
        }

        function goToDungeonSelect() { changeScreen('dungeonSelectScreen'); }
        function startDungeon(mode) {
            dungeonMode = mode;
            changeScreen('dungeonScreen');
            spawnDungeonMob(); updateDungeonUI(); updateSkillButtons(); 
            let armorHp = 1000;
            if(gameData.equippedArmorName === "ê°€ì‹œ ê°‘ì˜·") armorHp = 50000000000;
            else if(gameData.equippedArmorName === "ë“œë˜ê³¤ í—¤ë“œ") armorHp = 50000000000000; // HP 50ì¡°
            else { let armor = armorDB.find(a => a.lv === gameData.equippedArmorLevel) || armorDB[0]; armorHp = armor.hp; }
            playerMaxHp = armorHp; playerCurrentHp = playerMaxHp; updateDungeonHP(); 
        }

        function leaveDungeon() { if(autoAttackInterval) toggleAutoAttack(true); saveGame(); changeScreen('townScreen'); }
        
        function spawnDungeonMob() {
            const body = document.body; const bar = document.getElementById('musicBar'); const title = document.getElementById('dungeonTitle');
            const dungeonMobName = document.getElementById('dungeonMobName');
            const dungeonMobIcon = document.getElementById('dungeonMobIcon');

            let hpBase = 5000 * Math.pow(1.15, dungeonWave);
            let isBoss = dungeonWave % 10 === 0;

            // í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ëª¨ë“œ ì²˜ë¦¬
            if (dungeonMode === 'christmas') {
                body.style.backgroundColor = "#c0392b"; body.style.color = "#fff"; bar.innerText = "ğŸµ Music: Jingle Bells"; title.innerText = "ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë˜ì „"; AudioEngine.playBGM('christmas');
                
                if(isBoss) {
                     dungeonMobHp = hpBase * 10;
                     dungeonMobName.innerText = `[BOSS] ì‚¬ì•…í•œ ì‚°íƒ€ (Wave ${dungeonWave})`;
                     dungeonMobIcon.innerText = "ğŸ…";
                } else {
                    dungeonMobHp = hpBase;
                    let mobs = [
                        {name: "ëˆˆì‚¬ëŒ", icon: "â›„"},
                        {name: "ë£¨ëŒí”„", icon: "ğŸ¦Œ"},
                        {name: "ì„ ë¬¼ ìƒì", icon: "ğŸ"},
                        {name: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬", icon: "ğŸ„"}
                    ];
                    let m = mobs[Math.floor(Math.random() * mobs.length)];
                    dungeonMobName.innerText = `${m.name} (Wave ${dungeonWave})`;
                    dungeonMobIcon.innerText = m.icon;
                }
            } 
            else {
                // ì¼ë°˜ ë˜ì „ ì²˜ë¦¬
                if (dungeonWave >= 500) { 
                    body.style.backgroundColor = "#8B0000"; body.style.color = "#FFD700"; bar.innerText = "ğŸµ Music: Dragon Roar"; title.innerText = "ğŸ‰ ë“œë˜ê³¤ ë‘¥ì§€"; AudioEngine.playBGM('dragon'); 
                }
                else if (dungeonWave >= 400) { 
                    body.style.backgroundColor = "#111"; body.style.color = "#ccc"; bar.innerText = "ğŸµ Music: Skeleton March"; title.innerText = "â˜ ï¸ ìŠ¤ì¼ˆë ˆí†¤ ë˜ì „"; AudioEngine.playBGM('skeleton'); 
                }
                else if (dungeonWave >= 300) { 
                    body.style.backgroundColor = "#ecf0f1"; body.style.color = "#2c3e50"; bar.innerText = "ğŸµ Music: Heavenly Judgment"; title.innerText = "â˜ï¸ ì²œêµ­ ë˜ì „"; AudioEngine.playBGM('heaven'); 
                } 
                else if (dungeonWave >= 100) { 
                    body.style.backgroundColor = "#2d5a27"; body.style.color = "white"; bar.innerText = "ğŸµ Music: Hellfire Torment"; title.innerText = "ğŸ”¥ ì§€ì˜¥ ë˜ì „ (ë†ì¥)"; AudioEngine.playBGM('hell'); 
                } 
                else { 
                    body.style.backgroundColor = "#1e272e"; body.style.color = "white"; bar.innerText = "ğŸµ Music: Ominous Cave"; title.innerText = "ğŸ•³ï¸ ë¬´í•œì˜ ë™êµ´"; AudioEngine.playBGM('dungeon'); 
                }

                if(isBoss) { 
                    dungeonMobHp = hpBase * 10; 
                    dungeonMobName.innerText = `[BOSS] ë¬¸ì§€ê¸° (Wave ${dungeonWave})`; 
                    dungeonMobIcon.innerText = "ğŸ‘¹"; 
                } 
                else { 
                    dungeonMobHp = hpBase; 
                    let name = "ìœ ë ¹", icon = "ğŸ‘»";
                    if (dungeonWave >= 500) { name = "í™”ë£¡"; icon = "ğŸ²"; }
                    else if(dungeonWave >= 400) { name = "ìŠ¤ì¼ˆë ˆí†¤ ë³‘ì‚¬"; icon = "ğŸ’€"; }
                    else if(dungeonWave >= 300) { name = "íƒ€ë½ ì²œì‚¬"; icon = "ğŸª½"; }
                    else if(dungeonWave >= 100) { name = "ì§€ì˜¥ë¶ˆ ì •ë ¹"; icon = "ğŸ”¥"; }
                    dungeonMobName.innerText = `${name} (Wave ${dungeonWave})`; 
                    dungeonMobIcon.innerText = icon; 
                }
            }
            dungeonMobMaxHp = dungeonMobHp; updateDungeonUI();
        }

        function attackDungeonMonster() {
            if(playerCurrentHp <= 0) return;
            let dmg = calculateDamage(); dungeonMobHp -= dmg; AudioEngine.sfx.attack();
            let mobDmg = dungeonWave * 50; if (dungeonWave >= 100) mobDmg *= 2; if (dungeonWave >= 300) mobDmg *= 3; if (dungeonWave >= 400) mobDmg *= 5; if (dungeonWave >= 500) mobDmg *= 10;
            mobDmg = mobDmg * buffDefenseMult;
            let weapon = getCurrentDisplayWeapon(); if (weapon.name.includes("íˆë“œë¼") || weapon.name.includes("ìŠ¤ì¿ ë‚˜") || weapon.name.includes("ë“€ì–¼ ë‚«") || weapon.name.includes("ì‹ ì˜ êµ¬ìŠ¬")) { let lifesteal = Math.floor(dmg * 0.05); playerCurrentHp += lifesteal; if(playerCurrentHp > playerMaxHp) playerCurrentHp = playerMaxHp; }
            
            if(gameData.equippedArmorName === "ê°€ì‹œ ê°‘ì˜·") { let reflectDmg = mobDmg * 10; dungeonMobHp -= reflectDmg; }
            if(gameData.equippedArmorName === "ë“œë˜ê³¤ í—¤ë“œ") { let reflectDmg = mobDmg * 50; dungeonMobHp -= reflectDmg; } // ë“œë˜ê³¤ í—¤ë“œ ë°˜ì‚¬

            playerCurrentHp -= mobDmg; updateDungeonHP();
            if (playerCurrentHp <= 0) { if(autoAttackInterval) toggleAutoAttack(true); alert(`ğŸ’€ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤! Wave ${dungeonWave}ì—ì„œ íŒ¨ë°°.`); leaveDungeon(); return; }
            if(dungeonMobHp <= 0) { 
                dungeonMobHp = 0; let reward = 10000 * Math.pow(1.1, dungeonWave); gameData.coins += reward; 
                let potionName = dropRandomPotion();
                
                // === ê¸°ì¡´ ë˜ì „ ë“œë¡­ ===
                if (dungeonMode === 'normal') {
                    if (dungeonWave >= 100 && dungeonWave < 300) { if (Math.random() < 0.05 && !gameData.hasDevilHorn) { gameData.hasDevilHorn = true; queueReward("ì•…ë§ˆì˜ ë¿”", "ğŸ˜ˆ"); } }
                    else if (dungeonWave >= 300 && dungeonWave < 400) { if (Math.random() < 0.05 && !gameData.hasAngelRing) { gameData.hasAngelRing = true; queueReward("ì²œì‚¬ì˜ ë§", "ğŸ˜‡"); } }
                    else if (dungeonWave >= 400 && dungeonWave < 500) { if (Math.random() < 0.05 && !gameData.hasSpineHand) { gameData.hasSpineHand = true; queueReward("ì²™ì¶” ì†", "ğŸ–ï¸"); } }
                    else if (dungeonWave >= 500) { if (Math.random() < 0.02 && !gameData.hasDragonFan) { gameData.hasDragonFan = true; queueReward("ë“œë˜ê³¤ ë¶€ì±„", "ğŸª­"); } }
                    
                    if (Math.random() < 0.05 && !gameData.hasGlitchGuitar) { gameData.hasGlitchGuitar = true; queueReward("ê¸€ë¦¬ì¹˜ ê¸°íƒ€", "ğŸ¸"); AudioEngine.sfx.glitch(); } 
                    if (Math.random() < 0.05 && !gameData.hasGlitchChainsaw) { gameData.hasGlitchChainsaw = true; queueReward("ê¸€ë¦¬ì¹˜ ì „ê¸°í†±", "ğŸªš"); AudioEngine.sfx.glitch(); }
                }

                // === í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë˜ì „ ë“œë¡­ ===
                if (dungeonMode === 'christmas') {
                    // 2% ìº”ë”” ë‚«
                    if (Math.random() < 0.02 && !gameData.hasCandyScythe) { 
                        gameData.hasCandyScythe = true; 
                        queueReward("ğŸ¬ ìº”ë”” ë‚« (2%)", "ğŸ¬"); 
                    }
                    // 3% ìº”ë”” ì¹´íƒ€ë‚˜
                    if (Math.random() < 0.03 && !gameData.hasCandyKatana) { 
                        gameData.hasCandyKatana = true; 
                        queueReward("ğŸ‹ ìº”ë”” ì¹´íƒ€ë‚˜ (3%)", "ğŸ‹"); 
                    }
                    // 4% ìº”ë”” ì§€íŒ¡ì´
                    if (Math.random() < 0.04 && !gameData.hasCandyStaff) { 
                        gameData.hasCandyStaff = true; 
                        queueReward("ğŸ­ ìº”ë”” ì§€íŒ¡ì´ (4%)", "ğŸ­"); 
                    }
                }
                
                if (Math.random() < 0.3) { gameData.raidTickets++; log('dungeon', "ğŸŸï¸ í‹°ì¼“ íšë“!"); }

                saveGame(); 
                log('dungeon', `Wave ${dungeonWave} Clear! +${Math.floor(reward).toLocaleString()} G / ${potionName}`); dungeonWave++; spawnDungeonMob(); AudioEngine.sfx.coin(); 
            } updateDungeonUI();
        }
        function updateDungeonUI() { document.getElementById('dungeonWave').innerText = dungeonWave; document.getElementById('dungeonMobHpBar').style.width = (dungeonMobHp / dungeonMobMaxHp)*100 + "%"; document.getElementById('dungeonMobHpText').innerText = `${Math.floor(dungeonMobHp).toLocaleString()} / ${Math.floor(dungeonMobMaxHp).toLocaleString()}`; }
        function updateDungeonHP() { let pct = (playerCurrentHp / playerMaxHp) * 100; if (pct < 0) pct = 0; document.getElementById('playerHpBarDungeon').style.width = pct + "%"; document.getElementById('playerHpTextDungeon').innerText = `${Math.floor(playerCurrentHp).toLocaleString()} / ${Math.floor(playerMaxHp).toLocaleString()}`; }

        function goToRaidSelect() { changeScreen('raidSelectScreen'); }
        function startRaid(type) {
            if (gameData.raidTickets < 1) {
                alert("ğŸŸï¸ ë ˆì´ë“œ í‹°ì¼“ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ íšë“ ê°€ëŠ¥)");
                return;
            }
            gameData.raidTickets--; 
            updateUI(); 

            currentRaidType = type; 
            let armorHp = 1000;
            if(gameData.equippedArmorName === "ê°€ì‹œ ê°‘ì˜·") armorHp = 50000000000;
            else if(gameData.equippedArmorName === "ë“œë˜ê³¤ í—¤ë“œ") armorHp = 50000000000000;
            else { let armor = armorDB.find(a => a.lv === gameData.equippedArmorLevel) || armorDB[0]; armorHp = armor.hp; }
            playerMaxHp = armorHp; playerCurrentHp = playerMaxHp; 
            document.getElementById('btnPrisonRealm').style.display = 'none';
            
            if (type === 'hell') { raidMaxHp = 10000000; document.getElementById('raidTitle').innerText = "ğŸ”¥ ì§€ì˜¥ì˜ íŒŒìˆ˜ê¾¼"; document.getElementById('raidBossIcon').innerText = "ğŸ‘¿"; } 
            else if (type === 'reaper') { raidMaxHp = 50000000; document.getElementById('raidTitle').innerText = "ğŸ’€ ì‚¬ì‹ "; document.getElementById('raidBossIcon').innerText = "ğŸ’€"; }
            else if (type === 'dagger') { raidMaxHp = 200000000; document.getElementById('raidTitle').innerText = "âš”ï¸ ì•”ì‚´ì ë§ˆìŠ¤í„°"; document.getElementById('raidBossIcon').innerText = "âš”ï¸"; }
            else if (type === 'hydra') { raidMaxHp = 500000000; document.getElementById('raidTitle').innerText = "ğŸ‰ íˆë“œë¼"; document.getElementById('raidBossIcon').innerText = "ğŸ‰"; }
            else if (type === 'phoenix') { raidMaxHp = 5000000000; document.getElementById('raidTitle').innerText = "ğŸ¦… ë¶ˆì‚¬ì¡°"; document.getElementById('raidBossIcon').innerText = "ğŸ¦…"; }
            else if (type === 'joker') { raidMaxHp = 50000000000; document.getElementById('raidTitle').innerText = "ğŸ¤¡ ì¡°ì»¤"; document.getElementById('raidBossIcon').innerText = "ğŸ¤¡"; }
            else if (type === '1x1x1x1') { raidMaxHp = 100000000000; document.getElementById('raidTitle').innerText = "ğŸ”³ 1x1x1x1 ì°¨ì›"; document.getElementById('raidBossIcon').innerText = "ğŸ”³"; } 
            else if (type === 'dual_scythe') { raidMaxHp = 250000000000; document.getElementById('raidTitle').innerText = "âš”ï¸ğŸ’€ ë“€ì–¼ ë‚« ë§ˆìŠ¤í„°"; document.getElementById('raidBossIcon').innerText = "ğŸ’€"; }
            else if (type === 'gojo') { raidMaxHp = 500000000000; document.getElementById('raidTitle').innerText = "ğŸ¤ ê³ ì£  ì‚¬í† ë£¨"; document.getElementById('raidBossIcon').innerText = "ğŸ¤"; document.getElementById('btnPrisonRealm').style.display = 'inline-block'; document.getElementById('btnPrisonRealm').innerText = `ğŸ“¦ ì˜¥ë¬¸ê°• ë´‰ì¸ (${gameData.prisonRealm}ê°œ)`; }
            else if (type === 'god') { raidMaxHp = 5000000000000; document.getElementById('raidTitle').innerText = "ğŸŒŸ ì ˆëŒ€ì‹ "; document.getElementById('raidBossIcon').innerText = "ğŸŒŸ"; AudioEngine.playBGM('god'); }
            else if (type === 'dragon_god') { raidMaxHp = 100000000000000; document.getElementById('raidTitle').innerText = "ğŸ² ì§„: ë“œë˜ê³¤ (ì‹ ë³´ë‹¤ ê°•í•¨)"; document.getElementById('raidBossIcon').innerText = "ğŸ²"; AudioEngine.playBGM('dragon'); } // HP 100ì¡°

            raidHp = raidMaxHp; updateSkillButtons(); changeScreen('raidScreen'); updateRaidUI(); log('raid', `ë ˆì´ë“œ ì‹œì‘! (í‹°ì¼“ ì†Œëª¨)`);
        }
        function usePrisonRealm() { if (currentRaidType !== 'gojo') return; if (gameData.prisonRealm > 0) { gameData.prisonRealm--; raidHp = 0; log('raid', "ğŸ“¦ ì˜¥ë¬¸ê°• ê°œë¬¸! ê³ ì£  ì‚¬í† ë£¨ ë´‰ì¸!"); document.getElementById('btnPrisonRealm').innerText = `ğŸ“¦ ì˜¥ë¬¸ê°• ë´‰ì¸ (${gameData.prisonRealm}ê°œ)`; updateRaidUI(); raidSuccess(); } else { alert("ì˜¥ë¬¸ê°•ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (ì½”ë“œ: yyyuy)"); } }
        function attackRaidBoss() { 
            if (playerCurrentHp <= 0) {
                playerCurrentHp = 0; updateRaidUI();
                alert("ğŸ’€ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤! ë§ˆì„ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤."); changeScreen('townScreen'); return;
            }
            if (raidHp <= 0) return; 
            let dmg = calculateDamage(); if (dmg === Infinity) raidHp = 0; else raidHp -= dmg; if(raidHp < 0) raidHp = 0; AudioEngine.sfx.attack(); let weapon = getCurrentDisplayWeapon(); if (weapon.name.includes("íˆë“œë¼") || weapon.name.includes("ìŠ¤ì¿ ë‚˜") || weapon.name.includes("ë“€ì–¼ ë‚«") || weapon.name.includes("ì‹ ì˜ êµ¬ìŠ¬")) { let lifesteal = Math.floor(dmg * 0.05); if(lifesteal > 0) { playerCurrentHp += lifesteal; if(playerCurrentHp > playerMaxHp) playerCurrentHp = playerMaxHp; } } let bossIcon = document.getElementById('raidBossIcon'); bossIcon.classList.remove('shake'); void bossIcon.offsetWidth; bossIcon.classList.add('shake'); let bossDmg = 1000; 
            if(currentRaidType === 'reaper') bossDmg = 5000; if(currentRaidType === 'dagger') bossDmg = 20000; if(currentRaidType === 'hydra') bossDmg = 100000; if(currentRaidType === 'phoenix') bossDmg = 300000; if(currentRaidType === 'joker') bossDmg = 500000; if(currentRaidType === '1x1x1x1') bossDmg = 1000000000; if(currentRaidType === 'dual_scythe') bossDmg = 5000000000; if(currentRaidType === 'gojo') bossDmg = 10000000000; 
            if(currentRaidType === 'god') bossDmg = 99999999999; 
            if(currentRaidType === 'dragon_god') bossDmg = 500000000000; // ì—„ì²­ ì”
            
            bossDmg = bossDmg * buffDefenseMult;
            playerCurrentHp -= bossDmg; if(playerCurrentHp < 0) playerCurrentHp = 0; updateRaidUI(); let logMsg = `ê³µê²©! ${dmg === Infinity ? "MAX" : dmg.toLocaleString()}`; log('raid', logMsg); 
            
            if (playerCurrentHp <= 0) { alert("ğŸ’€ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤! ë§ˆì„ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤."); changeScreen('townScreen'); } 
            else if (raidHp <= 0) { raidSuccess(); } 
        }
        
        function raidSuccess() {
            let rewardCoin = 0; if (currentRaidType === 'hell') rewardCoin = 5000000; else if (currentRaidType === 'reaper') rewardCoin = 10000000; else if (currentRaidType === 'dagger') rewardCoin = 30000000; else if (currentRaidType === 'hydra') rewardCoin = 50000000; else if (currentRaidType === 'phoenix') rewardCoin = 80000000; else if (currentRaidType === 'joker') rewardCoin = 100000000; else if (currentRaidType === '1x1x1x1') rewardCoin = 300000000; else if (currentRaidType === 'dual_scythe') rewardCoin = 400000000; else if (currentRaidType === 'gojo') rewardCoin = 500000000; else if (currentRaidType === 'god') rewardCoin = 999999999999;
            else if (currentRaidType === 'dragon_god') rewardCoin = 9999999999999;
            
            gameData.coins += rewardCoin; queueReward(`${(rewardCoin / 10000).toLocaleString()}ë§Œ G`, "ğŸ’°"); 
            dropRandomPotion();
            AudioEngine.sfx.coin();

            if (currentRaidType === 'hell' && !gameData.hasHellBow) { gameData.hasHellBow=true; queueReward("ì§€ì˜¥ì˜ í™œ", "ğŸ”¥"); }
            else if (currentRaidType === 'reaper' && !gameData.hasScythe) { gameData.hasScythe=true; queueReward("ì‚¬ì‹ ì˜ ë‚«", "ğŸ’€"); }
            else if (currentRaidType === 'dagger' && !gameData.hasDualDagger) { gameData.hasDualDagger=true; queueReward("ë“€ì–¼ ë‹¨ê²€", "âš”ï¸"); }
            else if (currentRaidType === 'hydra') { if(!gameData.hasHydraSword) { gameData.hasHydraSword=true; queueReward("íˆë“œë¼ ê²€", "ğŸ—¡ï¸"); } else if(!gameData.hasHydraAnchor) { gameData.hasHydraAnchor=true; queueReward("íˆë“œë¼ ë‹»", "âš“"); } else if(!gameData.hasHydraAxe) { gameData.hasHydraAxe=true; queueReward("íˆë“œë¼ ë„ë¼", "ğŸª“"); } else if(!gameData.hasHydraStaff) { gameData.hasHydraStaff=true; queueReward("íˆë“œë¼ ì§€íŒ¡ì´", "ğŸª„"); } }
            else if (currentRaidType === 'phoenix' && !gameData.hasPhoenixWing) { gameData.hasPhoenixWing=true; queueReward("ë¶ˆì‚¬ì¡° ê¹ƒí„¸", "ğŸ¦…"); }
            else if (currentRaidType === 'joker' && !gameData.hasJokerCard) { gameData.hasJokerCard=true; queueReward("ì¡°ì»¤ ì¹´ë“œ", "ğŸƒ"); }
            else if (currentRaidType === '1x1x1x1') { if(!gameData.has1xSword) { gameData.has1xSword=true; queueReward("1x ê²€", "âš”ï¸"); } else if(!gameData.has1xBow) { gameData.has1xBow=true; queueReward("1x í™œ", "ğŸ¹"); } else if(!gameData.has1xComputer) { gameData.has1xComputer=true; queueReward("1x ì»´í“¨í„°", "ğŸ’»"); } else if(!gameData.has1xCrown) { gameData.has1xCrown=true; queueReward("1x1x1x ì™•ê´€", "ğŸ‘‘"); } }
            else if (currentRaidType === 'dual_scythe' && !gameData.hasDualScythe) { gameData.hasDualScythe=true; queueReward("ë“€ì–¼ ë‚«", "âš”ï¸ğŸ’€"); }
            else if (currentRaidType === 'gojo') { if(!gameData.hasGojoBlindfold) { gameData.hasGojoBlindfold=true; queueReward("ê²€ì€ ì•ˆëŒ€", "ğŸ•¶ï¸"); } gameData.sukunaFingers++; queueReward("ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½", "ğŸ§Ÿ"); if(!gameData.hasSukunaFinger) { gameData.hasSukunaFinger=true; queueReward("ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½(ë¬´ê¸°)", "ğŸ§Ÿ"); } }
            else if (currentRaidType === 'god') { if(!gameData.hasGodBead) { gameData.hasGodBead=true; queueReward("ì‹ ì˜ êµ¬ìŠ¬", "ğŸ”®"); } }
            
            else if (currentRaidType === 'dragon_god') { 
                let roll = Math.random();
                if (roll < 0.5) { // 50% ë“œë˜ê³¤ ë‚ ê°œ
                    if(!gameData.hasDragonWing) { gameData.hasDragonWing=true; queueReward("ë“œë˜ê³¤ ë‚ ê°œ (ë²„í”„)", "ğŸ¦‹"); }
                    else { queueReward("ì´ë¯¸ ë‚ ê°œ ë³´ìœ ì¤‘", "âš ï¸"); }
                } else { // 50% ë“œë˜ê³¤ ì±„ì°
                    if(!gameData.hasDragonWhip) { gameData.hasDragonWhip=true; queueReward("ë“œë˜ê³¤ ì±„ì°", "ğŸ¥“"); }
                    else { queueReward("ì´ë¯¸ ì±„ì° ë³´ìœ ì¤‘", "âš ï¸"); }
                }
            }

            renderWeaponInventory(); saveGame();
        }

        function gachaWeapon(isAuto=false) {
            const COST = 50000; 
            if (gameData.coins < COST) { 
                if(!isAuto) log('town', "ëˆ ë¶€ì¡±"); 
                return; 
            } 
            if (gameData.weaponLevel >= 2000) { 
                if(!isAuto) log('town', "ì¤€ ì¢…ê²°ê¸‰!"); 
                return; 
            } 
            
            gameData.coins -= COST; 
            let roll = Math.random() * 100; 
            let resultLv = 0;
            if (roll < 5) resultLv = 80 + Math.floor(Math.random()*20); 
            else if (roll < 30) resultLv = 120 + Math.floor(Math.random()*40); 
            else if (roll < 70) resultLv = 160 + Math.floor(Math.random()*40); 
            else if (roll < 95) resultLv = 200 + Math.floor(Math.random()*100); 
            else if (roll < 99) resultLv = 300 + Math.floor(Math.random()*200); 
            else resultLv = 500 + Math.floor(Math.random()*490); 
            
            if (resultLv > 2000) resultLv = 2000; 
            
            if (resultLv > gameData.weaponLevel) { 
                gameData.weaponLevel = resultLv; 
                queueReward(`Lv.${resultLv} ë¬´ê¸°`, "âœ¨"); 
                renderWeaponInventory(); 
                AudioEngine.sfx.levelUp(); 
            } else { 
                log('town', `..Lv.${resultLv}`); 
            } 
            updateUI();
        }

        async function autoGachaWeapon() {
            if(isAutoWeaponGacha) {
                isAutoWeaponGacha = false;
                document.getElementById('btnAutoWeaponGacha').innerText = "ğŸ”„ ë¬´ê¸° ì—°ì†";
                document.getElementById('btnAutoWeaponGacha').classList.remove('btn-field');
                document.getElementById('btnAutoWeaponGacha').classList.add('btn-auto');
                return;
            }
            isAutoWeaponGacha = true;
            document.getElementById('btnAutoWeaponGacha').innerText = "â¹ ì¤‘ë‹¨";
            document.getElementById('btnAutoWeaponGacha').classList.remove('btn-auto');
            document.getElementById('btnAutoWeaponGacha').classList.add('btn-field'); // ë¹¨ê°„ìƒ‰ ê°•ì¡°

            while(isAutoWeaponGacha && gameData.coins >= 50000 && gameData.weaponLevel < 2000) {
                gachaWeapon(true);
                await new Promise(r => setTimeout(r, 100));
            }
            
            if (gameData.coins < 50000) log('town', "ëˆ ë¶€ì¡±ìœ¼ë¡œ ì¢…ë£Œ");
            if (gameData.weaponLevel >= 2000) log('town', "ìµœê³  ë ˆë²¨ ë„ë‹¬!");

            isAutoWeaponGacha = false;
            document.getElementById('btnAutoWeaponGacha').innerText = "ğŸ”„ ë¬´ê¸° ì—°ì†";
            document.getElementById('btnAutoWeaponGacha').classList.remove('btn-field');
            document.getElementById('btnAutoWeaponGacha').classList.add('btn-auto');
        }

        function enhanceWeapon() {
            if(gameData.coins < 100) return log('town', "ëˆ ë¶€ì¡±!"); gameData.coins -= 100;
            let rate = 80; if (gameData.weaponLevel >= 2000) { log('town', "ìµœê³  ë ˆë²¨ ë„ë‹¬!"); return; }
            if(Math.random()*100 < rate) { gameData.weaponLevel++; log('town', "ê°•í™” ì„±ê³µ!"); renderWeaponInventory(); AudioEngine.sfx.gacha(); } else { if(gameData.weaponLevel>0) gameData.weaponLevel--; log('town', "ì‹¤íŒ¨! (-1)"); } updateUI();
        }

        function gachaArmor(isAutoMode = false) {
            const COST = 5000; if (gameData.coins < COST) { if(!isAutoMode) log('town', "ëˆ ë¶€ì¡±"); return false; } if (gameData.maxArmorLevel >= 2000) { if(!isAutoMode) log('town', "ìµœê°• ë°©ì–´êµ¬!"); return false; }
            gameData.coins -= COST; if (Math.random() * 100 < 50) { let currentIdx = armorDB.findIndex(a => a.lv === gameData.maxArmorLevel); if (currentIdx < armorDB.length - 1) { let nextArmor = armorDB[currentIdx + 1]; gameData.maxArmorLevel = nextArmor.lv; gameData.equippedArmorLevel = nextArmor.lv; log('town', `ğŸ‰ ìŠ¹ê¸‰! [${nextArmor.name}]`); renderArmorInventory(); updateUI(); } } else { if(!isAutoMode) log('town', "ê½..."); } updateUI(); return true;
        }
        async function autoGachaArmor() { if(isAutoArmor) { isAutoArmor = false; document.getElementById('btnAutoArmor').innerText = "ğŸ”„ ë°©ì–´êµ¬ ì—°ì†"; return; } isAutoArmor = true; document.getElementById('btnAutoArmor').innerText = "â¹ ì¤‘ë‹¨"; while(isAutoArmor && gameData.coins >= 5000 && gameData.maxArmorLevel < 2000) { gachaArmor(true); await new Promise(r => setTimeout(r, 100)); } isAutoArmor = false; document.getElementById('btnAutoArmor').innerText = "ğŸ”„ ë°©ì–´êµ¬ ì—°ì†"; }
        async function autoEnhance() { if(isAutoWeapon) return; isAutoWeapon = true; document.querySelector('.btn-auto').innerText = "â¹"; while(isAutoWeapon && gameData.coins >= 100 && gameData.weaponLevel < 2000) { enhanceWeapon(); await new Promise(r=>setTimeout(r, 50)); } isAutoWeapon = false; document.querySelector('.btn-auto').innerText = "âš¡ ì—°ì†ê°•í™”"; saveGame(); }

        function renderWeaponInventory() { 
            const grid = document.getElementById('weaponInventoryGrid'); grid.innerHTML = ""; 
            weaponDB.forEach(w => createWeaponSlot(grid, w.icon, `Lv.${w.lv}`, gameData.weaponLevel >= w.lv, w.name)); 
            
            createWeaponSlot(grid, "ğŸ”¥", "ì§€ì˜¥í™œ", gameData.hasHellBow, "ì§€ì˜¥ì˜ í™œ"); 
            createWeaponSlot(grid, "ğŸ’€", "ì‚¬ì‹ ë‚«", gameData.hasScythe, "ì‚¬ì‹ ì˜ ë‚«"); 
            createWeaponSlot(grid, "âš”ï¸", "ë“€ì–¼ë‹¨ê²€", gameData.hasDualDagger, "ë“€ì–¼ ë‹¨ê²€");
            createWeaponSlot(grid, "ğŸ—¡ï¸", "H.ê²€", gameData.hasHydraSword, "íˆë“œë¼ ê²€");
            createWeaponSlot(grid, "âš“", "H.ë‹»", gameData.hasHydraAnchor, "íˆë“œë¼ ë‹»");
            createWeaponSlot(grid, "ğŸª“", "H.ë„ë¼", gameData.hasHydraAxe, "íˆë“œë¼ ë„ë¼");
            createWeaponSlot(grid, "ğŸª„", "H.ì§€íŒ¡ì´", gameData.hasHydraStaff, "íˆë“œë¼ ì§€íŒ¡ì´");
            createWeaponSlot(grid, "ğŸ¦…", "ë¶ˆì‚¬ì¡°", gameData.hasPhoenixWing, "ë¶ˆì‚¬ì¡° ê¹ƒí„¸");
            createWeaponSlot(grid, "ğŸƒ", "ì¡°ì»¤ì¹´ë“œ", gameData.hasJokerCard, "ì¡°ì»¤ ì¹´ë“œ");
            createWeaponSlot(grid, "âš”ï¸", "1x ê²€", gameData.has1xSword, "1x ê²€");
            createWeaponSlot(grid, "ğŸ¹", "1x í™œ", gameData.has1xBow, "1x í™œ");
            createWeaponSlot(grid, "ğŸ’»", "1x PC", gameData.has1xComputer, "1x ì»´í“¨í„°");
            createWeaponSlot(grid, "ğŸ‘‘", "1x ì™•ê´€", gameData.has1xCrown, "1x1x1x ì™•ê´€");
            createWeaponSlot(grid, "âš”ï¸ğŸ’€", "ë“€ì–¼ ë‚«", gameData.hasDualScythe, "ë“€ì–¼ ë‚«");
            createWeaponSlot(grid, "ğŸ•¶ï¸", "ê²€ì€ì•ˆëŒ€", gameData.hasGojoBlindfold, "ê²€ì€ ì•ˆëŒ€");
            
            createWeaponSlot(grid, "ğŸ•¸ï¸", "ì ìë¦¬ì±„", gameData.hasDragonflyNet, "ì ìë¦¬ì±„"); 
            createWeaponSlot(grid, "6ï¸âƒ£7ï¸âƒ£", "íˆë“ ", gameData.hasAdminWeapon, "67 ë¬´ê¸°"); 
            createWeaponSlot(grid, "ğŸ§Ÿ", "Lv.500", gameData.hasSukunaFinger, "ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½");
            createWeaponSlot(grid, "ğŸ¸", "ê¸€ë¦¬ì¹˜", gameData.hasGlitchGuitar, "ê¸€ë¦¬ì¹˜ ê¸°íƒ€");
            createWeaponSlot(grid, "ğŸªš", "ì „ê¸°í†±", gameData.hasGlitchChainsaw, "ê¸€ë¦¬ì¹˜ ì „ê¸°í†±");

            createWeaponSlot(grid, "ğŸ˜ˆ", "ì•…ë§ˆ ë¿”", gameData.hasDevilHorn, "ì•…ë§ˆì˜ ë¿”");
            createWeaponSlot(grid, "ğŸ˜‡", "ì²œì‚¬ ë§", gameData.hasAngelRing, "ì²œì‚¬ì˜ ë§");
            createWeaponSlot(grid, "ğŸ–ï¸", "ì²™ì¶” ì†", gameData.hasSpineHand, "ì²™ì¶” ì†");
            createWeaponSlot(grid, "ğŸ”®", "ì‹ ì˜êµ¬ìŠ¬", gameData.hasGodBead, "ì‹ ì˜ êµ¬ìŠ¬");

            createWeaponSlot(grid, "ğŸª­", "D.ë¶€ì±„", gameData.hasDragonFan, "ë“œë˜ê³¤ ë¶€ì±„");
            createWeaponSlot(grid, "ğŸ‰", "D.ë‹¨ê²€", gameData.hasDragonDagger, "ë“œë˜ê³¤ ë‹¨ê²€");
            createWeaponSlot(grid, "ğŸ‘¥", "D.í´ë¡ ", gameData.hasDragonClone, "ë“œë˜ê³¤ í´ë¡ ");
            createWeaponSlot(grid, "ğŸ¥“", "D.ì±„ì°", gameData.hasDragonWhip, "ë“œë˜ê³¤ ì±„ì°");

            // í¬ë¦¬ìŠ¤ë§ˆìŠ¤
            createWeaponSlot(grid, "ğŸ¬", "ìº”ë”” ë‚«", gameData.hasCandyScythe, "ìº”ë”” ë‚«");
            createWeaponSlot(grid, "ğŸ‹", "ìº”ë”” ê²€", gameData.hasCandyKatana, "ìº”ë”” ì¹´íƒ€ë‚˜");
            createWeaponSlot(grid, "ğŸ­", "ìº”ë”” ë´‰", gameData.hasCandyStaff, "ìº”ë”” ì§€íŒ¡ì´");
        }

        function createWeaponSlot(parent, icon, text, unlock, skinName) { let div = document.createElement('div'); div.className = "inv-slot"; if(!unlock) { div.classList.add('locked'); div.innerHTML = "ğŸ”’"; } else { div.innerHTML = `<div class="slot-icon">${icon}</div><div class="slot-lv">${text}</div>`; div.onclick = () => { gameData.equippedSkinName = skinName; renderWeaponInventory(); updateUI(); }; if(getCurrentDisplayWeapon().name === skinName) div.classList.add('selected'); } parent.appendChild(div); }
        
        function renderArmorInventory() { 
            const grid = document.getElementById('armorInventoryGrid'); grid.innerHTML = ""; 
            armorDB.forEach(a => { 
                let div = document.createElement('div'); div.className = "inv-slot"; 
                let unlock = gameData.maxArmorLevel >= a.lv; 
                if(!unlock) { div.classList.add('locked'); div.innerHTML = "ğŸ”’"; } 
                else { 
                    div.innerHTML = `<div class="slot-icon">${a.icon}</div><div class="slot-lv">Lv.${a.lv}</div>`; 
                    div.onclick = () => { gameData.equippedArmorLevel = a.lv; gameData.equippedArmorName = a.name; renderArmorInventory(); updateUI(); }; 
                    if(gameData.equippedArmorLevel === a.lv && gameData.equippedArmorName !== "ê°€ì‹œ ê°‘ì˜·" && gameData.equippedArmorName !== "ë“œë˜ê³¤ í—¤ë“œ") div.classList.add('selected'); 
                } 
                grid.appendChild(div); 
            }); 
            let div = document.createElement('div'); div.className = "inv-slot";
            if(!gameData.hasThornArmor) { div.classList.add('locked'); div.innerHTML = "ğŸ”’"; }
            else {
                div.innerHTML = `<div class="slot-icon">ğŸŒµ</div><div class="slot-lv">ê°€ì‹œ</div>`;
                div.onclick = () => { gameData.equippedArmorName = "ê°€ì‹œ ê°‘ì˜·"; renderArmorInventory(); updateUI(); };
                if(gameData.equippedArmorName === "ê°€ì‹œ ê°‘ì˜·") div.classList.add('selected');
            }
            grid.appendChild(div);

            let div2 = document.createElement('div'); div2.className = "inv-slot";
            if(!gameData.hasDragonHead) { div2.classList.add('locked'); div2.innerHTML = "ğŸ”’"; }
            else {
                div2.innerHTML = `<div class="slot-icon">ğŸ²</div><div class="slot-lv">D.Head</div>`;
                div2.onclick = () => { gameData.equippedArmorName = "ë“œë˜ê³¤ í—¤ë“œ"; renderArmorInventory(); updateUI(); };
                if(gameData.equippedArmorName === "ë“œë˜ê³¤ í—¤ë“œ") div2.classList.add('selected');
            }
            grid.appendChild(div2);
        }
        
        function updateUI() { 
            document.getElementById('coinDisplay').innerText = Math.floor(gameData.coins).toLocaleString(); 
            document.getElementById('potionDisplay').innerText = gameData.potions; 
            document.getElementById('potionAtkDisplay').innerText = gameData.damagePotions; 
            document.getElementById('potionDefDisplay').innerText = gameData.defensePotions; 
            document.getElementById('prisonDisplay').innerText = gameData.prisonRealm; 
            document.getElementById('fingerDisplay').innerText = gameData.sukunaFingers;
            document.getElementById('ticketDisplay').innerText = gameData.raidTickets; 
            
            // ë‚ ê°œ ë²„íŠ¼
            if(gameData.hasDragonWing) document.getElementById('btnWingUse').style.display = 'inline-block';
            else document.getElementById('btnWingUse').style.display = 'none';

            if(gameData.sukunaFingers > 0) document.getElementById('btnEatFinger').style.display = 'block'; else document.getElementById('btnEatFinger').style.display = 'none';
            let wInfo = getCurrentDisplayWeapon(); document.getElementById('townWeaponIcon').innerText = wInfo.icon; document.getElementById('weaponStatus').innerText = `${wInfo.name}`; 
            
            let aName = gameData.equippedArmorName;
            if(!aName) {
                let aInfo = armorDB.find(a => a.lv === gameData.equippedArmorLevel) || armorDB[0]; 
                aName = aInfo.name;
            }
            document.getElementById('townArmorIcon').innerText = "ğŸ‘•"; 
            if(aName === "ê°€ì‹œ ê°‘ì˜·") document.getElementById('townArmorIcon').innerText = "ğŸŒµ";
            if(aName === "ë“œë˜ê³¤ í—¤ë“œ") document.getElementById('townArmorIcon').innerText = "ğŸ²";
            document.getElementById('armorStatus').innerText = aName; 
        }
        function updateRaidUI() { document.getElementById('raidHpBar').style.width = (raidHp / raidMaxHp)*100 + "%"; document.getElementById('raidHpText').innerText = raidHp.toLocaleString(); document.getElementById('playerHpBar').style.width = (playerCurrentHp / playerMaxHp)*100 + "%"; document.getElementById('playerHpText').innerText = `${playerCurrentHp.toLocaleString()} / ${playerMaxHp.toLocaleString()}`; }
        
        function getCurrentDisplayWeapon() { 
            if(gameData.equippedSkinName) { 
                if(gameData.equippedSkinName==="ë“œë˜ê³¤ ë‹¨ê²€" && gameData.hasDragonDagger) return {name:"ë“œë˜ê³¤ ë‹¨ê²€", icon:"ğŸ‰"};
                if(gameData.equippedSkinName==="ë“œë˜ê³¤ í´ë¡ " && gameData.hasDragonClone) return {name:"ë“œë˜ê³¤ í´ë¡ ", icon:"ğŸ‘¥"};
                if(gameData.equippedSkinName==="ë“œë˜ê³¤ ì±„ì°" && gameData.hasDragonWhip) return {name:"ë“œë˜ê³¤ ì±„ì°", icon:"ğŸ¥“"};
                if(gameData.equippedSkinName==="ë“œë˜ê³¤ ë¶€ì±„" && gameData.hasDragonFan) return {name:"ë“œë˜ê³¤ ë¶€ì±„", icon:"ğŸª­"};

                if(gameData.equippedSkinName==="ìº”ë”” ë‚«" && gameData.hasCandyScythe) return {name:"ìº”ë”” ë‚«", icon:"ğŸ¬"};
                if(gameData.equippedSkinName==="ìº”ë”” ì¹´íƒ€ë‚˜" && gameData.hasCandyKatana) return {name:"ìº”ë”” ì¹´íƒ€ë‚˜", icon:"ğŸ‹"};
                if(gameData.equippedSkinName==="ìº”ë”” ì§€íŒ¡ì´" && gameData.hasCandyStaff) return {name:"ìº”ë”” ì§€íŒ¡ì´", icon:"ğŸ­"};

                if(gameData.equippedSkinName==="ì‹ ì˜ êµ¬ìŠ¬" && gameData.hasGodBead) return {name:"ì‹ ì˜ êµ¬ìŠ¬", icon:"ğŸ”®"};
                if(gameData.equippedSkinName==="ì•…ë§ˆì˜ ë¿”" && gameData.hasDevilHorn) return {name:"ì•…ë§ˆì˜ ë¿”", icon:"ğŸ˜ˆ"};
                if(gameData.equippedSkinName==="ì²œì‚¬ì˜ ë§" && gameData.hasAngelRing) return {name:"ì²œì‚¬ì˜ ë§", icon:"ğŸ˜‡"};
                if(gameData.equippedSkinName==="ì²™ì¶” ì†" && gameData.hasSpineHand) return {name:"ì²™ì¶” ì†", icon:"ğŸ–ï¸"};
                
                if(gameData.equippedSkinName==="ê¸€ë¦¬ì¹˜ ê¸°íƒ€" && gameData.hasGlitchGuitar) return {name:"ê¸€ë¦¬ì¹˜ ê¸°íƒ€", icon:"ğŸ¸"};
                if(gameData.equippedSkinName==="ê¸€ë¦¬ì¹˜ ì „ê¸°í†±" && gameData.hasGlitchChainsaw) return {name:"ê¸€ë¦¬ì¹˜ ì „ê¸°í†±", icon:"ğŸªš"};
                if(gameData.equippedSkinName==="ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½" && gameData.hasSukunaFinger) return {name:"ìŠ¤ì¿ ë‚˜ì˜ ì†ê°€ë½", icon:"ğŸ§Ÿ"};
                if(gameData.equippedSkinName==="ê²€ì€ ì•ˆëŒ€" && gameData.hasGojoBlindfold) return {name:"ê²€ì€ ì•ˆëŒ€", icon:"ğŸ•¶ï¸"};
                if(gameData.equippedSkinName==="ë“€ì–¼ ë‚«" && gameData.hasDualScythe) return {name:"ë“€ì–¼ ë‚«", icon:"âš”ï¸ğŸ’€"};
                if(gameData.equippedSkinName==="1x1x1x ì™•ê´€" && gameData.has1xCrown) return {name:"1x1x1x ì™•ê´€", icon:"ğŸ‘‘"};
                if(gameData.equippedSkinName==="1x ê²€" && gameData.has1xSword) return {name:"1x ê²€", icon:"âš”ï¸"};
                if(gameData.equippedSkinName==="1x í™œ" && gameData.has1xBow) return {name:"1x í™œ", icon:"ğŸ¹"};
                if(gameData.equippedSkinName==="1x ì»´í“¨í„°" && gameData.has1xComputer) return {name:"1x ì»´í“¨í„°", icon:"ğŸ’»"};
                if(gameData.equippedSkinName==="ì¡°ì»¤ ì¹´ë“œ" && gameData.hasJokerCard) return {name:"ì¡°ì»¤ ì¹´ë“œ", icon:"ğŸƒ"};
                if(gameData.equippedSkinName==="ë¶ˆì‚¬ì¡° ê¹ƒí„¸" && gameData.hasPhoenixWing) return {name:"ë¶ˆì‚¬ì¡° ê¹ƒí„¸", icon:"ğŸ¦…"};
                if(gameData.equippedSkinName==="ì ìë¦¬ì±„" && gameData.hasDragonflyNet) return {name:"ì ìë¦¬ì±„", icon:"ğŸ•¸ï¸"}; 
                if(gameData.equippedSkinName==="íˆë“œë¼ ê²€" && gameData.hasHydraSword) return {name:"íˆë“œë¼ ê²€", icon:"ğŸ—¡ï¸"};
                if(gameData.equippedSkinName==="íˆë“œë¼ ë‹»" && gameData.hasHydraAnchor) return {name:"íˆë“œë¼ ë‹»", icon:"âš“"};
                if(gameData.equippedSkinName==="íˆë“œë¼ ë„ë¼" && gameData.hasHydraAxe) return {name:"íˆë“œë¼ ë„ë¼", icon:"ğŸª“"};
                if(gameData.equippedSkinName==="íˆë“œë¼ ì§€íŒ¡ì´" && gameData.hasHydraStaff) return {name:"íˆë“œë¼ ì§€íŒ¡ì´", icon:"ğŸª„"};
                if(gameData.equippedSkinName==="ë“€ì–¼ ë‹¨ê²€" && gameData.hasDualDagger) return {name:"ë“€ì–¼ ë‹¨ê²€", icon:"âš”ï¸"};
                if(gameData.equippedSkinName==="ì‚¬ì‹ ì˜ ë‚«" && gameData.hasScythe) return {name:"ì‚¬ì‹ ì˜ ë‚«", icon:"ğŸ’€"};
                if(gameData.equippedSkinName==="67 ë¬´ê¸°" && gameData.hasAdminWeapon) return {name:"67 ë¬´ê¸°", icon:"6ï¸âƒ£7ï¸âƒ£"};
                if(gameData.equippedSkinName==="ì§€ì˜¥ì˜ í™œ" && gameData.hasHellBow) return {name:"ì§€ì˜¥ì˜ í™œ", icon:"ğŸ”¥"};
                let f = weaponDB.find(w=>w.name===gameData.equippedSkinName); if(f && gameData.weaponLevel>=f.lv) return f; 
            } 
            for(let i=weaponDB.length-1; i>=0; i--) if(gameData.weaponLevel >= weaponDB[i].lv) return weaponDB[i]; return weaponDB[0]; 
        }
        
        function toggleMode() { 
            const body = document.body;
            if(body.classList.contains("mode-pc")) { body.classList.remove("mode-pc"); body.classList.add("mode-mobile"); } 
            else { body.classList.remove("mode-mobile"); body.classList.add("mode-pc"); }
        }
        
        function changeScreen(id) { 
            document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); 
            if(id === 'townScreen') setMusic('town'); else if(id === 'fieldScreen') setMusic('field'); else if(id === 'dungeonScreen') {
                if(dungeonMode === 'christmas') setMusic('christmas'); else setMusic('dungeon');
            } else if(id === 'raidScreen') setMusic('raid');
            if(id !== 'fieldScreen' && id !== 'dungeonScreen' && autoAttackInterval) toggleAutoAttack(false);
        }
        function log(t,m) { document.getElementById(t+"Log").innerText = m; }
        function goToField() { changeScreen('fieldScreen'); spawnMonster(); updateSkillButtons(); }
        
        function spawnMonster() { 
            document.getElementById('attackBtn').style.display = 'inline-block'; 
            document.getElementById('nextMonsterBtn').style.display = 'none'; 
            
            let target = monsters[0];
            for(let i = monsters.length-1; i >= 0; i--) { 
                if(gameData.weaponLevel >= monsters[i].level) { 
                    target = monsters[i]; 
                    break; 
                } 
            } 
            document.getElementById('monsterIcon').innerText = target.icon; 
            document.getElementById('monsterInfo').innerText = `Lv.${target.level} ${target.name}`; 
        }

        function attackMonster() { 
            let dmg = calculateDamage(); gameData.coins += 100 + Math.floor(dmg / 10); 
            let weapon = getCurrentDisplayWeapon(); if (weapon.name.includes("íˆë“œë¼")) { let lifesteal = Math.floor(dmg * 0.05); if(lifesteal > 0) { playerCurrentHp += lifesteal; if(playerCurrentHp > playerMaxHp) playerCurrentHp = playerMaxHp; } }
            if(Math.random() < 0.1) { let pName = dropRandomPotion(); log('battle', `+${pName}`); }
            
            if (Math.random() < 0.3) { gameData.raidTickets++; log('battle', "ğŸŸï¸ í‹°ì¼“ íšë“!"); }

            else log('battle', `ê³µê²©! ${dmg.toLocaleString()}`); 
            AudioEngine.sfx.attack();
            document.getElementById('attackBtn').style.display = 'none'; document.getElementById('nextMonsterBtn').style.display = 'inline-block'; updateUI(); 
        }
        function chopWood() { gameData.coins+=500; updateUI(); log('forest',"+500 G"); AudioEngine.sfx.hit(); }

        document.addEventListener('keydown', (e) => {
            if(e.key.toUpperCase() === 'V') useSkill('V');
            if(e.key.toUpperCase() === 'Z') useSkill('Z');
            if(e.key.toUpperCase() === 'X') useSkill('X');
            if(e.key.toUpperCase() === 'C') useSkill('C');
            if(e.key.toUpperCase() === 'B') useSkill('B'); 
        });
        
        loadGame();
    </script>
</body>
</html>
